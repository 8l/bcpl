
######bcplprogs/demos/ack.b#
GET."libhdr"#0A#0ALET.f(x).#3D.x#0A#0ALET.ack(x,.y)
.#3D.x#3D0.->.y+1,#0A................y#3D0.->.ack(x
-1,.1),#0A................ack(x-1,.ack(x,.y-1))#0A#0A
LET.start().#3D.VALOF#0A{.writef("Ackermann's.funct
ion*n*n")#0A#0A..FOR.i.#3D.0.TO.5.DO#0A..{.writef("
a(%n,.**):.",.i)#0A....FOR.j.#3D.0.TO.6.DO#0A......
writef(".%i8*n",.ack(i,.j))#0A....newline()#0A..}#0A
..RESULTIS.0#0A}#0A

######bcplprogs/demos/anseq.b#
/*.This.program.prints.the.least.significant.decima
l#0A...digit.of.Connell's.sequence.numbers.An.where
#0A#0A...An.#3D.2n.-.int[(1.+.sqrt(8i-7))/2]#0A#0A.
..This.demonstration.was.suggested.to.me.by.Bob.Ack
er#2E#0A#0A...Implemented.in.BCPL.by.Martin.Richard
s.(c).Oct.2000#2E#0A*/#0A#0AGET."libhdr"#0A#0ALET.s
tart().#3D.VALOF#0A{.LET.prevd.#3D.0#0A#0A/*#0A//.T
est.sqrt.function#0AFOR.i.#3D.0.TO.31.DO#0A{.LET.x.
#3D.1<<i#0A..FOR.j.#3D.-1.TO.1.DO#0A..{.LET.a.#3D.x
+j#0A....LET.r.#3D.sqrt(a)#0A....writef("%x8:.r#3D%
x8..r****2#3D%x8..(r+1)****2#3D%x8*n",.#0A.........
...a,.....r,..........r*r,............(r+1)*(r+1))#0A
..}#0A}#0ARESULTIS.0#0A*/#0A#0A..FOR.i.#3D.1.TO.201
6.DO#0A..{.LET.d.#3D.(2*i.-.(1+sqrt(8*i-7))/2).REM.
10#0A....UNLESS.((prevd.NEQV.d).&.1).#3D.0.DO.newli
ne()#0A....prevd.:#3D.d#0A....writef("%n",.d)#0A..}
#0A..newline()#0A..RESULTIS.0#0A}#0A#0AAND.sqrt(x).
#3D.VALOF#0A//.If.x<#3D0.return.0#0A//.else.Return.
the.largest.integer.whose.square.is.<#3D.x#0A//.(It
.might.have.been.better.to.treat.x.as.unsigned#2E)#0A
{.LET.r.#3D.1#0A..IF.x<#3D0.RESULTIS.0#0A..{.LET.nr
.#3D.(r.+.x/r.+.1)/2.//.The.+1.stops.possible.oscil
lation.#0A....IF.r#3Dnr.BREAK#0A....r.:#3D.nr#0A..}
.REPEAT#0A..IF.r<0.....DO.r.:#3D.-r..//.Special.car
e.when.x.close.to.maxint..#0A..IF.r*r-x>0.DO.r.:#3D
.r-1#0A..RESULTIS.r#0A}#0A

######bcplprogs/demos/apfel.b#
/*#0A..This.is.a.BCPL.translation.of.a.program.to#0A
..Draw.a.Mandelbrot.Set.using.ASCII.characters#2E.R
esolution.#3D.79x49#2E#0A..that.was.implemented.in.
T3X.by.Nils.M#2EHolm<fs29@rumms#2Euni-mannheim#2Ede
>#0A#0A..Translation.by.Martin.Richards,..early.Jul
y.1998#0A*/#0A#0AGET."libhdr"#0A#0AMANIFEST#0A{.SCA
LE.#3D.100#0A#0A//FULL.#3D.219;.UPPER.#3D..223;.LOW
ER.#3D.220;.EMPTY.#3D.'*s'..//.IBM.PC#0A..FULL.#3D.
'M';.UPPER.#3D.'*"';.LOWER.#3D.'m';.EMPTY.#3D.'*s'.
.//.ASCII#0A}#0A#0ALET.f(x,.y).#3D.VALOF#0A{.LET.zr
.#3D.0#0A..LET.zi.#3D.0#0A..LET.cr.#3D.x*SCALE/25#0A
..LET.ci.#3D.y*SCALE/20#0A#0A..FOR.i.#3D.0.TO.100.D
O#0A..{.LET.ir.#3D.zr*zr/SCALE.-.zi*zi/SCALE;#0A...
.zi.:#3D.zr*zi/SCALE.+.zi*zr/SCALE.+.ci;#0A....zr.:
#3D.ir.+.cr;#0A....IF.zi.>.2*SCALE..|.zr.>.2*SCALE.
|#0A.......zi.<.-2*SCALE.|.zr.<.-2*SCALE.RESULTIS.1
#0A..}#0A..RESULTIS.0#0A}#0A#0A#0ALET.start().#3D.V
ALOF#0A{.LET.line.#3D.VEC.80#0A..LET.even.#3D.0;#0A
#0A..FOR.y#3D-24.TO.25.DO#0A..{.FOR.x#3D-59.TO.20.D
O#0A....{.LET.r.#3D.f(x,y);#0A......TEST.even.THEN.
line!(x+59).:#3D.line!(x+59)->.r->.FULL,..UPPER,#0A
..................................................r
->.LOWER,.EMPTY#0A................ELSE.line!(x+59).
:#3D.r#0A....}#0A....FOR.i.#3D.0.TO.78.DO.wrch(line
!i)#0A....newline()#0A....even.:#3D.~even#0A..}#0A.
.RESULTIS.0#0A}#0A#0A

######bcplprogs/demos/bigprimes.b#
SECTION."BIGPRIMES"#0A.#0AGET."libhdr"#0A.#0AGLOBAL
.$(.count:.ug..$)#0A.#0ALET.start().#3D.VALOF#0A$(.
LET.n,.k.#3D.1000000000,.20#0A...LET.argv.#3D.VEC.5
0#0A#0A...IF.rdargs("FROM,COUNT",.argv,.50)#3D0.DO#0A
...$(.writes("Bad.arguments.for.BIGPRIMES*n")#0A...
...RESULTIS.20#0A...$)#0A#0A...UNLESS.argv!0#3D0.DO
.n.:#3D.str2numb(argv!0)#0A...UNLESS.argv!1#3D0.DO.
k.:#3D.str2numb(argv!1)#0A#0A...writef("The.first.%
n.primes.from.%n.are:*n",.k,.n)#0A#0A...count.:#3D.
0#0A#0A...UNTIL.count>#3Dk.DO#0A...$(.IF.isprime(n)
.DO.out(n)#0A......n.:#3D.n+1#0A...$)#0A.#0A...writ
es("*nend.of.output*n")#0A#0A...RESULTIS.0#0A$)#0A#0A
AND.isprime(n).#3D.VALOF#0A$(.LET.d.#3D.2#0A...$(.I
F.d*d>n.RESULTIS.TRUE#0A......IF.n.REM.d.#3D.0.RESU
LTIS.FALSE#0A......d.:#3D.d+1#0A...$).REPEAT#0A$)#0A
.#0AAND.out(n).BE#0A$(.IF.count.REM.5.#3D.0.DO.newl
ine()#0A...writef(".%i9",.n)#0A...count.:#3D.count.
+.1#0A$)#0A

######bcplprogs/demos/bprimes.b#
SECTION."BIGPRIMES"#0A.#0AGET."libhdr"#0A.#0AGLOBAL
.$(.count:.ug..$)#0A.#0ALET.start().#3D.VALOF#0A$(.
LET.n,.k.#3D.1000000,.10#0A...LET.argv.#3D.VEC.50#0A
#0A...IF.rdargs("FROM,COUNT",.argv,.50)#3D0.DO#0A..
.$(.writes("Bad.arguments.for.BIGPRIMES*n")#0A.....
.RESULTIS.20#0A...$)#0A#0A...UNLESS.argv!0#3D0.DO.n
.:#3D.str2numb(argv!0)#0A...UNLESS.argv!1#3D0.DO.k.
:#3D.str2numb(argv!1)#0A#0A...writef("The.first.%n.
primes.from.%n.are:*n",.k,.n)#0A#0A...count.:#3D.0#0A
#0A...UNTIL.count>#3Dk.DO#0A...$(.IF.isprime(n).DO.
out(n)#0A......n.:#3D.n+1#0A...$)#0A.#0A...writes("
*nend.of.output*n")#0A#0A...RESULTIS.0#0A$)#0A#0AAN
D.isprime(n).#3D.VALOF#0A$(.LET.d.#3D.2#0A...$(.IF.
d*d>n.RESULTIS.TRUE#0A......IF.n.REM.d.#3D.0.RESULT
IS.FALSE#0A......d.:#3D.d+1#0A...$).REPEAT#0A$)#0A.
#0AAND.out(n).BE#0A$(.IF.count.REM.5.#3D.0.DO.newli
ne()#0A...writef(".%i9",.n)#0A...count.:#3D.count.+
.1#0A$)#0A

######bcplprogs/demos/calendars.b#
/*#0AThis.program.give.a.table.of.which.calanders.a
re.equivalent,.ie#0Awhich.have.1.January.on.the.sam
e.day.and.are.or.are.not.leap.years#2E#0A#0AUsage:.
calendars."start/n,.end/n"#0A#0Astart.and.end.are.t
he.first.year.and.last.years.to.consider#2E#0A#0ATy
pical.output.is.:-#0A#0ANon-leap.years:#0A1.Jan.is.
Monday:.....2001.2007.2018.2029.2035.2046.2057.2063
.2074.2085.2091#0A1.Jan.is.Tuesday:....2002.2013.20
19.2030.2041.2047.2058.2069.2075.2086.2097#0A1.Jan.
is.Wednesday:..2003.2014.2025.2031.2042.2053.2059.2
070.2081.2087.2098#0A1.Jan.is.Thursday:...2009.2015
.2026.2037.2043.2054.2065.2071.2082.2093.2099#0A1.J
an.is.Friday:.....2010.2021.2027.2038.2049.2055.206
6.2077.2083.2094.2100#0A1.Jan.is.Saturday:...2005.2
011.2022.2033.2039.2050.2061.2067.2078.2089.2095#0A
1.Jan.is.Sunday:.....2006.2017.2023.2034.2045.2051.
2062.2073.2079.2090#0A#0ALeap.years:#0A1.Jan.is.Mon
day:.....2024.2052.2080#0A1.Jan.is.Tuesday:....2008
.2036.2064.2092#0A1.Jan.is.Wednesday:..2020.2048.20
76#0A1.Jan.is.Thursday:...2004.2032.2060.2088#0A1.J
an.is.Friday:.....2016.2044.2072#0A1.Jan.is.Saturda
y:...2000.2028.2056.2084#0A1.Jan.is.Sunday:.....201
2.2040.2068.2096#0A#0A*/#0A#0A#0ASECTION."calendars
"#0A#0AGET."libhdr"#0A#0AGLOBAL.{.startyear:ug;.end
year;.firstyear.}#0A#0AMANIFEST.{.mon#3D0;.sun#3D6;
.jan#3D0;.feb#3D1;.dec#3D11.}#0A#0ALET.start().#3D.
VALOF#0A{.LET.argv.#3D.VEC.50#0A#0A..UNLESS.rdargs(
"start/n,end/n",.argv,.50).DO#0A..{.writef("Bad.arg
uments.for.calendar*n")#0A....RESULTIS.0#0A..}#0A#0A
..startyear.:#3D.argv!0.->.!argv!0,.2000#0A..endyea
r...:#3D.argv!1.->.!argv!1,.2100#0A#0A..IF.startyea
r<0.|.endyear>startyear+399.DO#0A..{.writef("Bad.ye
ar.range.%n.to.%n*n*n",.startyear,.endyear)#0A....R
ESULTIS.0#0A..}#0A#0A..firstyear.:#3D.1973..//.Chos
en.because.1.January.is.a.Monday#0A#0A..UNTIL.first
year.>#3D.startyear.DO.firstyear.:#3D.firstyear+400
#0A..UNTIL.firstyear.<#3D.startyear.DO.firstyear.:#3D
.firstyear-400#0A#0A//writef("firstyear#3D%n.starty
ear#3D%n.endyear#3D%n*n",.firstyear,.startyear,.end
year)#0A#0A..FOR.i.#3D.0.TO.1.DO#0A..{.LET.leap.#3D
.i#3D1#0A....writef("*n%s.years:*n",.leap.->."Leap"
,."Non-leap")#0A....FOR.day.#3D.mon.TO.sun.DO#0A...
.{.LET.days.#3D.0#0A......LET.year.#3D.firstyear#0A
#0A......writef("1.Jan.is.%s",.select(day,."Monday:
....",#0A........................................"T
uesday:...",#0A....................................
...."Wednesday:.",#0A..............................
.........."Thursday:..",#0A........................
................"Friday:....",#0A..................
......................"Saturday:..",#0A............
............................"Sunday:....")#0A......
.......)#0A......WHILE.year<#3Dendyear.DO#0A......{
.LET.b.#3D.isleap(year)#0A........IF.days.MOD.7.#3D
.day.&.year>#3Dstartyear.&.b#3Dleap.DO.writef(".%i4
",.year)#0A........days.:#3D.days.+.365#0A........I
F.b.DO.days.:#3D.days.+.1#0A........year.:#3D.year+
1#0A......}#0A......newline()#0A....}#0A..}#0A#0A..
RESULTIS.0#0A}#0A#0AAND.isleap(year).#3D.year.REM.4
00.#3D.0.->.TRUE,#0A...................year.REM.100
.#3D.0.->.FALSE,#0A...................year.REM.4...
#3D.0.->.TRUE,#0A...................FALSE#0A#0AAND.
select(n,.a0,.a1,.a2,.a3,.a4,.a5,.a6).#3D.n!@a0#0A#0A
#0A

######bcplprogs/demos/cavity.b#
SECTION."cavity"#0A.#0AGET."libhdr"#0A.#0AMANIFEST.
$(.upb......#3D.10#0A............len......#3D.upb+1
#0A............datavupb.#3D.len*len-1#0A$)#0A.#0AGL
OBAL.$(.datav:200;..datat:201#0A$)#0A.#0ALET.cav2()
.#3D.VALOF#0A$(.LET.count.#3D.0#0A...FOR.p.#3D.data
v+len.TO.datat-len.UNTIL.!p#3D0.DO#0A...$(.LET.w.#3D
.!p#0A......LET.bit.#3D.w.&.-w#0A......fillin(p,.bi
t)#0A......count.:#3D.count.+.1#0A...$)#0A...RESULT
IS.count#0A$)#0A.#0AAND.fillin(p,.bit).BE.UNLESS.(!
p.&.bit).#3D.0.DO#0A$(.!p.:#3D.!p.-.bit#0A...fillin
(p-1,...bit)#0A...fillin(p+1,...bit)#0A...fillin(p-
len,.bit)#0A...fillin(p+len,.bit)#0A...fillin(p,...
..bit<<1)#0A...fillin(p,.....bit>>1)#0A$)#0A.#0AGLO
BAL.$(.point:.250;..north:.251;..west:.252;..pos:.2
53..$)#0A.#0AMANIFEST.$(.solid.#3D.TRUE;..cavity.#3D
.FALSE..$)#0A.#0ALET.nextpt().#3D.VALOF#0A$(.LET.bi
tpos..#3D.pos.REM.len#0A...AND.word....#3D.pos./.le
n#0A...pos.:#3D.pos.+.1#0A...RESULTIS.(datav!word.&
.1<<bitpos).#3D.0#0A$)#0A.#0ALET.cav1().#3D.VALOF#0A
$(.LET.cavcount,.nextid.#3D.0,.1#0A...LET.v.#3D.VEC
.len*len#0A#0A...point.:#3D.v..//...point.:#3D.getv
ec(len*len)#0A...west..:#3D.point.-.1#0A...north.:#3D
.point.-.len#0A...pos...:#3D.0#0A.#0A...FOR.p.#3D.0
.TO.len*len.DO.point!p.:#3D.0#0A.#0A...FOR.plane.#3D
.0.TO.upb.DO.FOR.p.#3D.0.TO.len*len-1.TEST.nextpt()
#3Dsolid#0A......THEN.point!p.:#3D.0#0A......ELSE.$
(.LET.pointid.#3D.nextid#0A..............AND.a.#3D.
point!p#0A..............AND.b.#3D.north!p#0A.......
.......AND.c.#3D.west!p#0A.#0A..............IF.0<a.
........DO.pointid.:#3D.a#0A..............IF.0<b<po
intid.DO.pointid.:#3D.b#0A..............IF.0<c<poin
tid.DO.pointid.:#3D.c#0A.#0A..............TEST.poin
tid#3Dnextid#0A..............THEN.$(.nextid.:#3D.ne
xtid.+.1#0A......................cavcount.:#3D.cavc
ount.+.1#0A...................$)#0A..............EL
SE.$(.IF.a>pointid.......DO.$(.rename(a,.pointid)#0A
...............................................cavc
ount.:#3D.cavcount-1#0A............................
................$)#0A......................IF.north
!p>pointid.DO.$(.rename(b,.pointid)#0A.............
..................................cavcount.:#3D.cav
count-1#0A.........................................
...$)#0A......................IF.west!p.>pointid.DO
.$(.rename(c,.pointid)#0A..........................
.....................cavcount.:#3D.cavcount-1#0A...
.........................................$)#0A.....
..............$)#0A...............point!p.:#3D.poin
tid#0A............$)#0A.#0A...RESULTIS.cavcount#0A$
)#0A.#0AAND.rename(oldid,.newid).BE#0A...FOR.p.#3D.
point.TO.point+len*len.DO#0A.......IF.!p#3Doldid.DO
.!p.:#3D.newid#0A.#0A.#0ALET.start().#3D.VALOF#0A$(
.LET.v.#3D.VEC.datavupb#0A...#0A...writes("Cavity.p
roblem*n")#0A.#0A...datav.:#3D.v..//.getvec(datavup
b)#0A...datat.:#3D.datav.+.datavupb#0A.#0A...setdat
a(10);.pr()#0A...setdata(20);.pr()#0A...setdata(30)
;.pr()#0A...setdata(40);.pr()#0A...setdata(50);.pr(
)#0A...RESULTIS.0#0A$)#0A.#0AAND.setdata(proportion
).BE#0A$(.FOR.p.#3D.datav.TO.datat.DO.!p.:#3D.0#0A.
..FOR.i.#3D.1.TO.upb-1.DO#0A.......FOR.j.#3D.1.TO.u
pb-1.DO#0A.......$(.LET.p.#3D.datav.+.i*len.+.j#0A.
.........FOR.bit.#3D.1.TO.upb-1.DO#0A.............I
F.randno(100)<proportion.DO.!p.:#3D.!p.|.1<<bit#0A.
......$)#0A$)#0A.#0AAND.random(n).#3D..2147001325*n
.+.715136305#0A#0AAND.randno(upb).#3D.VALOF#0A$(.ST
ATIC.$(.seed#3D32415..$)#0A...seed.:#3D.random(seed
)#0A...RESULTIS.(seed/3.>>.1).REM.upb.+.1#0A$)#0A.#0A
AND.pr().BE#0A$(.FOR.i.#3D.0.TO.upb.DO#0A...$(.FOR.
j.#3D.0.TO.upb.DO#0A......$(.LET.p.#3D.datav.+.i*le
n.+.j#0A.........FOR.bit.#3D.0.TO.upb.DO.writes((!p
.&.1<<bit)#3D0.->."#2E.",."**.")#0A.........newline
()#0A......$)#0A......newline()#0A...$)#0A...newlin
e()#0A...writef("Number.of.cavities.(by.cav1).is.%n
*n*n",.cav1())#0A...writef("Number.of.cavities.(by.
cav2).is.%n*n*n",.cav2())#0A$)#0A.#0A

######bcplprogs/demos/cobench.b#
//.This.is.a.benchmark.program.for.the.coroutine.me
chanism#0A#0A//.Implemented.in.BCPL.by.Martin.Richa
rds.(c).March.2004#0A#0ASECTION."cobench"#0A#0AGET.
"libhdr"#0A#0AGLOBAL.{#0A..kill_co:.ug........//.Th
e.killer.coroutine#0A..source_co#0A..tracing#0A}#0A
#0ALET.start().#3D.VALOF#0A{.LET.argv.#3D.VEC.50#0A
..LET.k,.n.#3D.10_000,.500#0A..LET.cptr.#3D.0#0A#0A
..UNLESS.rdargs("-k,-n,-t/S",.argv,.50).DO#0A..{.wr
itef("Bad.arguments.for.cobench*n")#0A....RESULTIS.
0#0A..}#0A#0A..IF.argv!0.&.string#2Eto#2Enumber(arg
v!0).DO.k.:#3D.result2.//.-k#0A..IF.argv!1.&.string
#2Eto#2Enumber(argv!1).DO.n.:#3D.result2.//.-n#0A..
tracing.:#3D.argv!2................................
....//.-t#0A#0A..writef("*nCobench.sending.%n.numbe
rs.via.%n.copy.coroutines*n*n",.k,.n)#0A#0A..kill_c
o.:#3D.createco(deleteco,.150)#0A#0A..cptr.:#3D.cre
ateco(sinkfn,.150)#0A#0A..FOR.i.#3D.1.TO.n.DO#0A..{
.LET.co.#3D.createco(copyfn,.150)#0A....callco(co,.
cptr)#0A....cptr.:#3D.co#0A..}#0A#0A..source_co.:#3D
.createco(sourcefn,.150)#0A..callco(source_co,.cptr
)#0A#0A..IF.tracing.DO.writef("All.coroutines.creat
ed*n*n")#0A#0A..callco(source_co,.k).//.Tell.source
co.to.send.k.numbers.#0A#0A..deleteco(kill_co)#0A#0A
..writef("*nCobench.done*n")#0A..RESULTIS.0#0A}#0A#0A
AND.sourcefn(nextco).BE#0A{.LET.k.#3D.cowait()#0A..
LET.channel.#3D.0#0A..LET.out_chan_ptr.#3D.@channel
#0A#0A..callco(nextco,.out_chan_ptr)#0A.#0A..//IF.t
racing.DO#0A..//..writef("srcefn:.co#3D%n.out_chan_
ptr#3D%n.k#3D%n*n*n",#0A..//..........currco,.out_c
han_ptr,.k)#0A#0A..FOR.val.#3D.1.TO.k.DO#0A..{.IF.t
racing.DO.writef("srcefn:.sending.number.%n*n",.val
)#0A....cowrite(out_chan_ptr,.val)#0A..}#0A..IF.tra
cing.DO.writef("srcefn:.sending.number.0*n")#0A..co
write(out_chan_ptr,.0)#0A..//IF.tracing.DO.writef("
srcefn:.dying*n")#0A..die()#0A}#0A#0AAND.copyfn(nex
tco).BE#0A{.LET.channel.#3D.0#0A..LET.in_chan_ptr,.
out_chan_ptr.#3D.cowait(),.@channel#0A#0A..callco(n
extco,.out_chan_ptr)#0A#0A..{.LET.val.#3D.coread(in
_chan_ptr)#0A....IF.tracing.DO.writef("copyfn:.copy
ing.number.%n*n",.val)#0A....cowrite(out_chan_ptr,.
val)#0A....UNLESS.val.BREAK#0A..}.REPEAT#0A#0A..//I
F.tracing.DO.writef("copyfn:.dying*n")#0A..die()#0A
}#0A#0AAND.sinkfn(in_chan_ptr).BE#0A{.//IF.tracing.
DO.writef("sinkfn:...co#3D%n.in_chan_ptr#3D%n*n",#0A
..//......................currco,.in_chan_ptr)#0A#0A
..{.LET.val.#3D.coread(in_chan_ptr)#0A....IF.tracin
g.DO.writef("sinkfn:.recving.number.%n*n",.val)#0A.
...UNLESS.val.BREAK#0A..}.REPEAT#0A#0A..//IF.tracin
g.DO.writef("sinkfn:.dying*n")#0A#0A..die()#0A}#0A#0A
AND.coread(ptr).#3D.VALOF#0A{.LET.cptr.#3D.!ptr#0A.
.TEST.cptr#0A..THEN.{.!ptr.:#3D.0.........//.Clear.
the.channel.word#0A.........RESULTIS.resumeco(cptr,
.currco)#0A.......}#0A..ELSE.{.!ptr.:#3D.currco....
//.Set.channel.word.to.this.coroutine#0A.........RE
SULTIS.cowait().//.Wait.for.value.from.cowrite#0A..
.....}#0A}#0A#0AAND.cowrite(ptr,.val).BE#0A{.LET.cp
tr.#3D.!ptr#0A..TEST.cptr#0A..THEN.{.!ptr.:#3D.0#0A
.........callco(cptr,.val).//.Send.val.to.coread#0A
.......}#0A..ELSE.{.!ptr.:#3D.currco#0A..........ca
llco(cowait(),.val)#0A.......}#0A}#0A#0AAND.die().B
E.resumeco(kill_co,.currco)#0A#0A#0A

######bcplprogs/demos/coins.b#
SECTION."COINS"#0A.#0AGET."libhdr"#0A.#0ALET.coins(
sum).#3D.c(sum,.(TABLE.200,.100,.50,.20,.10,.5,.2,.
1))#0A.#0AAND.c(sum,.t).#3D.sum<0.->.0,#0A.........
.......sum#3D0.|.!t#3D1.->.1,#0A................c(s
um,.t+1).+.c(sum-!t,.t)#0A.#0ALET.start().#3D.VALOF
#0A{.writes("Coins.problem*n")#0A.#0A..t(0)#0A..t(1
)#0A..t(2)#0A..t(5)#0A..t(21)#0A..t(100)#0A..t(200)
#0A..RESULTIS.0#0A}#0A.#0AAND.t(n).BE.writef("Sum.#3D
.%i3..number.of.ways.#3D.%i6*n",.n,.coins(n))#0A

######bcplprogs/demos/condcomp.b#
/*.This.is.a.demonstration.of.the.conditional#0A...
compilation.features.of.BCPL#0A*/#0A#0AGET."libhdr"
#0A#0ALET.start().#3D.VALOF#0A{.writef("Conditional
.compilation.demonstration*n*n")#0A#0A//.All.condit
ional.compilation.tags.are.initially.false#0A#0A$<X
YZ#0A..writef("1:.Tag.XYZ.should.be.false.here*n")#0A
$>XYZ#0A#0A$$XYZ...//.Set.the.XYZ.tag.to.true#0A#0A
$<XYZ#0A..writef("2:.Tag.XYZ.should.be.true.here*n"
)#0A$>XYZ#0A#0A$$XYZ...//.Complement.the.XYZ.tag.#0A
#0A$<XYZ#0A..writef("3:.Tag.XYZ.should.be.false.her
e*n")#0A$>XYZ#0A#0A$$Linux.....//.Set.the.Linux.con
ditional.compilation.tag#0A$$WinNT#0A#0A$<Linux#0A.
.//.The.following.lines.are.skipped.if.the.Linux.ta
g.is.unset#0A..$<WinNT.$$WinNT.$>WinNT..//.Unset.th
e.WinNT.tag.if.set#0A..writef("This.was.compiled.fo
r.Linux*n")#0A$>Linux#0A$<WinNT#0A..//.Include.only
.if.the.WinNT.tag.is.set#0A..writef("This.was.compi
led.for.Windows.NT*n")#0A$>WinNT#0AFINISH#0A..RESUL
TIS.0#0A}#0A#0A$<WinNT#0A//.This.material.should.be
.skipped.until.EOF#0A//.without.complaining.about.t
he.missing.$>WinNT#0A

######bcplprogs/demos/coprimes.b#
SECTION."coprimes"#0A#0AGET."libhdr"#0A#0AMANIFEST.
$(.upb.#3D.4000.$)#0A#0ALET.prime2().#3D.VALOF#0A$(
.LET.n.#3D.2...#0A...$(.LET.a,.b.#3D1,.3.REM.n.....
.#0A......FOR.i.#3D.2.TO.n.DO.#0A......$(.LET.c.#3D
.(a+b).REM.n...........................#0A.........
a.:#3D.b...........................#0A.........b.:#3D
.c........................#0A......$)......#0A.....
.IF.a#3D1.DO.cowait(n)......#0A......n.:#3D.n+1...#0A
...$).REPEAT#0A$)#0A#0AAND.prime1().#3D.VALOF#0A$(.
LET.isprime.#3D.getvec(upb)...#0A...FOR.i.#3D.2.TO.
upb.DO.isprime!i.:#3D.TRUE..//.Until.proved.otherwi
se#2E....#0A...FOR.p.#3D.2.TO.upb.IF.isprime!p.DO..
.#0A...$(.LET.i.#3D.p*p......#0A......UNTIL.i>upb.D
O.$(.isprime!i.:#3D.FALSE;.i.:#3D.i.+.p.$)......#0A
......cowait(p)...#0A...$)...#0A...freevec(isprime)
...#0A...RESULTIS.0#0A$)#0A#0ALET.start().BE#0A$(.L
ET.P1.#3D.createco(prime1,.100)...#0A...LET.P2.#3D.
createco(prime2,.100)...#0A...LET.x1,.x2,.val,.coun
t.#3D.0,.0,.0,.0...#0A...$(.IF.x1#3Dval.DO.x1.:#3D.
callco(P1)......#0A......IF.x2#3Dval.DO.x2.:#3D.cal
lco(P2)......#0A......val.:#3D.x1<x2.->.x1,.x2.....
.#0A......IF.val#3D0.|.intflag().BREAK......#0A....
..IF.count.REM.10.#3D.0.DO.newline()......#0A......
writef(".%i4%c",.val,.val<x1.->.'F',.val<x2.->.'P',
.'.')......#0A......UNLESS.x1#3Dx2.DO.wrch(7)......
#0A......count.:#3D.count+1...#0A...$).REPEAT...#0A
...newline()...#0A...deleteco(P1)...#0A...deleteco(
P2)#0A$)#0A#0A

######bcplprogs/demos/cosim.b#
//.A.Discrete.event.simulation.benchmark.#0A//.Desi
gned.and.implemented.by.Martin.Richards.(c).June.20
04.#0A#0A//.This.is.a.benchmark.test.for.a.discrete
.event.simulator.using#0A//.BCPL.style.coroutines#2E
.It.simulates.a.network.of.n.nodes.which#0A//.each.
receive,.queue,.process.and.transmit.messages.to.ot
her.nodes#2E#0A//.The.nodes.are.uniformly.spaced.on
.a.straight.line.and.the.network#0A//.delay.is.assu
med.to.be.proportional.to.the.linear.distance.betwe
en#0A//.the.source.and.the.destination#2E.On.arriva
l,.if.the.receiving.node.is#0A//.busy.the.message.i
s.queued,.otherwise.it.is.processed.immediately#2E#0A
//.After.processing.the.message.for.random.time.it.
is.sent.to.another#0A//.random.node#2E.If.the.node.
has.a.non.empty.queue.it.dequeues.its.first#0A//.me
ssage.and.starts.to.process.it,.otherwise.it.become
s.suspended#2E#0A//.Initially.every.node.is.process
ing.a.message.and.every.queue.is#0A//.empty#2E.Ther
e.are.n.coroutines.to.simulate.the..progress.of.eac
h#0A//.message.and.the.discrete.event.priority.queu
e.is.implemented.using#0A//.the.heapsort.heap.struc
ture#2E.The.simulation.stops.at.a.specified#0A//.si
mulated.time#2E.The.result.is.the.number.of.message
s.that.have.been#0A//.processed#2E.A.machine.indepe
ndent.random.number.generator.is.used#0A//.so.the.r
esulting.value.should.be.indepent.of.implementation
#0A//.language.and.machine.being.used#2E#0A#0A//.Sp
ecial.comment.lines.have.been.included,.eg:#0A#0A//
........IF.j<priqn.&.min>priq!(j+1)!0.DO.j.:#3D.j+1
#0A//......//...^7499862..^7463825............^3477
178#0A#0A//.These.give.counts.of.how.many.times.the
.statements.above#0A//.the.^s.were.executed.when.co
sim.was.run#2E.These.counts#0A//.were.obtained.usin
g.the.stats.command#2E#0A#0ASECTION."cosim"#0A#0AGE
T."libhdr"#0A#0AGLOBAL.{#0A..priq:ug....//.The.vect
or.holding.the.priority.queue#0A..priqupb....//.The
.upper.bound#0A..priqn......//.Number.of.items.in.t
he.priority.queue#0A..wkqv.......//.The.vector.of.w
ork.queues#0A..count......//.count.of.messages.proc
essed#0A..nodes......//.The.number.of.nodes#0A..ptm
ax......//.The.maximum.processing.time#0A..stopco..
...//.The.stop.coroutine#0A..cov........//.Vector.o
f.message.coroutines#0A..ranv.......//.A.vector.use
d.by.the.random.number.generator#0A..rani;.ranj.//.
subscripts.of.ranv#0A..simtime....//.Simulated.time
#0A..stoptime...//.Time.to.stop.the.simulation#0A..
tracing#0A#0A//.Functions#0A..rnd#0A..initrnd#0A..c
losernd#0A..prq#0A..insertevent#0A..upheap#0A..down
heap#0A..getevent#0A..waitfor#0A..prwaitq#0A..qitem
#0A..dqitem#0A..stopcofn#0A..messcofn#0A}#0A#0A//.#23
#23#23#23#23#23#23#23#23#23#23#23#23#23#23#23#23#23
#23.Random.number.generator.#23#23#23#23#23#23#23#23
#23#23#23#23#23#23#23#23#23#23#23#23#23#23#23#0A#0A
//.The.following.random.number.generator.is.based.o
n.one.give#0A//.in.Knuth:.The.art.of.programming,.v
ol.2,.p.26#2E#0ALET.rnd(n).#3D.VALOF#0A{.LET.val.#3D
.(ranv!rani.+.ranv!ranj).&.#23x_FFF_FFFF#0A//^10043
10#0A..ranv!rani.:#3D.val#0A..rani.:#3D.(rani.+.1).
MOD.55#0A..ranj.:#3D.(ranj.+.1).MOD.55#0A..RESULTIS
.val.MOD.n#0A}#0A#0AAND.initrnd(seed).#3D.VALOF#0A{
.LET.a,.b.#3D.#23x_234_5678+seed,.#23x_536_2781#0A/
/^1#0A..ranv.:#3D.getvec(54)#0A..UNLESS.ranv.RESULT
IS.FALSE#0A..FOR.i.#3D.0.TO.54.DO#0A..{.LET.t.#3D.(
a+b).&.#23x_FFF_FFFF#0A//..^55#0A....a.:#3D.b#0A...
.b.:#3D.t#0A....ranv!i.:#3D.t#0A..}#0A..rani,.ranj.
:#3D.55-55,.55-24..//.ie:.0,.31#0A//^1#0A..RESULTIS
.TRUE#0A}#0A#0AAND.closernd().BE.IF.ranv.DO.freevec
(ranv)#0A//................^1.........^1#0A#0A//.#23
#23#23#23#23#23#23#23#23#23#23#23#23#23#23#23#23#23
#23.Priority.Queue.functions.#23#23#23#23#23#23#23#23
#23#23#23#23#23#23#23#23#23#23#23#23#23#23#0A#0AAND
.prq().BE#0A{.FOR.i.#3D.1.TO.priqn.DO.writef(".%i4"
,.priq!i!0)#0A//^0#0A..newline()#0A}#0A#0AAND.inser
tevent(event).BE#0A{.priqn.:#3D.priqn+1........//.I
ncrement.number.of.events#0A//^1004063#0A..//writef
("insertevent:.at.time:.%n..co#3D%n*n",.event!0,.ev
ent!1)#0A..upheap(event,.priqn)#0A}#0A#0AAND.upheap
(event,.i).BE#0A{.LET.eventtime.#3D.event!0#0A//^20
07777#0A//writef("upheap:.eventtime#3D%n.i#3D%n*n",
.eventtime,.i)#0A#0A..{.LET.p.#3D.i/2..........//.P
arent.of.i#0A//..^3066788#0A....UNLESS.p.&.eventtim
e.<.priq!p!0.DO#0A//.............^3064920#0A....{.p
riq!i.:#3D.event#0A//....^2007777#0A//prq()#0A.....
.RETURN#0A....}#0A....priq!i.:#3D.priq!p.....//.Dem
ote.the.parent#0A//..^1059011#0A//prq()#0A....i.:#3D
.p#0A..}.REPEAT#0A}#0A#0AAND.downheap(event,.i).BE#0A
{.LET.j,.min.#3D.2*i,.?.//.j.is.left.child,.if.pres
ent#0A//^8503576#0A//writef("downheap:.eventtime#3D
%n.i#3D%n*n",.event!0,.i)#0A//prq()#0A..IF.j.>.priq
n.DO#0A..{.upheap(event,.i)#0A//..^1003714#0A....RE
TURN#0A..}#0A..min.:#3D.priq!j!0#0A//^7499862#0A../
/.Look.at.other.child,.if.it.exists#0A..IF.j<priqn.
&.min>priq!(j+1)!0.DO.j.:#3D.j+1#0A//...^7499862..^
7463825............^3477178#0A..//.promote.earlier.
child#0A..priq!i.:#3D.priq!j#0A//^7499862#0A..i.:#3D
.j#0A}.REPEAT#0A#0AAND.getevent().#3D.VALOF#0A{.LET
.event.#3D.priq!1......//.Get.the.earliest.event#0A
//^1003714#0A..LET.last..#3D.priq!priqn..//.Get.the
.event.at.the.end.of.the.heap#0A//writef("getevent:
.priq:")#0A//prq()#0A..UNLESS.priqn>0.RESULTIS.0.//
.No.events.in.the.priority.queue#0A//..............
.^0#0A..priqn.:#3D.priqn-1........//.Decrement.the.
heap.size#0A//^1003714#0A..downheap(last,.1).......
//.Re-insert.last.event#0A..RESULTIS.event#0A}#0A#0A
AND.waitfor(ticks).BE#0A{.//.Make.an.event.item.int
o.the.priority.queue#0A..LET.eventtime,.co.#3D.simt
ime+ticks,.currco#0A//^1004063#0A//writef("waitfor:
.simtime#3D%n.ticks#3D%n*n",.simtime,.ticks)#0A..in
sertevent(@eventtime).//.Insert.into.the.priority.q
ueue#0A..cowait()................//.Wait.for.the.sp
ecified.number.of.ticks#0A}#0A#0A//.#23#23#23#23#23
#23#23#23#23#23#23#23#23#23#23#23#23#23#23#23#23#23
.Queueing.functions.#23#23#23#23#23#23#23#23#23#23#23
#23#23#23#23#23#23#23#23#23#23#23#23#23#23#0A#0AAND
.prwaitq(node).BE#0A{.LET.p.#3D.wkqv!node#0A//^0#0A
//abort(997)#0A..IF.-1.<#3D.p.<#3D.0.DO.{.writef("w
kq.for.node.%n:.%n*n",.node,.p);.RETURN.}#0A..write
f("wkq.for.node.%n:",.node)#0A..WHILE.p.DO#0A..{.wr
itef(".%n",.p!1)#0A....p.:#3D.!p#0A..}#0A..newline(
)#0A}#0A#0AAND.qitem(node).BE#0A//.The.message.has.
reached.this.node#0A//.I.currently.not.busy,.mark.a
s.busy.and.return.to.process#0A//.the.message,.othe
r.append.it.to.the.end.of.the.work.queue#0A//.for.t
his.node#2E#0A{.//.Make.a.queue.item#0A..LET.link,.
co.#3D.0,.currco#0A//^502305#0A..LET.p.#3D.wkqv!nod
e#0A//writef("qitem:.entered*n")#0A//prwaitq(node)#0A
..UNLESS.p.DO#0A..{.//.The.node.was.not.busy#0A....
wkqv!node.:#3D.-1..//.Mark.node.as.busy#0A//..^2516
11#0A....IF.tracing.DO#0A......writef("%i8:.node.%i
4:.node.not.busy*n",.simtime,.node)#0A//....^0#0A//
writef("qitem:.wkqv!%n#3D%n*n",.node,.wkqv!node)#0A
....//prwaitq(node)#0A//abort(998)#0A....RETURN#0A/
/..^251611#0A..}#0A..//.Append.item.to.the.end.of.t
his.queue#0A//abort(1000)#0A..IF.tracing.DO#0A//.^2
50694#0A....writef("%i8:.node.%i4:.busy.so.appendin
g.message.to.end.of.work.queue*n",#0A............si
mtime,.node)#0A//..^0#0A//abort(1000)#0A..TEST.p#3D
-1#0A//^250694#0A..THEN.wkqv!node.:#3D.@link.....//
.Form.a.unit.list#0A//.....^146286#0A..ELSE.{.WHILE
.!p.DO.p.:#3D.!p..//.Find.the.end.of.the.wkq#0A//..
.....^104408.....^61303#0A.........!p.:#3D.@link...
.......//.Append.to.end.of.wkq#0A//.......^104408#0A
.......}#0A..//prwaitq(node)#0A..cowait().//.Wait.t
o.be.activated.(by.dqitem)#0A//^250694#0A}#0A#0AAND
.dqitem(node).BE#0A//.A.message.has.just.been.proce
ssed.by.this.node.and.is.ready.to.process#0A//.the.
next,.if.any#2E#0A{.LET.item.#3D.wkqv!node.//.Curre
nt.item.(~#3D0)#0A//^501907#0A//writef("dqitem(%n):
.entered,.item#3D%n*n",.node,.item)#0A..UNLESS.item
.DO.abort(999)#0A//...............^0#0A//prwaitq(no
de)#0A..TEST.item#3D-1#0A//^501907#0A..THEN.wkqv!no
de.:#3D.0..................//.The.node.is.no.longer
.busy#0A//.....^251363#0A..ELSE.{.LET.next.#3D.item
!0#0A//.......^250544#0A.........AND.co...#3D.item!
1#0A.........wkqv!node.:#3D.next.->.next,.-1.//.De-
queue.the.item#0A//............................^104
356^146188#0A//prwaitq(node)#0A.........callco(co).
...................//.Process.the.next.message#0A//
.......^250544#0A.......}#0A}#0A#0A//.#23#23#23#23#23
#23#23#23#23#23#23#23#23#23#23#23#23#23#23#23#23#23
#23#23.Coroutine.Bodies.#23#23#23#23#23#23#23#23#23
#23#23#23#23#23#23#23#23#23#23#23#23#23#23#23#23#23
#0A#0AAND.stopcofn(arg).#3D.VALOF#0A{.waitfor(stopt
ime)#0A//^1#0A..IF.tracing.DO#0A....writef("%i8:.St
op.time.reached*n",.simtime)#0A//..^0#0A..RESULTIS.
0#0A//^1#0A}#0A.#0AAND.messcofn(node).#3D.VALOF#0A{
.qitem(node)...//.Put.the.message.on.the.work.queue
.for.this.node#0A//^500#0A#0A..{.//.Start.processin
g.the.first.message#0A....LET.prtime...#3D.rnd(ptma
x).....//.a.random.processing.time#0A//..^502155#0A
....LET.dest.....#3D.rnd(nodes).+.1.//.a.random.des
tination.node#0A....LET.netdelay.#3D.ABS(node-dest)
.//.the.network.delay#0A#0A//writef("prtime#3D%i3.d
est#3D%i3*n",.prtime,.dest)#0A//abort(1001)#0A....I
F.tracing.DO#0A......writef("%i8:.node.%i4:.process
ing.message.until.%n*n",#0A..............simtime,.n
ode,.simtime+prtime)#0A//....^0#0A....waitfor(prtim
e)#0A//..^502155#0A....count.:#3D.count.+.1.//.One.
more.message.processed#0A//..^501907#0A....IF.traci
ng.DO#0A......writef("%i8:.node.%i4:.message.proces
sed*n",#0A..............simtime,.node,.dest,.simtim
e+netdelay)#0A//....^0#0A#0A//prwaitq(node)#0A....d
qitem(node).//.De-queue.current.item.and.activate.t
he.next,.if.any#0A//..^501907#0A//prwaitq(node)#0A.
...IF.tracing.DO#0A......writef("%i8:.node.%i4:.sen
ding.message.to.node.%n.to.arrive.at.%n*n",#0A.....
.........simtime,.node,.dest,.simtime+netdelay)#0A/
/....^0#0A#0A....waitfor(netdelay)#0A//..^501907#0A
....node.:#3D.dest......//.The.message.has.arrived.
at.the.destination.node#0A//..^501805#0A....IF.trac
ing.DO#0A......writef("%i8:.node.%i4:.message.reach
ed.this.node*n",#0A..............simtime,.node)#0A/
/....^0#0A....qitem(node)...//.Queue.the.message.if
.necessary#0A//..^500636#0A....//.The.node.can.now.
process.the.first.message.on.its.work.queue#0A..}.R
EPEAT#0A//..^500469#0A}#0A//.#23#23#23#23#23#23#23#23
#23#23#23#23#23#23#23#23#23#23#23#23#23#23#23#23#23
.Main.Program.#23#23#23#23#23#23#23#23#23#23#23#23#23
#23#23#23#23#23#23#23#23#23#23#23#23#23#23#23#0A#0A
LET.start().#3D.VALOF#0A{.LET.seed.#3D.0#0A//^1#0A.
.LET.argv.#3D.VEC.50#0A//abort(1002)#0A#0A..UNLESS.
rdargs("-n,-s,-p,-r,-t/S",.argv,.50).DO#0A//.......
^1#0A..{.writef("Bad.arguments.for.cosim*n")#0A//..
^0#0A....RESULTIS.0#0A..}#0A#0A..nodes,.stoptime,.p
tmax.:#3D.500,.1_000_000,.1000#0A//^1#0A..IF.argv!0
.&.string_to_number(argv!0).DO.nodes....:#3D.result
2.//.-k#0A//...^1.......^0.........................
.^0#0A..IF.argv!1.&.string_to_number(argv!1).DO.sto
ptime.:#3D.result2.//.-s#0A//...^1.......^0........
..................^0#0A..IF.argv!2.&.string_to_numb
er(argv!2).DO.ptmax....:#3D.result2.//.-p#0A//...^1
.......^0..........................^0#0A..IF.argv!3
.&.string_to_number(argv!3).DO.seed.....:#3D.result
2.//.-r#0A//...^1.......^0.........................
.^0#0A..tracing.:#3D.argv!4........................
...................//.-t#0A//^1#0A..writef("*nCosim
.entered*n*n")#0A..writef("Network.nodes:.......%n*
n",.nodes)#0A..writef("Stop.time:...........%n*n",.
stoptime)#0A..writef("Max.processing.time:.%n*n",.p
tmax)#0A..writef("Random.number.seed:..%n*n",.seed)
#0A..newline()#0A#0A..UNLESS.initrnd(seed).DO#0A..{
.writef("Can't.initialise.the.random.number.generat
or*n")#0A//..^0#0A....RESULTIS.0#0A..}#0A#0AIF.FALS
E.DO#0A..FOR.i.#3D.1.TO.100.DO.//.Test.the.random.n
umber.generator#0A..{.writef(".%i4",.rnd(10000))#0A
....IF.i.MOD.10.#3D.0.DO.newline()#0A..}#0A#0A..sto
pco.:#3D.0#0A//^1#0A..wkqv,.priq,.cov.:#3D.getvec(n
odes),.getvec(nodes+1),.getvec(nodes)#0A..UNLESS.wk
qv.&.priq.&.cov.DO..#0A..{.writef("Can't.allocate.s
pace.for.the.node.work.queues*n")#0A//..^0#0A....GO
TO.ret#0A..}#0A#0A..FOR.i.#3D.1.TO.nodes.DO.wkqv!i,
.cov!i.:#3D.0,.0#0A//^1....................^500#0A.
.priqn.:#3D.0..//.Number.of.events.in.the.priority.
queue#0A//^1#0A..count.:#3D.0..//.Count.of.message.
processed#0A..simtime.:#3D.0.//.Simulated.time#0A#0A
..IF.tracing.DO.writef("%i8:.Starting.simulation*n"
,.simtime)#0A//..............^0#0A#0A//writef("rnd(
10000)#3D%n*n",.rnd(10000))#0A..//.Create.and.start
.the.stop.coroutine#0A..stopco.:#3D.createco(stopco
fn,.200)#0A//^1#0A..IF.stopco.DO.callco(stopco)#0A/
/.............^1#0A..//.Create.and.start.the.messag
e.coroutines#0A..FOR.i.#3D.1.TO.nodes.DO#0A//^1#0A.
.{.LET.co.#3D.createco(messcofn,.200)#0A//..^500#0A
....IF.co.DO.callco(co,.i)#0A//...........^500#0A..
..cov!i.:#3D.co#0A//..^500#0A..}#0A#0A..//.Run.the.
event.loop#0A#0A..{.LET.event.#3D.getevent()....../
/.Get.the.earliest.event#0A//..^1003714#0A....UNLES
S.event.BREAK#0A//...............^0#0A....simtime.:
#3D.event!0..........//.Set.the.simulated.time#0A..
..//IF.tracing.DO.writef("%i8:.calling.co#3D%n*n",.
simtime,.event!1)#0A....IF.simtime.>.stoptime.BREAK
#0A//........................^1#0A....callco(event!
1)#0A//..^1003713#0A..}.REPEAT#0A#0A..IF.tracing.DO
.writef("*nSimulation.stopped*n*n")#0A//^1.........
...^0#0A..writef("Messages.processed:.%n*n",.count)
#0A//^1#0A#0Aret:#0A..FOR.i.#3D.nodes.TO.1.BY.-1.IF
.cov!i.DO.deleteco(cov!i)#0A//^1...................
....^500........^500#0A..IF.cov....DO.freevec(cov)#0A
//^1...........^1#0A..IF.wkqv...DO.freevec(wkqv)#0A
//^1...........^1#0A..IF.priq...DO.freevec(priq)#0A
//^1...........^1#0A..IF.stopco.DO.deleteco(stopco)
#0A//^1...........^1#0A..closernd()#0A//^1#0A..RESU
LTIS.0#0A#0Afail:#0A..writef("Unable.to.initialise.
the.simulator*n")#0A//^0#0A..GOTO.ret#0A}#0A#0A//.T
otal.number.of.Cintcode.instructions.executed:.435,
363,350#0A//.Number.of.coroutine.changes:..........
............2,510,520#0A

######bcplprogs/demos/cotest.b#
//.This.tests.the.functionality.of.the.coroutine.#0A
//.functions:.callco,.cowait.and.resumeco#2E#0A#0A/
/.Implemented.by.Martin.Richards.(c).April.2005#0A#0A
SECTION."cotest"#0A#0AGET."libhdr"#0A#0AGLOBAL.{.a_
co:ug;.b_co;.c_co;.d_co.}#0A#0ALET.start().#3D.VALO
F#0A{.a_co.:#3D.createco(a_fn,.200)#0A..b_co.:#3D.c
reateco(b_fn,.200)#0A..c_co.:#3D.createco(c_fn,.200
)#0A..d_co.:#3D.createco(d_fn,.200)#0A#0A..writef("
*nTest:.root.->.a.->.root*n")#0A..writef("root:.cal
ling.callco(a_co,..100)*n")#0A..writef("root:.callc
o(a_co,..100).#3D>.%n*n",.callco(a_co,.100))#0A#0A.
.writef("*nTest:.root.->.a.->.root,.ie.check:.c:#3D
fn(cowait(c)).REPEAT*n")#0A..writef("root:.calling.
callco(a_co,..200)*n")#0A..writef("root:.callco(a_c
o,..200).#3D>.%n*n",.callco(a_co,.200))#0A#0A..writ
ef("*nTest:.root.->.b.->.a.->.b.->.root*n")#0A..wri
tef("root:.calling.callco(b_co,..300)*n")#0A..write
f("root:.callco(a_co,..300).#3D>.%n*n",.callco(b_co
,.300))#0A#0A..writef("*nTest:.root.->.b.->.a.->.b.
->.root..again*n")#0A..writef("root:.calling.callco
(b_co,..400)*n")#0A..writef("root:.callco(b_co,..40
0).#3D>.%n*n",.callco(b_co,.400))#0A#0A..writef("*n
Test:.root.->.c.->.a.->.root,.ie.check.resumeco.in.
c_co*n")#0A..writef("root:.calling.callco(c_co,..50
0)*n")#0A..writef("root:.callco(c_co,..500).#3D>.%n
*n",.callco(c_co,.500))#0A#0A..writef("*nTest:.root
.->.c.->.root*n")#0A..writef("root:.calling.callco(
c_co,..600)*n")#0A..writef("root:.callco(c_co,..600
).#3D>.%n*n",.callco(c_co,.600))#0A#0A..writef("*nT
est:.root.->.d.->.d.->.root,.ie.can.resumeco.call.i
tself*n")#0A..writef("root:.calling.callco(d_co,..7
00)*n")#0A..writef("root:.callco(d_co,..700).#3D>.%
n*n",.callco(d_co,.700))#0A#0A..deleteco(a_co)#0A..
deleteco(b_co)#0A..deleteco(c_co)#0A..deleteco(d_co
)#0A#0A..writef("*nEnd.of.test*n")#0A..RESULTIS.0#0A
}#0A#0AAND.a_fn(x).#3D.VALOF#0A{.writef("a_co:.ente
red.with.value.%n*n",.x)#0A..writef("a_co:.returnin
g.%n*n",.x+10)#0A..RESULTIS.x+10#0A}#0A#0AAND.b_fn(
x).#3D.VALOF#0A{.writef("b_co:.entered.with.value.%
n*n",.x)#0A..writef("b_co:.calling.callco(a_co,.200
0)*n")#0A..writef("b_co:.callco(a_co,.2000).#3D>.%n
*n",.callco(a_co,.2000))#0A..writef("b_co:.returnin
g.%n*n",.x+20)#0A..RESULTIS.x+20#0A}#0A#0AAND.c_fn(
x).#3D.VALOF#0A{.writef("c_co:.entered.with.value.%
n*n",.x)#0A..writef("c_co:.calling.resumeco(a_co,.3
000)*n")#0A..writef("c_co:.resumeco(a_co,.3000).#3D
>.%n*n",.resumeco(a_co,3000))#0A..writef("c_co:.ret
urning.%n*n",.x+30)#0A..RESULTIS.x+30#0A}#0A#0AAND.
d_fn(x).#3D.VALOF#0A{.writef("d_co:.entered.with.va
lue.%n*n",.x)#0A..writef("d_co:.calling.resumeco(d_
co,.4000)*n")#0A..writef("d_co:.resumeco(d_co,.4000
).#3D>.%n*n",.resumeco(d_co,4000))#0A..writef("d_co
:.returning.%n*n",.x+40)#0A..RESULTIS.x+40#0A}#0A#0A
/*.This.program.should.generate.the.following.outpu
t:#0A#0ATest:.root.->.a.->.root#0Aroot:.calling.cal
lco(a_co,..100)#0Aa_co:.entered.with.value.100#0Aa_
co:.returning.110#0Aroot:.callco(a_co,..100).#3D>.1
10#0A#0ATest:.root.->.a.->.root,.ie.check:.c:#3Dfn(
cowait(c)).REPEAT#0Aroot:.calling.callco(a_co,..200
)#0Aa_co:.entered.with.value.200#0Aa_co:.returning.
210#0Aroot:.callco(a_co,..200).#3D>.210#0A#0ATest:.
root.->.b.->.a.->.b.->.root#0Aroot:.calling.callco(
b_co,..300)#0Ab_co:.entered.with.value.300#0Ab_co:.
calling.callco(a_co,.2000)#0Aa_co:.enteredwith.valu
e.2000#0Aa_co:.returning.2010#0Ab_co:.callco(a_co,.
2000).#3D>.2010#0Ab_co:.returning.320#0Aroot:.callc
o(a_co,..300).#3D>.320#0A#0ATest:.root.->.b.->.a.->
.b.->.root..again#0Aroot:.calling.callco(b_co,..400
)#0Ab_co:.entered.with.value.400#0Ab_co:.calling.ca
llco(a_co,.2000)#0Aa_co:.entered.with.value.2000#0A
a_co:.returning.2010#0Ab_co:.callco(a_co,.2000).#3D
>.2010#0Ab_co:.returning.420#0Aroot:.callco(b_co,..
400).#3D>.420#0A#0ATest:.root.->.c.->.a.->.root,.ie
.check.resumeco.in.c_co#0Aroot:.calling.callco(c_co
,..500)#0Ac_co:.entered.with.value.500#0Ac_co:.call
ing.resumeco(a_co,.3000)#0Aa_co:.entered.with.value
.3000#0Aa_co:.returning.3010#0Aroot:.callco(c_co,..
500).#3D>.3010#0A#0ATest:.root.->.c.->.root#0Aroot:
.calling.callco(c_co,..600)#0Ac_co:.entered.with.va
lue.600#0Ac_co:.resumeco(a_co,.3000).#3D>.600#0Ac_c
o:.returning.530#0Aroot:.callco(c_co,..600).#3D>.53
0#0A#0ATest:.root.->.d.->.d.->.root,.ie.can.resumec
o.call.itself#0Aroot:.calling.callco(d_co,..700)#0A
d_co:.entered.with.value.700#0Ad_co:.calling.resume
co(d_co,.4000)#0Ad_co:.resumeco.called.#3D>.d_co#0A
d_co:.resumeco(d_co,.4000).#3D>.4000#0Ad_co:.return
ing.740#0Aroot:.callco(c_co,..700).#3D>.740#0A#0AEn
d.of.test#0A*/#0A#0A#0A

######bcplprogs/demos/countdn.b#
/*#0AThis.program.finds.the.set.of.numbers.that.can
.be.computed.from.a#0Agiven.set.of.up.to.6.numbers.
using.only.the.operations.plus,.minus,#0Atimes.and.
divide#2E.Each.number.can.only.be.used.once.and.all
.numbers#0Aand.intermediate.results.must.be.integra
l.and.in.the.range.0.to.999#2E#0A#0AWritten.in.BCPL
.by.Martin.Richards.(c).February.2000#0A*/#0A#0AGET
."libhdr"#0A#0AGLOBAL...{.v:200;.resv;.opstr;.vala;
.valb;.change;.outstream.}#0A#0AMANIFEST.{.Upb#3D99
9.}#0A#0ALET.start().#3D.VALOF#0A{.LET.argv.#3D.VEC
.50#0A..LET.oldout.#3D.output()#0A#0A..UNLESS.rdarg
s(",,,,,,TO/K",.argv,.50).DO#0A..{.writes("Bad.argu
ments.for.COUNTDN*n")#0A....RESULTIS.20#0A..}#0A#0A
..v,.resv.:#3D.getvec(63),.getvec(Upb)#0A..UNLESS.v
.&.resv.DO#0A..{.writes("Insufficient.space*n")#0A.
...GOTO.fin#0A..}#0A#0A..FOR.i.#3D.0.TO.63.DO.v!i.:
#3D.0.#0A..FOR.i.#3D.0.TO.Upb.DO.resv!i.:#3D.0#0A#0A
..FOR.i.#3D.0.TO.63.DO.#0A..{.LET.p.#3D.getvec(Upb)
#0A....UNLESS.p.DO#0A....{.writes("Insufficient.spa
ce*n")#0A......GOTO.fin#0A....}#0A....FOR.j.#3D.0.T
O.Upb.DO.p!j.:#3D.0#0A....v!i.:#3D.p#0A..}#0A#0A..o
utstream.:#3D.0#0A..IF.argv!6.DO.outstream.:#3D.fin
doutput(argv!6)#0A..IF.outstream.DO.selectoutput(ou
tstream)#0A#0A..FOR.i.#3D.0.TO.5.IF.argv!i.DO#0A..{
.LET.k.#3D.str2numb(argv!i)#0A....UNLESS.0<#3Dk<#3D
Upb.DO#0A....{.writef("Bad.number.%n.given*n",.k)#0A
......GOTO.fin#0A....}#0A....opstr,.vala,.valb.:#3D
."num",.k,.0#0A....setbit(1<<i,.k)#0A..}#0A#0A..wri
tef("*nThe.given.numbers.are:*n*n")#0A..pr()#0A#0A.
.writef("*nDoing.closure*n")#0A..doclosure()#0A#0A.
.writes("The.following.numbers.can.be.computed:*n*n
")#0A..pr()#0A#0Afin:#0A..IF.outstream.&.outstream.
~#3D.oldout.DO.endwrite()#0A..selectoutput(oldout)#0A
.#0A..FOR.i.#3D.0.TO.63.IF.v!i.DO.freevec(v!i)#0A..
IF.resv.DO.freevec(resv)#0A..IF.v....DO.freevec(v)#0A
..RESULTIS.0#0A}#0A#0AAND.doclosure().BE#0A{.change
.:#3D.FALSE#0A..FOR.i.#3D.0.TO.63.FOR.j.#3D.i+1.TO.
63.IF.(i&j)#3D0.DO#0A..{.LET.p,.q.#3D.v!i,.v!j#0A..
..FOR.a.#3D.0.TO.Upb.IF.p!(a>>5).&.getbit(i,.a).DO#0A
......FOR.b.#3D.0.TO.Upb.IF.q!(b>>5).&.getbit(j,.b)
.DO#0A......{.LET.bits,.k.#3D.i+j,.0#0A........vala
,.valb,.opstr.:#3D.a,.b,."add"#0A........k.:#3D.a+b
#0A........IF.k<#3DUpb.DO.setbit(bits,.k)#0A.......
.k.:#3D.a-b#0A........opstr.:#3D."sub"#0A........IF
.k<0.DO.vala,.valb,.k.:#3D.b,.a,.-k#0A........IF.k<
#3DUpb.DO.setbit(bits,.k)#0A........k.:#3D.a*b#0A..
......opstr.:#3D."mul"#0A........IF.k<#3DUpb.DO.set
bit(bits,.k)#0A........IF.b.&.a.REM.b.#3D.0.DO#0A..
......{.k.:#3D.a/b#0A..........vala,.valb,.opstr.:#3D
.a,.b,."div"#0A..........IF.k<#3DUpb.DO.setbit(bits
,.k)#0A........}#0A........IF.a.&.b.REM.a.#3D.0.DO#0A
........{.k.:#3D.b/a#0A..........vala,.valb,.opstr.
:#3D.b,.a,."div"#0A..........IF.k<#3DUpb.DO.setbit(
bits,.k)#0A........}#0A......}#0A..}.#0A}.REPEATWHI
LE.change#0A#0AAND.pr().BE#0A{.LET.k.#3D.0#0A..FOR.
n.#3D.0.TO.Upb.DO#0A..{.LET.inset.#3D.VALOF#0A....{
.FOR.i.#3D.0.TO.63.IF.getbit(i,.n).RESULTIS.TRUE#0A
......RESULTIS.FALSE#0A....}#0A....UNLESS.inset.LOO
P#0A....writef(".%i4",.n)#0A....k.:#3D.k+1#0A....UN
LESS.k.REM.10.DO.newline()#0A..}#0A..newline()#0A}#0A
#0AAND.setbit(bits,.n).BE#0A{.LET.p,.i.#3D.n/32,.n.
REM.32#0A..LET.bitv.#3D.v!bits#0A..LET.old.#3D.bitv
!p#0A..LET.new.#3D.old.|.1<<i#0A..IF.new#3Dold.RETU
RN#0A..bitv!p,.change.:#3D.new,.TRUE#0A..UNLESS.res
v!n.DO#0A....writef("adding.%i4.to.set.%b6...%s.%n.
%n*n",#0A...............n,.bits,.opstr,.vala,.valb)
#0A....#0A..resv!n.:#3D.TRUE#0A}#0A#0AAND.getbit(bi
ts,.n).#3D.VALOF#0A{.LET.p,.i.#3D.n/32,.n.REM.32#0A
..LET.bitv.#3D.v!bits#0A..RESULTIS.((bitv!p>>i)&1)#0A
}#0A#0A

######bcplprogs/demos/crc.b#
SECTION."CRC"#0A#0AGET."libhdr"#0A#0ALET.start().BE
#0A$(.LET.w.#3D.1...................//.xn#0A...LET.
d.#3D.#23b1101000000001000..//.1.+.x.+.x3.+.x12.+.x
16#0A#0A...selectoutput(findoutput("res"))#0A#0A...
FOR.i.#3D.1.TO.(1<<16)+64.DO#0A...$(.wrch('0'+(w&1)
)#0A......IF.i.REM.64.#3D.0.DO.newline()#0A......w.
:#3D.(w&1)#3D0.->.w>>1,.w>>1.NEQV.d#0A...$)#0A#0A..
.writef("*nend.of.output*n")#0A...endwrite()#0A$)#0A
#0A

######bcplprogs/demos/crdemo.b#
SECTION."crdemo"#0A#0AGET."libhdr"#0A.#0AGLOBAL.{.l
ocked:.200;..buf:.201#0A.........ptr#2Ein:.202;.ptr
#2Eout:.203#0A.........curr#2Eid:.204;.ticks:205#0A
}#0A.#0AMANIFEST.{.bufupb#3D3;.f#2Eput#3D101;.f#2Eg
et#3D102..}#0A.#0ALET.start().#3D.VALOF#0A{.LET.sli
cer.#3D.createco(slicer#2Efn,.500)#0A..LET.v.#3D.VE
C.4#0A.#0A..writes("Monitor.simulator.entered*n")#0A
.#0A..buf.:#3D.getvec(bufupb)#0A..ptr#2Ein,.ptr#2Eo
ut.:#3D.0,.0#0A..locked.:#3D.FALSE#0A..ticks.:#3D.0
#0A.#0A..v!0.:#3D.createco(server#2Efn,.500)#0A.#0A
..FOR.id.#3D.1.TO.4.DO.v!id.:#3D.createco(client#2E
fn,.500)#0A.#0A..callco(slicer,.v)#0A.#0A..writes("
end.of.test*n")#0A..RESULTIS.0#0A}#0A.#0AAND.tick()
.BE.cowait()#0A.#0AAND.server#2Efn().BE#0A{.LET.val
.#3D.monitor(f#2Eget)#0A..FOR.i.#3D.1.TO.3.DO.tick(
)#0A..writef("T#3D.%i3.%n:.Server.>>>>>>>%i3*n",.ti
cks,.curr#2Eid,.val)#0A..tick()#0A}.REPEAT#0A.#0AAN
D.client#2Efn().BE#0A{.LET.val.#3D.curr#2Eid#0A.#0A
..{.FOR.i.#3D.1.TO.20.+.10*curr#2Eid.DO.tick()..//.
delay.depending.on.the.id#0A....val.:#3D.val.+.100#0A
....writef("T#3D.%i3.%n:.Client.putting..%i3*n",.ti
cks,.curr#2Eid,.val)#0A....monitor(f#2Eput,.val)#0A
....tick()#0A..}.REPEAT#0A}#0A.#0AAND.slicer#2Efn(c
ptrv).BE.UNTIL.ticks>200.DO#0A{.FOR.id.#3D.0.TO.4.D
O.{.curr#2Eid.:#3D.id#0A.......................call
co(cptrv!id)#0A......................}#0A..ticks.:#3D
.ticks.+.1#0A}#0A.#0A.#0A.#0A.#0A.#0A.#0A.#0A.#0AAN
D.monitor(fno,.arg).#3D.VALOF#0A{.LET.res.#3D.?#0A.
#0A..tick().REPEATWHILE.locked#0A..//.tick()..NOT.a
llowed.here#0A..locked.:#3D.TRUE#0A//...writef("T#3D
.%i3.%n:.locked*n",.ticks,.curr#2Eid)#0A.#0A..tick(
)#0A..SWITCHON.fno.INTO#0A..{.DEFAULT:.writef("Unkn
own.monitor.function.%n*n",.fno)#0A.............END
CASE#0A.#0A....CASE.f#2Eput:..//.put.arg.into.the.b
uffer.if.there.is.room#0A.................tick()#0A
.................IF.ptr#2Ein>#3Dptr#2Eout+bufupb.DO
#0A.................{.tick()#0A...................l
ocked.:#3D.FALSE#0A//...................writef("T#3D
.%i3.%n:.unlocked*n",.ticks,.curr#2Eid)#0A.........
..........LOOP#0A.................}#0A.............
....tick()#0A.................buf.!.(ptr#2Ein.REM.b
ufupb).:#3D.arg#0A.................tick()#0A.......
..........ptr#2Ein.:#3D.ptr#2Ein.+.1#0A............
.....writef("T#3D.%i3.%n:.++++++.put.%i3..buf.now:.
",#0A.........................ticks,.curr#2Eid,.arg
)#0A.................wrbuf()#0A.................END
CASE#0A.#0A....CASE.f#2Eget:..//.get.two.values.fro
m.the.buffer.if.possible#0A.................tick()#0A
.................IF.ptr#2Eout>#3Dptr#2Ein.DO#0A....
.............{.tick()#0A...................locked.:
#3D.FALSE#0A//...................writef("T#3D.%i3.%
n:.unlocked*n",.ticks,.curr#2Eid)#0A...............
....LOOP#0A.................}#0A.................ti
ck()#0A.................res.:#3D.buf.!.(ptr#2Eout.R
EM.bufupb)#0A.................tick()#0A............
.....ptr#2Eout.:#3D.ptr#2Eout.+.1#0A...............
..writef("T#3D.%i3.%n:.------.get.%i3..buf.now:.",#0A
.........................ticks,.curr#2Eid,.res)#0A.
................wrbuf()#0A.................ENDCASE#0A
..}#0A..locked.:#3D.FALSE#0A//..writef("T#3D.%i3.%n
:.unlocked*n",.ticks,.curr#2Eid)#0A..tick()#0A..RES
ULTIS.res#0A}.REPEAT#0A.#0AAND.wrbuf().BE#0A{.FOR.i
.#3D.ptr#2Eout.TO.ptr#2Ein-1.DO.writef(".%i3",.buf!
(i.REM.bufupb))#0A..newline()#0A}#0A

######bcplprogs/demos/d3nodes.b#
GET."libhdr"#0A#0A/*.This.is.a.program.to.show.that
.there.are.120549.elements.in#0A...the.domain.D3.as
.described.on.pages.113-115.of."Denotational#0A...S
emantics".by.J#2EE#2EStoy#2E#0A#0A...The.program.is
.by.M#2ERichards.and.the.following.diagram.is.a#0A.
..clue.to.how.it.works#2E#0A#0A#0A#0A.......#2310#0A
.......|#0A-------A-----------------------.p10#0A..
.....|#0A.......#239#0A.......|#0A-------A---------
--------------.p9#0A....../|#0A...../.|#0A..../..|#0A
...#238..|#0A...|...|#0A---A---B-------------------
----.p8#0A...|...|#0A...|...#237#0A...|...|#0A---B-
--A-----------------------.p7#0A...|../|#0A...|./.|
#0A...|/..|#0A...#236..|#0A...|...|#0A---A---B-----
------------------.p6#0A...|...|#0A...|...#235#0A..
.|...|#0A---B---A-----------------------.p5#0A...|\
..|#0A...|.\.|#0A...|..\|#0A...|...#234#0A...|...|#0A
---B---A-----------------------.p4#0A...|...|#0A...
#233..|#0A...|...|#0A---A---B----------------------
-.p3#0A...|../#0A...|./#0A...|/#0A...#232#0A...|#0A
---A---------------------------.p2#0A...|#0A...#231
#0A...|#0A---A---------------------------.p1#0A...|
#0A#0A....The.diagram.represents.a.directed.graph.w
ith.10.vertices.#231,#2E#2E#2E.#2310#2E#0A#0AThe.re
lation.<#3D.is.defined.as.follows:#0A#0A...#23i.<#3D
.#23j..iff.the.exists.a.downward.path.from.#23j.to.
#23i.or.#23i#3D#23j#2E#0A#0Af.if.a.function.whose.a
rgument.and.result.are.both.elements.of.the.set#0A#0A
#231,#2E#2E#2E.#2310.and.having.the.following.prope
rty:#0A#0A....#231<#3Dx<#3D#2310./\.#231<#3Dy<#3D#23
10./\.x<#3Dy..#3D>..f(x)<#3Df(y)#0A#0A....How.many.
different.functions.exist.with.this.property?#0A#0A
....The.answer.is.120549#2E#0A*/#0A#0A#0AGLOBAL.$(.
tab:150;.count:151..$)#0A#0ALET.start().BE#0A$(.LET
.v.#3D.VEC.512#0A...v!512:#3D.#23b1111111111#0A...v
!256:#3D.#23b0111111111#0A...v!128:#3D.#23b00101011
11#0A...v!64.:#3D.#23b0001111111#0A...v!32.:#3D.#23
b0000101111#0A...v!16.:#3D.#23b0000011011#0A...v!8.
.:#3D.#23b0000001011#0A...v!4..:#3D.#23b0000000111#0A
...v!2..:#3D.#23b0000000011#0A...v!1..:#3D.#23b0000
000001#0A#0A...tab.:#3D.v#0A#0A...count.:#3D.0#0A..
.try(p10,.#23b1111111111)#0A...writef("Number.of.el
ements.in.D3.#3D.%n*n",.count)#0A$)#0A#0AAND.try(p,
.a,.b).BE.UNTIL.a#3D0.DO#0A$(.LET.x.#3D.a.&.-a#0A..
.a.:#3D.a.-.x#0A...p(tab!x,.b)#0A$)#0A#0AAND.p10(a)
....BE.try(p9,.a)#0A#0AAND.p9(a)....BE.try(p8,.a,.a
)#0A#0AAND.p8(a,.b).BE.try(p7,.b,.a)#0A#0AAND.p7(a,
.b).BE.try(p6,.a&b,.a)#0A#0AAND.p6(a,.b).BE.try(p5,
.b,.a)#0A#0AAND.p5(a,.b).BE.try(p4,.a&b,.b)#0A#0AAN
D.p4(a,.b).BE.try(p3,.b,.a)#0A#0AAND.p3(a,.b).BE.tr
y(p2,.a&b)#0A#0AAND.p2(a)....BE.try(p1,.a)#0A#0AAND
.p1()....BE.count.:#3D.count.+.1#0A#0A

######bcplprogs/demos/demo.b#
GET."libhdr"#0A#0ALET.start().#3D.VALOF#0A$(.LET.n.
#3D.0#0A#0A...writef("Please.give.me.a.number:.")#0A
#0A...n.:#3D.readn()#0A#0A...IF.n#3D0.RESULTIS.0#0A
#0A...writef("Your.number.was.%n.and.its.square.is.
%n*n",.n,.n*n)#0A$).REPEAT

######bcplprogs/demos/easter.b#
GET."libhdr"#0A#0ALET.start().#3D.VALOF#0A{.LET.arg
s.#3D.VEC.50#0A#0A..IF.rdargs("YEAR",.args,.50)#3D0
.DO#0A..{.writef("Bad.arguments.for.EASTER*n")#0A..
..RESULTIS.20#0A..}#0A#0A..TEST.args!0#3D0#0A#0A..T
HEN.{.writef("Calculating.the.Easter.cycle*n")#0A..
.......writef("The.Easter.cycle.is.%n*n",.cycle())#0A
.......}#0A#0A..ELSE.{.LET.year.#3D.str2numb(args!0
)#0A.........IF.0<#3Dyear<#3D99.DO.year.:#3D.year+2
000#0A.........FOR.y.#3D.year.TO.year+9.DO#0A......
.....writef("The.date.of.Easter.in.%n.is.%n/%n*n",.
#0A...................y,.easter(y)/10,.easter(y).RE
M.10)#0A.......}#0A#0A..RESULTIS.0#0A}#0A#0AAND.eas
ter(year).#3D.VALOF#0A{.LET.a....#3D.year.REM.19#0A
..LET.b,.c.#3D.year/100,.year.REM.100#0A..LET.d,.e.
#3D.b/4,.b.REM.4#0A..LET.f....#3D.(b+8)/25#0A..LET.
g....#3D.(b-f+1)/3#0A..LET.h....#3D.(19*a+b-d-g+15)
.REM.30#0A..LET.i,.k.#3D.c/4,.c.REM.4#0A..LET.l....
#3D.(32+2*e+2*i-h-k).REM.7#0A..LET.m....#3D.(a+11*h
+22*l)/451#0A..LET.x....#3D.h+l-7*m+114#0A..LET.n,.
p.#3D.x/31,.x.REM.31#0A..RESULTIS.10*(p+1)+n#0A}#0A
#0A//.The.following.is.a.debugging.version.of.easte
r.with.an.obvious.cycle#0AAND.easter1(year).#3D.yea
r.REM.2_718_281#0A#0AAND.cycle().#3D.VALOF#0A{.MANI
FEST.{.year#3D1996;.K#3D7654321.}#0A#0A..LET.hashdi
ff.#3D.K*easter(year+1).NEQV.K*easter(year)#0A..#0A
..FOR.cycle.#3D.1.TO.6_000_000.DO#0A..{.LET.y.#3D.y
ear.+.cycle.+.cycle#0A#0A....hashdiff.:#3D.hashdiff
.NEQV.K*easter(y).NEQV.K*easter(y+1)#0A#0A....IF.cy
cle.REM.1_000_000.#3D.0.DO.writef("trying.cycle.#3D
.%i9*n",.cycle)#0A....IF.hashdiff#3D0.DO#0A....{.wr
itef("hashdiff#3D0.when.cycle.is.%n*n",.cycle+1)#0A
......IF.iscycle(cycle+1).RESULTIS.cycle+1#0A....}#0A
....#0A..}#0A#0A..RESULTIS.0#0A}#0A#0AAND.iscycle(c
ycle).#3D.VALOF#0A{.writef("testing.cycle.#3D.%n*n"
,.cycle)#0A..FOR.i.#3D.0.TO.cycle.DO#0A..{.UNLESS.e
aster(1996+i)#3Deaster(1996+cycle+i).RESULTIS.FALSE
#0A....IF.i.REM.1000000.#3D.0.DO.writef("%n.matched
.so.far*n",.i+1)#0A..}#0A..RESULTIS.TRUE#0A}#0A

######bcplprogs/demos/f3nplus1.b#
/*#0A...A.problem.suggested.by.B#2EThwaites.in.1952
#2E#0A#0A...Investigate.the.integer.function.f(n)#0A
#0A...where....f(n).#3D.n/2....if.n.even#0A...else.
....f(n).#3D.3*n+1#0A#0A...Implemented.in.BCPL.by.M
artin.Richards.(c).September.2000#0A*/#0A#0AGET."li
bhdr"#0A#0ALET.f(n).#3D.(n&1)#3D0.->.n/2,.3*n+1#0A#0A
LET.start().#3D.VALOF#0A{.LET.argv.#3D.VEC.50#0A..L
ET.n.#3D.0#0A#0A..UNLESS.rdargs("n",.argv,.50).DO#0A
..{.writes("Bad.argument*n")#0A....RESULTIS.20#0A..
}#0A#0A..IF.argv!0.DO.n.:#3D.str2numb(argv!0)#0A#0A
..IF.n.DO#0A..{.try(n)#0A....RESULTIS.0#0A..}#0A#0A
..{.writef("n.#3D.")#0A....n.:#3D.readn()#0A....new
line()#0A....IF.n#3D0.RESULTIS.0#0A....try(n)#0A..}
.REPEAT#0A}#0A#0AAND.try(n).BE#0A{.LET.layout.#3D.0
#0A#0A..{.writef(".%i6",.n)#0A....layout.:#3D.layou
t+1#0A....IF.layout.REM.10.#3D.0.DO.newline()#0A...
.IF.n#3D1.BREAK#0A....n.:#3D.f(n)#0A..}.REPEAT#0A#0A
..newline()#0A}#0A

######bcplprogs/demos/fact.b#
SECTION."fact"#0A#0AGET."libhdr"#0A#0ALET.start().#3D
.VALOF#0A{.FOR.i.#3D.1.TO.5.DO.writef("fact(%n).#3D
.%i4*n",.i,.fact(i))#0A..RESULTIS.0#0A}#0A#0AAND.fa
ct(n).#3D.n#3D0.->.1,.n*fact(n-1)#0A

######bcplprogs/demos/factors.b#
GET"libhdr"#0A#0ALET.start().BE.FOR.k.#3D.1.TO.31.D
O#0A$(.LET.num.#3D.(1<<k).-.1#0A...writef("*NFactor
s.of.%N..k.#3D.%N*N",.num,.k)#0A#0A...FOR.i.#3D.2.T
O.num<#23XFFFF->num/2,.#23XFFFF.IF.num.REM.i.#3D.0.
DO#0A.......writef("%N.",.i)#0A#0A$)#0A#0A#0A

######bcplprogs/demos/fastqueens.b#
GET."libhdr"#0A.#0AGLOBAL.{.count:ug;.all..}#0A.#0A
LET.try(n).BE#0A{.LET.poss.#3D.all#0A#0A..SWITCHON.
n.INTO#0A..{#0A....DEFAULT:.writef("n#3D%n.out.of.r
ange*n",.n)#0A.............RETURN#0A#0A....CASE.14:
#0A....CASE.13:#0A....CASE.12:#0A....CASE.11:#0A...
.CASE.10:#0A....CASE..9:#0A....CASE..8:#0A.........
poss8.:#3D.all#0A.........ld8,.row8,.rd8.:#3D.0,0,0
#0A.........GOTO.L8#0A....CASE..7:#0A....CASE..6:#0A
....CASE..5:#0A....CASE..4:#0A....CASE..3:#0A....CA
SE..2:#0A....CASE..1:#0A#0A....L14:#0A....L13:#0A..
..L12:#0A....L11:#0A....L10:#0A....L9:#0A........RE
TURN#0A....L8:.#0A........p8.:#3D.poss8.&.-poss8#0A
........UNLESS.p8.GOTO.L9#0A........ld7...:#3D.(ld8
+p8)<<1#0A........rd7...:#3D.(rd8+p8)>>1#0A........
row7..:#3D.row8+p8#0A........poss7.:#3D.all.&.~(ld8
.|.row8.|.rd8)#0A....L7:#0A........p7.:#3D.poss7.&.
-poss7#0A........UNLESS.p7.GOTO.L8#0A........ld6...
:#3D.(ld7+p7)<<1#0A........rd6...:#3D.(rd7+p7)>>1#0A
........row6..:#3D.row7+p7#0A........poss6.:#3D.all
.&.~(ld6.|.row6.|.rd6)#0A....L6:#0A....L5:#0A....L4
:#0A....L3:#0A....L2:#0A....L1:#0A........IF.poss1.
DO.count.:#3D.count+1#0A........GOTO.L2#0A}#0A#0ALE
T.start().#3D.VALOF#0A{.all.:#3D.1#0A..#0A..FOR.n.#3D
.1.TO.14.DO#0A..{.count.:#3D.0#0A....try(n)#0A....w
ritef("Number.of.solutions.to.%i2-queens.is.%i7*n",
.n,.count)#0A....all.:#3D.2*all.+.1#0A..}#0A#0A..RE
SULTIS.0#0A}#0A

######bcplprogs/demos/fib.b#
GET."libhdr"#0A#0A//.Safe.version#0ALET.fib1(n).#3D
.VALOF#0A{.LET.a,.b.#3D.0,.1.#0A..FOR.i.#3D.1.TO.n.
DO.{.LET.c.#3D.a+b#0A......................a.:#3D.b
#0A......................b.:#3D.c#0A...............
.....}#0A..RESULTIS.a#0A}#0A#0ALET.fib2(n).#3D.VALO
F#0A{.LET.a,.b.#3D.0,.1#0A#0A..WHILE.n>9.DO.{.LET.c
,.d.#3D.34*a+55*b,.55*a+89*b#0A.................a,.
b,.n.:#3D.c,.d,.n-10#0A...............}#0A..WHILE.n
>0.DO.{.LET.c,.d.#3D.b,.a+b#0A.................a,.b
,.n.:#3D.c,.d,.n-1#0A...............}#0A..RESULTIS.
a#0A}#0A#0ALET.fib3(n).#3D.VALOF#0A{.LET.a,.b.#3D.0
,.1#0A#0A..WHILE.n>9.DO.{.LET.c,.d.#3D.34*a+55*b,.5
5*a+89*b#0A.................a,.b,.n.:#3D.c,.d,.n-10
#0A...............}#0A..#0A..SWITCHON.n.INTO#0A..{.
DEFAULT:.writef("n.was.negative*n")#0A.............
RESULTIS.0#0A#0A....CASE.9:.RESULTIS.21*a.+.34*b#0A
....CASE.8:.RESULTIS.13*a.+.21*b#0A....CASE.7:.RESU
LTIS..8*a.+.13*b#0A....CASE.6:.RESULTIS..5*a.+..8*b
#0A....CASE.5:.RESULTIS..3*a.+..5*b#0A....CASE.4:.R
ESULTIS..2*a.+..3*b#0A....CASE.3:.RESULTIS....a.+..
2*b#0A....CASE.2:.RESULTIS....a.+....b#0A....CASE.1
:.RESULTIS...........b#0A....CASE.0:.RESULTIS....a#0A
..}#0A}#0A#0A//.Since.there.are.only.46.possible.32
-bit.answers.let's.make.a.table.of.them#2E#0AAND.fi
b4(n).#3D.n.!.TABLE#0A..........0,.........1,......
...1,.........2,.........3,#0A..........5,.........
8,........13,........21,........34,#0A.........55,.
.......89,.......144,.......233,.......377,#0A.....
...610,.......987,......1597,......2584,......4181,
#0A.......6765,.....10946,.....17711,.....28657,...
..46368,#0A......75025,....121393,....196418,....31
7811,....514229,#0A.....832040,...1346269,...217830
9,...3524578,...5702887,#0A....9227465,..14930352,.
.24157817,..39088169,..63245986,#0A..102334155,.165
580141,.267914296,.433494437,.701408733,#0A.1134903
170#0A#0A#0A#0ALET.start().#3D.VALOF#0A{.FOR.i.#3D.
0.TO.45.DO#0A..{.IF.i.MOD.5.#3D.0.DO.newline()#0A..
..writef(".%3i:%10i",.i,.fib4(i))#0A..}#0A..newline
()#0A#0A..writef("*nInstruction.counts*n*n")#0A..wr
itef(".n......answer........fib1.......fib2.......f
ib3.......fib4*n*n")#0A#0A..FOR.i.#3D.0.TO.45.DO#0A
..{.writef("%i2:.%10i.",.i,.fib1(i))#0A....writef("
.%10i",.instrcount(fib1,.i))#0A....writef(".%10i",.
instrcount(fib2,.i))#0A....writef(".%10i",.instrcou
nt(fib3,.i))#0A....writef(".%10i",.instrcount(fib4,
.i))#0A....newline()#0A..}#0A..RESULTIS.0#0A}#0A/*#0A
#0ATypical.run:#0A#0A0>.c.b.fib#0Abcpl.fib#2Eb.to.f
ib.hdrs.BCPLHDRS.#0A#0ABCPL.(27.Jul.2006)#0ACode.si
ze.#3D...808.bytes#0A0>....#0A0>.#0A0>.fib#0A#0A...
0:.........0...1:.........1...2:.........1...3:....
.....2...4:.........3#0A...5:.........5...6:.......
..8...7:........13...8:........21...9:........34#0A
..10:........55..11:........89..12:.......144..13:.
......233..14:.......377#0A..15:.......610..16:....
...987..17:......1597..18:......2584..19:......4181
#0A..20:......6765..21:.....10946..22:.....17711..2
3:.....28657..24:.....46368#0A..25:.....75025..26:.
...121393..27:....196418..28:....317811..29:....514
229#0A..30:....832040..31:...1346269..32:...2178309
..33:...3524578..34:...5702887#0A..35:...9227465..3
6:..14930352..37:..24157817..38:..39088169..39:..63
245986#0A..40:.102334155..41:.165580141..42:.267914
296..43:.433494437..44:.701408733#0A..45:1134903170
#0A#0AInstruction.counts#0A#0A.n......answer.......
.fib1.......fib2.......fib3.......fib4#0A#0A.0:....
......0..........10.........11.........12..........
3#0A.1:..........1..........22.........23.........1
2..........3#0A.2:..........1..........34.........3
5.........13..........3#0A.3:..........2..........4
6.........47.........15..........3#0A.4:..........3
..........58.........59.........19..........3#0A.5:
..........5..........70.........71.........19......
....3#0A.6:..........8..........82.........83......
...19..........3#0A.7:.........13..........94......
...95.........19..........3#0A.8:.........21.......
..106........107.........19..........3#0A.9:.......
..34.........118........119.........19..........3#0A
10:.........55.........130.........38.........39...
.......3#0A11:.........89.........142.........50...
......39..........3#0A12:........144.........154...
......62.........40..........3#0A13:........233....
.....166.........74.........42..........3#0A14:....
....377.........178.........86.........46..........
3#0A15:........610.........190.........98.........4
6..........3#0A16:........987.........202........11
0.........46..........3#0A17:.......1597.........21
4........122.........46..........3#0A18:.......2584
.........226........134.........46..........3#0A19:
.......4181.........238........146.........46......
....3#0A20:.......6765.........250.........65......
...66..........3#0A21:......10946.........262......
...77.........66..........3#0A22:......17711.......
..274.........89.........67..........3#0A23:......2
8657.........286........101.........69..........3#0A
24:......46368.........298........113.........73...
.......3#0A25:......75025.........310........125...
......73..........3#0A26:.....121393.........322...
.....137.........73..........3#0A27:.....196418....
.....334........149.........73..........3#0A28:....
.317811.........346........161.........73..........
3#0A29:.....514229.........358........173.........7
3..........3#0A30:.....832040.........370.........9
2.........93..........3#0A31:....1346269.........38
2........104.........93..........3#0A32:....2178309
.........394........116.........94..........3#0A33:
....3524578.........406........128.........96......
....3#0A34:....5702887.........418........140......
..100..........3#0A35:....9227465.........430......
..152........100..........3#0A36:...14930352.......
..442........164........100..........3#0A37:...2415
7817.........454........176........100..........3#0A
38:...39088169.........466........188........100...
.......3#0A39:...63245986.........478........200...
.....100..........3#0A40:..102334155.........490...
.....119........120..........3#0A41:..165580141....
.....502........131........120..........3#0A42:..26
7914296.........514........143........121..........
3#0A43:..433494437.........526........155........12
3..........3#0A44:..701408733.........538........16
7........127..........3#0A45:.1134903170.........55
0........179........127..........3#0A10>.#0A#0A*/#0A


######bcplprogs/demos/findperm.b#
GET."libhdr"#0A#0AGLOBAL.$(#0Aname:200;.namep:201#0A
perm:202;.used:203;.hashtab:204#0Aprobword:205#0A$)
#0A#0ALET.dsw(str).BE#0A$(.namep.:#3D.namep.+.1#0A.
..IF.namep<256.DO.name!namep.:#3D.str#0A$)#0A#0ALET
.initnames().BE#0A$(.namep.:#3D.0#0A#0A...dsw("a")#0A
...dsw("b")#0A...dsw("c")#0A...dsw("d")#0A...dsw("e
")#0A...dsw("f")#0A...dsw("g")#0A...dsw("h")#0A...d
sw("i")#0A...dsw("j")#0A...dsw("k")#0A...dsw("l")#0A
...dsw("m")#0A...dsw("n")#0A...dsw("o")#0A...dsw("p
")#0A...dsw("q")#0A...dsw("r")#0A...dsw("s")#0A...d
sw("t")#0A...dsw("u")#0A...dsw("v")#0A...dsw("w")#0A
...dsw("x")#0A...dsw("y")#0A...dsw("z")#0A#0A...dsw
("AND")#0A...dsw("ABS")#0A...dsw("BE")#0A...dsw("BR
EAK")#0A...dsw("BY")#0A...dsw("CASE")#0A...dsw("DO"
)#0A...dsw("DEFAULT")#0A...dsw("EQ")#0A...dsw("EQV"
)#0A...dsw("ELSE")#0A...dsw("ENDCASE")#0A...dsw("FA
LSE")#0A...dsw("FOR")#0A...dsw("FINISH")#0A...dsw("
GOTO")#0A...dsw("GE")#0A...dsw("GR")#0A...dsw("GLOB
AL")#0A...dsw("GET")#0A...dsw("IF")#0A...dsw("INTO"
)#0A...dsw("LET")#0A...dsw("LV")#0A...dsw("LE")#0A.
..dsw("LS")#0A...dsw("LOGOR")#0A...dsw("LOGAND")#0A
...dsw("LOOP")#0A...dsw("LSHIFT")#0A...dsw("MANIFES
T")#0A...dsw("NE")#0A...dsw("NOT")#0A...dsw("NEQV")
#0A...dsw("NEEDS")#0A...dsw("OR")#0A...dsw("RESULTI
S")#0A...dsw("RETURN")#0A...dsw("REM")#0A...dsw("RS
HIFT")#0A...dsw("RV")#0A...dsw("REPEAT")#0A...dsw("
REPEATWHILE")#0A...dsw("REPEATUNTIL")#0A...dsw("SWI
TCHON")#0A...dsw("STATIC")#0A...dsw("SECTION")#0A..
.dsw("TO")#0A...dsw("TEST")#0A...dsw("TRUE")#0A...d
sw("THEN")#0A...dsw("TABLE")#0A...dsw("UNTIL")#0A..
.dsw("UNLESS")#0A...dsw("VEC")#0A...dsw("VALOF")#0A
...dsw("WHILE")#0A...dsw("$")#0A#0A#0A...dsw("globs
ize")#0A...dsw("start")#0A...dsw("stop")#0A...dsw("
sys")#0A...dsw("clihook")#0A...dsw("changeco")#0A..
.dsw("currco")#0A...dsw("colist")#0A...dsw("rootnod
e")#0A...dsw("result2")#0A...dsw("intflag")#0A...ds
w("sardch")#0A...dsw("sawrch")#0A...dsw("level")#0A
...dsw("longjump")#0A...dsw("muldiv")#0A...dsw("apt
ovec")#0A...dsw("createco")#0A...dsw("deleteco")#0A
...dsw("callco")#0A...dsw("cowait")#0A...dsw("resum
eco")#0A...dsw("initco")#0A...dsw("globin")#0A...ds
w("getvec")#0A...dsw("freevec")#0A...dsw("abort")#0A
...dsw("packstring")#0A...dsw("unpackstring")#0A...
dsw("cis")#0A...dsw("cos")#0A...dsw("rdch")#0A...ds
w("unrdch")#0A...dsw("wrch")#0A...dsw("findinput")#0A
...dsw("findoutput")#0A...dsw("selectinput")#0A...d
sw("selectoutput")#0A...dsw("endread")#0A...dsw("en
dwrite")#0A...dsw("input")#0A...dsw("output")#0A...
dsw("readn")#0A...dsw("newline")#0A...dsw("newpage"
)#0A...dsw("writed")#0A...dsw("writeu")#0A...dsw("w
riten")#0A...dsw("writeoct")#0A...dsw("writehex")#0A
...dsw("writes")#0A...dsw("writet")#0A...dsw("write
f")#0A...dsw("capitalch")#0A...dsw("compch")#0A...d
sw("compstring")#0A...dsw("rdargs")#0A...dsw("rdite
m")#0A...dsw("findarg")#0A...dsw("loadseg")#0A...ds
w("unloadseg")#0A...dsw("callseg")#0A...dsw("delete
file")#0A...dsw("renamefile")#0A...dsw("randno")#0A
...dsw("str2numb")#0A#0A...dsw("endstreamch")#0A...
dsw("bytesperword")#0A...dsw("bitsperword")#0A...ds
w("bitsperbyte")#0A...dsw("maxint")#0A...dsw("minin
t")#0A...dsw("mcaddrinc")#0A...dsw("ug")#0A#0A...ds
w("t_hunk")#0A...dsw("t_end")#0A#0A...dsw("co_pptr"
)#0A...dsw("co_parent")#0A...dsw("co_list")#0A...ds
w("co_fn")#0A...dsw("co_size")#0A#0A...dsw("rtn_mem
base")#0A...dsw("rtn_memsize")#0A...dsw("rtn_blklis
t")#0A...dsw("rtn_tallyv")#0A...dsw("rtn_syslib")#0A
...dsw("rtn_blib")#0A...dsw("rtn_boot")#0A...dsw("r
tn_cli")#0A...dsw("rtn_keyboard")#0A...dsw("rtn_scr
een")#0A...dsw("rtn_upb")#0A$)#0A#0ALET.start().BE#0A
$(.perm.:#3D.TABLE#0A......1,.14,110,.25,.97,174,13
2,119,138,170,125,118,.27,233,140,.51,#0A.....87,19
7,177,107,234,169,.56,.68,.30,..7,173,.73,188,.40,.
36,.65,#0A.....49,213,104,190,.57,211,148,223,.48,1
15,.15,..2,.67,186,210,.28,#0A.....12,181,103,.70,.
22,.58,.75,.78,183,167,238,157,124,147,172,144,#0A.
...176,161,141,.86,.60,.66,128,.83,156,241,.79,.46,
168,198,.41,254,#0A....178,.85,253,237,250,154,133,
.88,.35,206,.95,116,252,192,.54,221,#0A....102,218,
255,240,.82,106,158,201,.61,..3,.89,..9,.42,155,159
,.93,#0A....166,.80,.50,.34,175,195,100,.99,.26,150
,.16,145,..4,.33,..8,189,#0A....121,.64,.77,.72,208
,245,130,122,143,.55,105,134,.29,164,185,194,#0A...
.193,239,101,242,..5,171,126,.11,.74,.59,137,228,10
8,191,232,139,#0A......6,.24,.81,.20,127,.17,.91,.9
2,251,151,225,207,.21,.98,113,112,#0A.....84,226,.1
8,214,199,187,.13,.32,.94,220,224,212,247,204,196,.
43,#0A....249,236,.45,244,111,182,153,136,129,.90,2
17,202,.19,165,231,.71,#0A....230,142,.96,227,.62,1
79,246,114,162,.53,160,215,205,180,.47,109,#0A.....
44,.38,.31,149,135,..0,216,.52,.63,.23,.37,.69,.39,
117,146,184,#0A....163,200,222,235,248,243,219,.10,
152,131,123,229,203,.76,120,209#0A#0A...writes("Fin
d.perm.entered*n")#0A...name....:#3D.getvec(255)#0A
...hashtab.:#3D.getvec(255)#0A...used....:#3D.getve
c(255)#0A...FOR.i.#3D.0.TO.255.DO.name!i,.hashtab!i
,.used!i.:#3D.0,.0,.0#0A#0A...initnames()#0A#0A...w
ritef("Number.of.names.is.%n*n",.namep)#0A#0A...try
(1,.1,.0)#0A#0A...freevec(name)#0A...freevec(hashta
b)#0A...freevec(used)#0A...writes("End.of.test*n")#0A
$)#0A#0AAND.try(i,.p,.h).BE#0A$(.LET.word.#3D.name!
i#0A...writef("%i3..%n.%i3..%s*n",.i,.p,.h,.word)#0A
...TEST.p>word%0#0A...THEN.TEST.hashtab!h#3D0#0A...
.....THEN.$(.hashtab!h.:#3D.i#0A................IF.
i#3Dnamep.DO.abort(9999)#0A................writef("
hashval.#3D.%n*n",.h)#0A................try(i+1,.1,
.0)#0A................hashtab!h.:#3D.0#0A..........
...$)#0A........ELSE.$(.probword.:#3D.word#0A......
..........FOR.i.#3D.0.TO.255.DO#0A................$
(.IF.i.REM.64.#3D.0.DO.newline()#0A................
...IF.i.REM.8.#3D.0.DO.wrch('.')#0A................
...wrch('0'+used!i)#0A................$)#0A........
........abort(1001)#0A................newline()#0A.
............$)#0A...ELSE.$(.LET.q.#3D.h.NEQV.word%p
#0A...........used!q.:#3D.used!q.+.1#0A...........t
ry(i,.p+1,.perm!q)#0A...........IF.used!q#3D1.FOR.j
.#3D.0.TO.255.IF.used!j#3D0.DO#0A...........$(.LET.
w.#3D.perm!j#0A..............//writef("Swapping.%n:
%n.and.%n:%n*n",.q,.perm!q,.j,.perm!j)#0A..........
....perm!j.:#3D.perm!q#0A..............perm!q.:#3D.
w#0A..............IF.ok(probword).DO.try(i,.p+1,.pe
rm!q)#0A..............perm!q.:#3D.perm!j#0A........
......perm!j.:#3D.w#0A...........$)#0A...........us
ed!q.:#3D.used!q.-.1#0A........$)#0A...writef("Back
tracking.%i3..%n.%i3..%s..probword:.%s*n",#0A......
.....i,.p,.h,.word,.probword)#0A//...abort(1000)#0A
$)#0A#0AAND.ok(word).#3D.VALOF#0A$(.LET.hashval.#3D
.0#0A...FOR.i.#3D.1.TO.word%0.DO.hashval.:#3D.perm!
(hashval.NEQV.word%i)#0A//...UNLESS.hashtab!hashval
#3D0.DO.writef("still.colliding:.%s*n",.word)#0A...
RESULTIS.hashtab!hashval#3D0#0A$)

######bcplprogs/demos/floyd.b#
/*#0AA.demonstration.program.implemented.in.BCPL#0A
by.Martin.Richards.(c).June.2005#0A#0AThis.is.a.sim
ple.implementation.of.Floyd's.Algorithm.to.find#0At
he.cost.of.the.cheapest.path.from.any.vertex.i.to.a
ny.vertex.j#0Ain.a.directed.graph.where.the.cost.of
.a.direct.edge.i->j.is.c!i!j#2E#0AThe.algorthm.also
.fills.in.the.matrix.r.so.that.if.there.is.a.path#0A
from.i->j.then.r!i!j.to.the.first.vertex.to.goto.on
.a.cheapest.path#2E#0A#0AUsage:#0A#0Afloyd.n.<numbe
r.of.vertices>.e.<number.of.edges.out.of.each.verte
x>#0A......seed.<the.random.number.seed>#0A#0Aeg:#0A
#0Afloyd.n.16.e.2.seed.1234#0A#0AThe.costs.are.rand
omly.chosen.in.the.range.0.to.100#2E#0A#0AThe.progr
am.checks.the.correctness.of.the.entries.in.r#2E#0A
*/#0AGET."libhdr"#0A#0AMANIFEST.{#0A..Inf.#3D.maxin
t/2..//.Special.value.indication.no.edge#0A}#0A#0AG
LOBAL.{#0A..spacev:ug..//.Space.for.the.matrices#0A
..spacep.....//.Pointer.to.next.position.in.spacev#0A
..c..........//.c!i!j.#3D.Inf..if.no.edge.from.-->j
#0A.............//.else..#3D.cost.of.direct.edge.i-
>j#0A..r..........//.The.routes.matrix#0A..........
...//.r!i!j.#3D.first.node.to.pass.through.in.a.che
apest.path.i->j#0A.............//..else.#3D.0#0A..n
..........//.The.number.of.vertices#0A..e..........
//.The.number.of.edges.per.vertex#0A#0A..initseed..
...//.Random.number.seed#0A}#0A#0ALET.start().#3D.V
ALOF#0A{.LET.argv.#3D.VEC.50#0A#0A..UNLESS.rdargs("
n,e,seed",.argv,.50).DO#0A..{.writef("Bad.argument*
n")#0A....RESULTIS.0#0A..}#0A#0A..n,.e,.initseed.:#3D
.5,.2,.1#0A..IF.argv!0.&.string#2Eto#2Enumber(argv!
0).DO.n........:#3D.result2#0A..IF.argv!1.&.string#2E
to#2Enumber(argv!1).DO.e........:#3D.result2#0A..IF
.argv!2.&.string#2Eto#2Enumber(argv!2).DO.initseed.
:#3D.result2#0A#0A..IF.n<2.DO.n.:#3D.2#0A..IF.e>n.D
O.e.:#3D.n#0A#0A..writef("*nn#3D%n..e#3D%n..seed#3D
%n*n",.n,.e,.initseed)#0A#0A..spacev.:#3D.getvec(2*
(n+1)*(n+1).+.2*(n+1)).//.Get.space.for.2.nxn.matri
ces#0A..UNLESS.spacev.DO#0A..{.writef("Unable.to.al
locate.the.matrices*n")#0A....RESULTIS.0#0A..}#0A#0A
..spacep.:#3D.spacev#0A..c.:#3D.spacep;.spacep.:#3D
.spacep+n+2#0A..r.:#3D.spacep;.spacep.:#3D.spacep+n
+2#0A..FOR.i.#3D.1.TO.n.DO#0A..{.c!i.:#3D.spacep;.s
pacep.:#3D.spacep+n+2#0A....r!i.:#3D.spacep;.spacep
.:#3D.spacep+n+2#0A..}#0A#0A..writef("allocated#3D%
n.out.of.%n*n",.spacep-spacev,.2*(n+1)*(n+1).+.2*(n
+1))#0A..FOR.i.#3D.1.TO.n.FOR.j.#3D.1.TO.n.DO.c!i!j
.:#3D.Inf#0A..setseed(initseed)#0A..FOR.i.#3D.1.TO.
80.DO.writef("%n",.randno(5))#0A..newline()#0A#0A..
FOR.i.#3D.1.TO.n.DO.//.Fill.in.a.random.cost.matrix
#0A..{.LET.k,.p.#3D.0,.?#0A....UNTIL.k#3De.DO#0A...
.{.p.:#3D.randno(n).REPEATUNTIL.c!i!p#3DInf#0A.....
.c!i!p.:#3D.randno(100)#0A......k.:#3D.k+1#0A....}#0A
..}#0A#0A..prmat("Cost.matrix",.c,.n)#0A#0A..floyd(
c,.r,.n)#0A#0A..prmat("Min.cost.matrix",.c,.n)#0A..
prmat("Route.matrix",....r,.n)#0A..check(c,.r,.n)#0A
#0A..IF.spacev.DO.freevec(spacev)#0A..RESULTIS.0..#0A
}#0A#0AAND.prmat(mess,.m,.n).BE#0A{.writef("*n%s:*n
",.mess)#0A..FOR.i.#3D.1.TO.n.DO#0A..{.FOR.j.#3D.1.
TO.n.DO.TEST.m!i!j#3DInf#0A......................TH
EN.writef("....-")#0A......................ELSE.wri
tef(".%i4",.m!i!j)#0A....newline()#0A..}#0A}#0A#0AA
ND.floyd(c,.r,.n).BE#0A{.FOR.i.#3D.1.TO.n.FOR.j.#3D
.1.TO.n.DO.r!i!j.:#3D.c!i!j#3DInf.->.0,.j.#0A#0A..F
OR.k.#3D.1.TO.n.FOR.i.#3D.1.TO.n.FOR.j.#3D.1.TO.n.D
O#0A..{.LET.cost.#3D.c!i!k.+.c!k!j#0A....IF.c!i!j.>
.cost.DO.#0A....{.c!i!j.:#3D.cost#0A......r!i!j.:#3D
.r!i!k#0A....}#0A..}#0A}#0A#0AAND.check(c,.r,.n).BE
#0A{.FOR.i.#3D.1.TO.n.FOR.j.#3D.1.TO.n.DO#0A..TEST.
c!i!j#3DInf#0A..THEN.{.writef("No.path.%n->%n*n",.i
,.j)#0A.........UNLESS.r!i!j#3D0.DO.writef("ERROR:.
route.element.not.zero*n").#0A.......}#0A..ELSE.{.L
ET.p,.q.#3D.r!i!j,.?#0A.........LET.cost.#3D.c!i!p#0A
.........LET.total.#3D.0#0A.........writef("%i3:..%
n",.c!i!j,.i)#0A#0A.........{.writef("-(%n)->%n",.c
ost,.p)#0A...........total.:#3D.total+cost#0A//abor
t(1000)#0A...........IF.p#3Dj.|.p#3D0.BREAK#0A.....
......q.:#3D.r!p!j#0A...........cost.:#3D.c!p!q#0A.
..........p.:#3D.q#0A.........}.REPEAT#0A.........w
ritef("...total#3D%n*n",.total)#0A.........UNLESS.t
otal#3Dc!i!j.DO.writef("ERROR:.The.above.total.is.w
rong*n").#0A.......}#0A}#0A#0A

######bcplprogs/demos/fprimes.b#
SECTION."FPRIMES"#0A.#0AGET."libhdr"#0A.#0AGLOBAL.$
(.count:.ug..$)#0A.#0ALET.f(n).#3D.n#3D0->2,.n#3D1-
>1,.f(n-1)+f(n-2)#0ALET.isprime(n).#3D.f(n).REM.n.#3D
.1#0A.#0ALET.start().#3D.VALOF#0A$(.FOR.p.#3D.2.TO.
50.IF.isprime(p).DO.out(p)#0A.#0A...writes("*nend.o
f.output*n")#0A...RESULTIS.0#0A$)#0A.#0AAND.out(n).
BE#0A$(.IF.count.REM.10.#3D.0.DO.newline()#0A...wri
tef(".%i3",.n)#0A...count.:#3D.count.+.1#0A$)#0A

######bcplprogs/demos/fridays.b#
SECTION."fridays"#0A#0AGET."libhdr"#0A#0AMANIFEST.$
(.mon#3D0;.sun#3D6;.jan#3D0;.feb#3D1;.dec#3D11.$)#0A
#0ALET.start().#3D.VALOF#0A$(.LET.count.......#3D.T
ABLE.0,.0,.0,.0,.0,.0,.0#0A...LET.daysinmonth.#3D.T
ABLE.31,..?,.31,.30,.31,.30,#0A....................
.......31,.31,.30,.31,.30,.31#0A...LET.days.#3D.0#0A
......#0A...FOR.year.#3D.1973.TO.1973+399.DO#0A...$
(.daysinmonth!feb.:#3D.febdays(year)#0A......FOR.mo
nth.#3D.jan.TO.dec.DO#0A......$(.LET.day13.#3D.(day
s+12).REM.7#0A.........count!day13.:#3D.count!day13
.+.1#0A.........days.:#3D.days.+.daysinmonth!month#0A
......$)#0A...$)#0A...FOR.day.#3D.mon.TO.sun.DO#0A.
....writef("%i3.%sdays*n",#0A............count!day,
#0A............select(day,#0A.................."Mon
","Tues","Wednes","Thurs","Fri","Sat","Sun")#0A....
.......)#0A...RESULTIS.0#0A$)#0A#0AAND.febdays(year
).#3D.year.REM.400.#3D.0.->.29,#0A.................
...year.REM.100.#3D.0.->.28,#0A....................
year.REM.4...#3D.0.->.29,#0A....................28#0A
#0AAND.select(n,.a0,.a1,.a2,.a3,.a4,.a5,.a6).#3D.n!
@a0#0A#0A#0A

######bcplprogs/demos/genetic.b#
/*#0A#0AThis.is.a.simple.demonstration.of.a.genetic
.algorithm#0A#0AImplemented.in.BCPL.by.Martin.Richa
rds.August.2001#0A*/#0A#0AGET."libhdr"#0A#0AGLOBAL#0A
{.pop:ug#0A..val#0A}#0A#0AMANIFEST#0A{.upb.........
#3D.1000#0A..elite.......#3D.10#0A..generations.#3D
.80#0A..mprob.......#3D.50#0A}#0A#0A//.The.problem.
is.to.find.a.w.that.maximises.eval(w)#0A#0A//LET.ev
al(w).#3D..-10000<w<10000.->.w*w.&.#23x7FFFFFFF,.w>
>16#0A#0ALET.eval(w).#3D.w#3D0.->.0,.1+eval(w&(w-1)
)#0A#0ALET.start().#3D.VALOF#0A{.writef("Population
.#3D.%n..Elite.#3D.%n*n",.upb,.elite)#0A#0A..pop.:#3D
.getvec(upb)#0A..val.:#3D.getvec(upb)#0A#0A..FOR.i.
#3D.1.TO.upb.DO.pop!i.:#3D.rand()#0A#0A..FOR.i.#3D.
1.TO.generations.DO#0A..{.#0A....//.Calculate.the.f
itness.of.each.member.of.the.population#0A....FOR.i
.#3D.1.TO.upb.DO.val!i.:#3D.eval(pop!i)#0A#0A....//
.Sort.into.decreasing.order.of.fitness#0A....sort(1
,.upb)#0A#0A//UNLESS.i.REM.10.DO#0A{...writef("*nGe
neration.%n*n",.i)#0A....FOR.i.#3D.1.TO.upb>20.->.2
0,.upb.DO#0A....{.writef(".%i9/%x8",.val!i,.pop!i)#0A
......UNLESS.i.REM.4.DO.newline()#0A....}#0A//abort
(1000)#0A}#0A....//.Mate.pairs#0A....FOR.r.#3D.upb.
TO.elite+1.BY.-1.DO#0A....{.//.Choose.random.parent
s#0A......LET.p.#3D.randno(r)#0A......LET.q.#3D.ran
dno(r)#0A......LET.a,.b.#3D.pop!p,.pop!q#0A......LE
T.mask.#3D.rand()#0A......LET.x.#3D.a.NEQV.b#0A.#0A
//writef("mask.#3D.%x8.m1#3D%x8.m2#3D%x8*n",.mask,.
m1,.m2)#0A......#0A//writef("a.#3D.%bW*n",.a)#0A//w
ritef("b.#3D.%bW*n",.b)#0A//writef("m.#3D.%bW*n",.m
ask)#0A......a.:#3D.a.NEQV.x.&.mask#0A//writef("a.#3D
.%bW*n",.a)#0A//abort(1001)#0A#0A......pop!r.:#3D.a
#0A....}#0A#0A....//.Mutate.mprob%.of.non.elite.mem
bers#0A....FOR.i.#3D.elite+1.TO.upb.IF.randno(100)<
#3Dmprob.DO#0A......pop!i.:#3D.pop!i.NEQV.1.<<.(ran
dno(100000).&.31)#0A#0A....//.Do.it.again.--.to.all
ow.a.possible.2.bit.mutation#0A....FOR.i.#3D.elite+
1.TO.upb.IF.randno(100)<#3Dmprob.DO#0A......pop!i.:
#3D.pop!i.NEQV.1.<<.(randno(100000).&.31)#0A..}#0A#0A
..freevec(pop)#0A..freevec(val)#0A..RESULTIS.0#0A}#0A
#0AAND.rand().#3D.randno(100000).NEQV.randno(10000)
<<20#0A#0AAND.sort(l,.r).BE#0A{.WHILE.l+8<r.DO#0A..
{.LET.midpt.#3D.(l+r)/2#0A....//.Select.a.good(ish)
.median.value#2E#0A....LET.med.#3D.middle(val!l,.va
l!midpt,.val!r)#0A....LET.i.#3D.partition(med,.l,.r
)#0A//writef("l#3D%i4..r#3D%i4..med#3D%i6..i#3D%i4*
n",#0A//........l,.....r,.....med,.....i)#0A//abort
(1001)#0A....//.Only.use.recursion.on.the.smaller.p
artition#2E#0A....TEST.i>midpt.THEN.{.sort(i,.r);..
.r.:#3D.i-1.}#0A.................ELSE.{.sort(l,.i-1
);.l.:#3D.i...}#0A..}#0A#0A..FOR.p.#3D.l+1.TO.r.DO.
.//.Now.perform.insertion.sort#2E#0A..{.LET.w,.x.#3D
.pop!p,.val!p#0A....FOR.q.#3D.p.TO.l+1.BY.-1.DO#0A.
...{.LET.y.#3D.val!(q-1)#0A......IF.y>#3Dx.DO#0A...
...{.pop!q,.val!q.:#3D.w,.x#0A........BREAK#0A.....
.}#0A......pop!q,.val!q.:#3D.pop!(q-1),.y#0A....}#0A
..}#0A//..sorted(l+1,.r)#0A}#0A#0AAND.middle(a,.b,.
c).#3D.a<b.->.b<c.->........b,#0A..................
..................a<c.->.c,#0A.....................
......................a,#0A........................
.....b<c.->.a<c.->.a,#0A...........................
................c,#0A..............................
.............b#0A#0AAND.partition(median,.p,.q).#3D
.VALOF#0A{.LET.t.#3D.?#0A..WHILE.val!p.>.median.DO.
p.:#3D.p+1#0A..WHILE.val!q.<.median.DO.q.:#3D.q-1#0A
#0A..IF.p>#3Dq.RESULTIS.p#0A#0A..t..:#3D.pop!p;.pop
!p.:#3D.pop!q;.pop!q.:#3D.t#0A..t..:#3D.val!p;.val!
p.:#3D.val!q;.val!q.:#3D.t#0A..p,.q.:#3D.p+1,.q-1#0A
}.REPEAT#0A#0AAND.sorted(p,.q).BE.FOR.i.#3D.p.TO.q-
1.UNLESS.val!p>#3Dval!(p+1).DO.abort(9999)#0A

######bcplprogs/demos/green.b#
GET"libhdr"#0A#0ALET.start().BE#0A$(.LET.a,b,c,d,e,
f,g,h.#3D.0,0,0,0,0,0,0,1#0A#0A...FOR.day.#3D.1.TO.
28.DO#0A...$(.h.:#3D.h+g#0A......g.:#3D.f#0A......f
.:#3D.e#0A......e.:#3D.d#0A......d.:#3D.c#0A......c
.:#3D.b#0A......b.:#3D.a#0A......a.:#3D.8.*.h#0A...
..#0A......writef("number.of.greenfly.at.end.of.day
.%N.is.%I8*N",#0A..............day,.a+b+c+d+e+f+g+h
)#0A...$)#0A$)#0A#0A

######bcplprogs/demos/growth.b#
GET."libhdr"#0A#0AGLOBAL.{.C:200;.upb;.step;.i.}#0A
#0ALET.start().#3D.VALOF#0A{.LET.k.#3D.2#0A..LET.co
unt.#3D.0#0A..LET.argv.#3D.VEC.50#0A#0A..UNLESS.rda
rgs("i/n,.upb/n,.step/n",.argv,.50).DO#0A..{.writef
("")#0A....RESULTIS.0#0A..}#0A#0A..i,.upb,.step.:#3D
.1,.1_000_000,.10_000#0A#0A..IF.argv!0.DO.i....:#3D
.!(argv!0)#0A..IF.argv!1.DO.upb..:#3D.!(argv!1)#0A.
.IF.argv!2.DO.step.:#3D.!(argv!2)#0A#0A..C.:#3D.get
vec(upb)#0A#0A..C!0.:#3D.1#0A#0A..newline()#0A#0A..
SWITCHON.i.INTO#0A..{.DEFAULT:#0A......writef("Unkn
own.recurrence.relation:.%n*n",.i)#0A......GOTO.fin
#0A#0A....CASE.1:#0A......writef("C(n).#3D.n.+.C(n/
%n).+.C(n**%n/%n)*n",.k,.k-1,.k)#0A......FOR.n.#3D.
1.TO.upb.DO.C!n.:#3D.n.+.C!(n/k).+.C!(n*(k-1)/k)#0A
......ENDCASE#0A....CASE.2:#0A......writef("C(n).#3D
.n/5.+.C(n/%n).+.C(n**%n/%n)*n",.k,.k-1,.k)#0A.....
.FOR.n.#3D.1.TO.upb.DO.C!n.:#3D.n/5.+.C!(n/k).+.C!(
n*(k-1)/k)#0A......ENDCASE#0A....CASE.3:#0A......wr
itef("C(n).#3D.1.+.C(n/%n).+.C(n**%n/%n)*n",.k,.k-1
,.k)#0A......FOR.n.#3D.1.TO.upb.DO.C!n.:#3D.1.+.C!(
n/k).+.C!(n*(k-1)/k)#0A......ENDCASE#0A....CASE.4:#0A
......writef("C(n).#3D.1.+.C(n/2)*n")#0A......FOR.n
.#3D.1.TO.upb.DO.C!n.:#3D.1.+.C!(n/2)#0A......ENDCA
SE#0A....CASE.5:#0A......writef("C(n).#3D.1.+.C(n-1
)*n")#0A......FOR.n.#3D.1.TO.upb.DO.C!n.:#3D.1.+.C!
(n-1)#0A......ENDCASE#0A....CASE.6:#0A......writef(
"C(n).#3D.1.+.C(n-1).+.C(n/2)*n")#0A......FOR.n.#3D
.1.TO.upb.DO.C!n.:#3D.1.+.C!(n-1).+.C!(n/2)#0A.....
.ENDCASE#0A....CASE.7:#0A......writef("C(n).#3D.2.+
.C((n-1)/2)*n")#0A......FOR.n.#3D.1.TO.upb.DO.C!n.:
#3D.2.+.C!((n-1)/2)#0A......ENDCASE#0A....CASE.8:#0A
......writef("C(n).#3D.4.+.C((n-2)/3)*n")#0A......F
OR.n.#3D.1.TO.upb.DO.C!n.:#3D.4.+.C!((n-2)/3)#0A...
...ENDCASE#0A..}#0A#0A..FOR.n.#3D.0.TO.upb.UNLESS.n
.REM.step.DO#0A..{.UNLESS.count.REM.10.DO.writef("*
n%i9:.",.n)#0A....count.:#3D.count+1#0A....writef("
.%i9",.C!n)#0A..}#0Afin:#0A..newline()#0A..freevec(
C)#0A..RESULTIS.0#0A}#0A#0A

######bcplprogs/demos/ham23.b#
SECTION."ham23"#0A#0AGET."libhdr"#0A#0AMANIFEST.$(.
upb#3D100.$)#0A#0ALET.new(args).BE#0A$(.LET.p,.nx2,
.nx3.#3D.args!0,.args!1,.args!2#0A...LET.x2,.x3.#3D
.1,.1#0A...cowait()........//.End.of.initialisation
#2E#0A#0A...$(.LET.val.#3D.x2<x3.->.x2,.x3#0A......
IF.intflag().DO.abort(98)#0A......cowait(val)..//.R
eturn.next.value#2E#0A......!p.:#3D.val#0A......p.:
#3D.p+1#0A......IF.val#3Dx2.DO.x2.:#3D.callco(nx2)#0A
......IF.val#3Dx3.DO.x3.:#3D.callco(nx3)#0A...$).RE
PEAT#0A$)#0A#0AAND.mul(args).BE#0A$(.LET.p,.k.#3D.a
rgs!0,.args!1#0A...cowait()......//.End.of.initiali
sation#2E#0A...#0A...$(.cowait(k.*.!p)..//.Return.n
ext.value#0A......p.:#3D.p+1#0A...$).REPEAT#0A$)#0A
#0ALET.start().BE#0A$(.LET.v.#3D.getvec(upb)#0A...L
ET.nx2..#3D.initco(mul,.100,.v,.2)#0A...LET.nx3..#3D
.initco(mul,.100,.v,.3)#0A...LET.next.#3D.initco(ne
w,.100,.v,.nx2,.nx3)#0A...#0A...FOR.i.#3D.1.TO.upb.
DO.$(.writef(".%i6",.callco(next))#0A..............
............IF.i.REM.10.#3D.0.DO.newline()#0A......
.................$)#0A#0A...deleteco(nx2);.deleteco
(nx3);.deleteco(next)#0A...freevec(v)#0A$)#0A

######bcplprogs/demos/hamming1.b#
GET."libhdr"#0A#0ALET.buf(args).BE....//.Body.of.BU
F1,.BUF2.and.BUF3#0A{.LET.p,.q,.val.#3D.0,.0,.0#0A.
.LET.v.#3D.VEC.200#0A#0A..{.val.:#3D.cowait(val)#0A
....TEST.val#3D0.THEN.{.IF.p#3Dq.DO.writef("Buffer.
empty*n")#0A......................val.:#3D.v!(q.REM
.201)#0A......................q.:#3D.q+1#0A........
............}#0A...............ELSE.{.IF.p#3Dq+201.
DO.writef("Buffer.full*n")#0A......................
v!(p.REM.201).:#3D.val#0A......................p.:#3D
.p+1#0A....................}#0A..}.REPEAT#0A}#0A#0A
LET.tee(args).BE....//.Body.of.TEE1.and.TEE2#0A{.LE
T.in,.out.#3D.args!0,.args!1#0A..cowait()..........
//.End.of.initialisation#2E#0A#0A..{.LET.val.#3D.ca
llco(in,.0)#0A....callco(out,.val)#0A....cowait(val
)#0A..}.REPEAT#0A}#0A#0AAND.mul(args).BE....//.Body
.of.X2,.X3.and.X5#0A{.LET.k,.in.#3D.args!0,.args!1#0A
..cowait()..........//.End.of.initialisation#2E#0A.
..#0A..cowait(k.*.callco(in,.0)).REPEAT#0A}#0A#0ALE
T.merge(args).BE..//.Body.of.MER1.and.MER2#0A{.LET.
inx,.iny.#3D.args!0,.args!1#0A..LET.x,.y,.min.#3D.0
,.0,.0#0A..cowait()..........//.End.of.initialisati
on#0A#0A..{.IF.x#3Dmin.DO.x.:#3D.callco(inx,.0)#0A.
...IF.y#3Dmin.DO.y.:#3D.callco(iny,.0)#0A....min.:#3D
.x<y.->.x,.y#0A....cowait(min)#0A..}.REPEAT#0A}#0A#0A
LET.start().#3D.VALOF#0A{.LET.BUF1.#3D.initco(buf,.
..500)#0A..LET.BUF2.#3D.initco(buf,...500)#0A..LET.
BUF3.#3D.initco(buf,...500)#0A..LET.TEE1.#3D.initco
(tee,...100,.BUF1,.BUF2)#0A..LET.TEE2.#3D.initco(te
e,...100,.BUF2,.BUF3)#0A..LET.X2...#3D.initco(mul,.
..100,....2,.TEE1)#0A..LET.X3...#3D.initco(mul,...1
00,....3,.TEE2)#0A..LET.X5...#3D.initco(mul,...100,
....5,.BUF3)#0A..LET.MER1.#3D.initco(merge,.100,...
X2,...X3)#0A..LET.MER2.#3D.initco(merge,.100,.MER1,
...X5)#0A#0A..LET.val.#3D.1...#0A..FOR.i.#3D.1.TO.1
00.DO.{.writef(".%i6",.val)#0A.....................
...IF.i.REM.10.#3D.0.DO.newline()#0A...............
.........callco(BUF1,.val)#0A......................
..val.:#3D.callco(MER2)#0A......................}#0A
#0A..deleteco(BUF1);.deleteco(BUF2);.deleteco(BUF3)
#0A..deleteco(TEE1);.deleteco(TEE2)#0A..deleteco(X2
);.deleteco(X3);.deleteco(X5)#0A..deleteco(MER1);.d
eleteco(MER2)#0A..RESULTIS.0#0A}#0A

######bcplprogs/demos/hamming2.b#
SECTION."hamming"#0A#0AGET."libhdr"#0A#0AMANIFEST.{
.upb#3D100.}#0A#0ALET.new(args).BE#0A{.LET.p,.nx2,.
nx3,.nx5.#3D.args!0,.args!1,.args!2,.args!3#0A..LET
.x2,.x3,.x5.#3D.1,.1,.1#0A..cowait()........//.End.
of.initialisation#2E#0A#0A..{.LET.val.#3D.x2<x3.->.
(x2<x5.->.x2,.x5),#0A.......................(x3<x5.
->.x3,.x5)#0A....IF.intflag().DO.abort(98)#0A....co
wait(val)..//.Return.next.value#2E#0A....!p.:#3D.va
l#0A....p.:#3D.p+1#0A....IF.val#3Dx2.DO.x2.:#3D.cal
lco(nx2)#0A....IF.val#3Dx3.DO.x3.:#3D.callco(nx3)#0A
....IF.val#3Dx5.DO.x5.:#3D.callco(nx5)#0A..}.REPEAT
#0A}#0A#0AAND.mul(args).BE#0A{.LET.p,.k.#3D.args!0,
.args!1#0A..cowait()......//.End.of.initialisation#2E
#0A...#0A..{.cowait(k.*.!p)..//.Return.next.value#0A
....p.:#3D.p+1#0A..}.REPEAT#0A}#0A#0ALET.start().#3D
.VALOF#0A{.LET.v....#3D.getvec(upb)#0A..LET.nx2..#3D
.initco(mul,.100,.v,.2)#0A..LET.nx3..#3D.initco(mul
,.100,.v,.3)#0A..LET.nx5..#3D.initco(mul,.100,.v,.5
)#0A..LET.next.#3D.initco(new,.100,.v,.nx2,.nx3,.nx
5)#0A...#0A..FOR.i.#3D.1.TO.upb.DO.{.writef(".%i6",
.callco(next))#0A........................IF.i.REM.1
0.#3D.0.DO.newline()#0A......................}#0A#0A
..deleteco(nx2);.deleteco(nx3);.deleteco(nx5);.dele
teco(next)#0A..freevec(v)#0A..RESULTIS.0#0A}#0A#0A

######bcplprogs/demos/hash2n.b#
//.This.program.tries.out.hash.functions.for.powers
.of.2#0A#0AGET."libhdr"#0A#0ALET.start().#3D.VALOF#0A
{.LET.used.#3D.VEC.100#0A#0A..FOR.d.#3D.2.TO.67.DO#0A
..{.LET.r.#3D.1#0A....FOR.i.#3D.0.TO.100.DO.used!i.
:#3D.FALSE#0A#0A....writef("*n*n2****n.mod.%n...for
.n.in.0#2E#2E%n*n*n",#0A...................d,......
..........d-1)#0A....FOR.i.#3D.1.TO.d.DO#0A....{.wr
itef("%i2%c.",.r,.used!r->'#23',.'.')#0A......IF.i.
REM.16.#3D.0.DO.newline()#0A......used!r.:#3D.TRUE#0A
......r.:#3D.(2*r).REM.d#0A....}#0A..}#0A#0A..write
f("*n*nEnd.of.test*n")#0A..RESULTIS.0#0A}

######bcplprogs/demos/hashtabs.b#
GET."libhdr"#0A#0AGLOBAL.{#0A..tab:ug...//.The.hash
.table.with.tabsize.entries#0A..p0.......//.The.lat
est.primary.probe#0A..hash2....//.the.latest.result
.of.the.second.hash.function#0A..entries..//.Number
.of.entries.in.the.table#0A..prcount..//.count.of.p
robes#0A..maxprcount.//.The.longest.probe.sequence.
needed.to.lookup.a.key#0A..tabsize..//.Hash.table.s
ize#0A..initseed.....//.Random.number.seed#0A}#0A#0A
LET.start().#3D.VALOF#0A{.LET.argv.#3D.VEC.50#0A#0A
..UNLESS.rdargs("size,seed,np#3Dnotprime",.argv,.50
).DO#0A..{.writef("Bad.argument*n")#0A....RESULTIS.
0#0A..}#0A#0A..tabsize,.initseed.:#3D.541,.1#0A..IF
.argv!0.&.string#2Eto#2Enumber(argv!0).DO.tabsize.:
#3D.result2#0A..IF.argv!1.&.string#2Eto#2Enumber(ar
gv!1).DO.initseed.:#3D.result2#0A#0A..UNLESS.argv!2
.UNTIL.isprime(tabsize).DO.tabsize.:#3D.tabsize+1#0A
#0A..writef("tabsize#3D%n..seed#3D%n*n",.tabsize,.i
nitseed)#0A#0A..tab.:#3D.getvec(tabsize)#0A..UNLESS
.tab.DO#0A..{.writef("Unable.to.allocate.the.hash.t
able*n")#0A....RESULTIS.0#0A..}#0A#0A..try("sh1",.p
h,.sh1,.50)#0A..//try("sh1",.ph,.sh1,.60)#0A..try("
sh1",.ph,.sh1,.70)#0A..//try("sh1",.ph,.sh1,.80)#0A
..try("sh1",.ph,.sh1,.90)#0A..try("sh1",.ph,.sh1,.9
5)#0A..//try("sh1",.ph,.sh1,.99)#0A..newline()#0A..
#0A..try("sh2",.ph,.sh2,.50)#0A..//try("sh2",.ph,.s
h2,.60)#0A..try("sh2",.ph,.sh2,.70)#0A..//try("sh2"
,.ph,.sh2,.80)#0A..try("sh2",.ph,.sh2,.90)#0A..try(
"sh2",.ph,.sh2,.95)#0A..//try("sh2",.ph,.sh2,.99)#0A
..newline()#0A..#0A..try("sh3",.ph,.sh3,.50)#0A..//
try("sh3",.ph,.sh3,.60)#0A..try("sh3",.ph,.sh3,.70)
#0A..//try("sh3",.ph,.sh3,.80)#0A..try("sh3",.ph,.s
h3,.90)#0A..try("sh3",.ph,.sh3,.95)#0A..//try("sh3"
,.ph,.sh3,.99)#0A..newline()#0A..#0A..try("sh4",.ph
,.sh4,.50)#0A..//try("sh4",.ph,.sh4,.60)#0A..try("s
h4",.ph,.sh4,.70)#0A..//try("sh4",.ph,.sh4,.80)#0A.
.try("sh4",.ph,.sh4,.90)#0A..try("sh4",.ph,.sh4,.95
)#0A..//try("sh4",.ph,.sh4,.99)#0A..newline()#0A..#0A
..try("sh5",.ph,.sh5,.50)#0A..//try("sh5",.ph,.sh5,
.60)#0A..try("sh5",.ph,.sh5,.70)#0A..//try("sh5",.p
h,.sh5,.80)#0A..try("sh5",.ph,.sh5,.90)#0A..try("sh
5",.ph,.sh5,.95)#0A..//try("sh5",.ph,.sh5,.99)#0A..
newline()#0A..#0A#0A..IF.tab.DO.freevec(tab)#0A..RE
SULTIS.0..#0A}#0A#0AAND.isprime(n).#3D.VALOF#0A{.LE
T.i.#3D.2#0A..UNTIL.i*i>n.TEST.n.MOD.i.#3D.0#0A....
..........THEN.RESULTIS.FALSE#0A..............ELSE.
i.:#3D.i+1#0A..RESULTIS.TRUE#0A}#0A#0AAND.try(metho
d,.f1,.f2,.u).BE#0A{.LET.ipart,.fpart,.x,.maxk.#3D.
0,.0,.0,.0#0A..LET.k.#3D.tabsize.*.u./.100#0A#0A..s
etseed(initseed)#0A#0A..//.For.the.raster.scan.pict
ures#0A..FOR.i.#3D.1.TO.10000.DO.tab!0,.tab!tabsize
.:#3D.0,.0#0A#0A..FOR.i.#3D.0.TO.tabsize.DO.tab!i.:
#3D.-1#0A..entries.:#3D.0#0A..UNTIL.entries>#3Dk.DO
#0A..{.LET.key.#3D.randno(100_000_000)#0A....//writ
ef("key#3D%n*n",.key);.entries.:#3D.entries+1#0A...
.insert(key,.f1,.f2)#0A..}#0A#0A..prcount.:#3D.0#0A
..FOR.i.#3D.0.TO.tabsize-1.DO#0A..{.LET.key.#3D.tab
!i#0A....IF.key.>#3D.0.DO#0A....{.LET.k.#3D.prcount
#0A......lookup(key,.f1,.f2)#0A......k.:#3D.prcount
.-.k#0A......IF.maxk.<.k.DO.maxk.:#3D.k#0A....}#0A.
.}#0A..//writef("k#3D%n..prcount#3D%n*n",.k,.prcoun
t)#0A..x.:#3D.muldiv(prcount,.1000,.k)#0A#0A..ipart
,.fpart.:#3D.x/1000,.x.MOD.1000#0A#0A..writef("Meth
od.%s,.%i2%%.used,.",.method,.u)#0A..writef("..max.
probes.%i5..average.%i4#2E%z3*n",.maxk,.ipart,.fpar
t)#0A}#0A#0AAND.insert(key,.f1,.f2).BE#0A{#0A..//wr
itef("insert:.key.#3D.%n*n",.key)#0A..f1()#0A..//wr
itef("insert:.probe.%n*n",.p0)#0A..IF.tab!p0<0.DO#0A
..{.tab!p0.:#3D.key#0A....entries.:#3D.entries+1#0A
....RETURN#0A..}#0A..FOR.i.#3D.1.TO.tabsize.DO.//.D
on't.allow.too.many.probes#0A..{.LET.p.#3D.f2(i)#0A
....//writef("insert:.p#3D%n..tab!p#3D%n*n",.p,.tab
!p)#0A....IF.tab!p<0.DO#0A....{.tab!p.:#3D.key#0A..
....entries.:#3D.entries+1#0A......RETURN#0A....}#0A
..}#0A#0A..writef("Cannot.insert.a.key*n")#0A..FOR.
i.#3D.0.TO.tabsize-1.DO#0A..{.IF.i.MOD.50.#3D.0.DO.
newline()#0A....writef("%c",.tab!i#3D-1.->.'#2E',.'
**')#0A..}#0A..newline()#0A..abort(999)#0A}#0A#0AAN
D.lookup(key,.f1,.f2).#3D.VALOF#0A{.f1()#0A..prcoun
t.:#3D.prcount+1#0A..IF.tab!p0<0.RESULTIS.-1#0A..IF
.tab!p0.#3D.key.RESULTIS.key#0A#0A..FOR.i.#3D.1.TO.
1000.DO.//.Don't.allow.too.many.probes#0A..{.LET.p.
#3D.f2(i)#0A....prcount.:#3D.prcount+1#0A....IF.tab
!p<0.RESULTIS.-1#0A....IF.tab!p.#3D.key.RESULTIS.ke
y#0A..}#0A#0A..RESULTIS.-1#0A}#0A#0AAND.ph(key).#3D
.VALOF#0A{.hash2.:#3D.(key*key.>>.1).MOD.1000#0A..p
0.:#3D.key.MOD.tabsize#0A..RESULTIS.p0#0A}#0A#0AAND
.sh1(i).#3D.(p0.+.i).MOD.tabsize#0A#0AAND.sh2(i).#3D
.(p0.+.13*i).MOD.tabsize#0A#0AAND.sh3(i).#3D.(p0.+.
13*i.+.17*i*i).MOD.tabsize#0A#0AAND.sh4(i).#3D.(p0.
+.hash2*i.+.17*i*i).MOD.tabsize#0A#0AAND.sh5(i).#3D
.(p0.+.(hash2+1)*i).MOD.tabsize#0A#0A

######bcplprogs/demos/hello.b#
GET."libhdr"#0A#0ALET.start().#3D.VALOF#0A$(.writes
("Hello.world*n")#0A...RESULTIS.0#0A$)#0A#0A

######bcplprogs/demos/huffman.b#
//.This.program.reads.a.file.of.integer.frequency.c
ounts.and#0A//.outputs.information.about.its.Huffma
n.encoding#2E#0A#0A//.Written.by.Martin.Richards..6
.July.1998#0A//.(Based.on.a.C.program.by.D#2EJ#2EWh
eeler#2E)#0A.#0AGET."libhdr"#0A#0AGLOBAL.{#0A.data:
.200;..lenv#0A.infile;.outfile;.stdin;.stdout#0A.in
filename;.outfilename#0A.debug1;.debug2;.debug3;.de
bug4#0A}#0A#0ALET.start().#3D.VALOF#0A{.LET.argv.#3D
.VEC.50#0A..LET.n.#3D.0#0A..LET.bitcount.#3D.0#0A#0A
..stdin.:#3D.input()#0A..stdout.:#3D.output()#0A#0A
..IF.rdargs("DATA,TO/K,HELP/S,D1/S,D2/S,D3/S,D4/S",
.argv,.50)#3D0.DO#0A..{.writes("Bad.arguments.for.h
uffman*n")#0A....RESULTIS.10#0A..}#0A#0A..infilenam
e.:#3D.argv!0.->.argv!0,."FREQS"#0A..outfilename.:#3D
.argv!1.->.argv!1,."**"#0A#0A..IF.argv!2.DO#0A..{.w
rites("*nThis.program.reads.a.file.of.integers.that
.represent*n")#0A....writes("the.frequencies.of.a.s
et.of.symbols#2E.It.computes*n")#0A....writes("a.Hu
ffman.tree.and.output.statistical.information*n")#0A
....writes("controlled.by.the.switch.arguments.D1,.
D2,.D3.and.D4*n")#0A....writes("*n")#0A....writes("
D1....output.the.Huffman.encodings*n")#0A....writes
("D2....output.the.frequency.table*n")#0A....writes
("D3....output.the.Huffman.tree*n")#0A....writes("D
4....output.the.number.of.codes.of.each.length*n")#0A
....writes("*n")#0A....writes("DATA..name.of.freque
ncy.counts.file*n")#0A....writes("TO....name.of.the
.output.file")#0A....writes("*n")#0A....RESULTIS.0#0A
..}#0A..debug1.:#3D.argv!3#0A..debug2.:#3D.argv!4#0A
..debug3.:#3D.argv!5#0A..debug4.:#3D.argv!6#0A#0A..
data.:#3D.getvec(10000)#0A..lenv.:#3D.getvec(10000)
#0A#0A..n.:#3D.readdata(infilename,.data)#0A#0A..IF
.debug2.DO#0A..{.writef("*nFrequency.counts*n*n")#0A
....FOR.i.#3D.0.TO.n-1.DO.writef("%i3:.%i3*n",.i,.d
ata!i)#0A..}#0A..outfile.:#3D.findoutput(outfilenam
e)#0A..IF.outfile#3D0.DO#0A..{.writef("Can't.open.f
ile.%s*n",.outfilename)#0A....n.:#3D.0#0A....outfil
e.:#3D.stdout#0A..}#0A#0A..selectoutput(outfile)#0A
#0A..IF.n>1.DO#0A..{.bitcount.:#3D.huffgen(data,.le
nv,.n)#0A#0A....IF.debug1.DO#0A....{.writef("*nHuff
man.codes:*n*n")#0A#0A......FOR.i.#3D.0.TO.n-1.DO#0A
......{.LET.len.#3D.lenv!i#0A........IF.len#3D0.LOO
P#0A........writef(".%i3.%i2:.",.i,.len)#0A........
writebin(data!i,.len)#0A........newline()#0A......}
#0A....}#0A#0A....writef("*nLength.of.encoded.data.
#3D.%n.bits.(%n.bytes)*n",#0A............bitcount,.
(bitcount+7)/8)#0A..}#0A#0A..UNLESS.outfile#3Dstdou
t.DO#0A..{.endwrite()#0A....selectoutput(stdout)#0A
..}#0A..freevec(data)#0A..freevec(lenv)#0A..RESULTI
S.0#0A}#0A#0AAND.readdata(filename,.v).#3D.VALOF#0A
{.LET.instr.#3D.findinput(filename)#0A..LET.stdin.#3D
.input()#0A#0A..LET.n.#3D.0#0A#0A..IF.instr#3D0.DO#0A
..{.writef("Can't.open.file:.%s*n",.filename)#0A...
.RESULTIS.-1#0A..}#0A#0A..selectinput()#0A#0A..{.LE
T.val.#3D.readn()#0A....IF.val#3D0.&.result2<0.BREA
K#0A....v!n.:#3D.val#0A....n.:#3D.n+1#0A..}.REPEAT#0A
#0A..endread()#0A..selectinput(stdin)#0A..RESULTIS.
n#0A}#0A#0AAND.shell(v,.pt,.n).BE#0A{.LET.k.#3D.(n+
3)/5#0A..WHILE.k>0.DO#0A..{.FOR.p#3D0.TO.n-k-1.DO#0A
....{.LET.x.#3D.v!(pt!(p+k))#0A......IF.x.<.v!(pt!p
).DO#0A......{.LET.q..#3D.p-k#0A........LET.pk.#3D.
pt!(p+k)#0A........pt!(p+k).:#3D.pt!p#0A........WHI
LE.q>#3D0.&.v!(pt!q)>x.DO.{.pt!(q+k).:#3D.pt!q;.q.:
#3D.q-k.}#0A........pt!(q+k).:#3D.pk#0A......}.#0A.
...}#0A....k.:#3D.(k+1)/3#0A..}#0A}#0A#0AAND.huffge
n(f,.len,.n).#3D.VALOF#0A{#0A../*.f!0.#2E#2E#2E.f!(
n-1).contain.frequencies.of.items.0#2E#2E#2En-1#0A.
..*.On.return:#0A...*...f!i.contains.code.for.item.
i#0A...*...len!i.contains.the.bit.length.of.code.fo
r.item.i#0A...*...the.result.is.the.bit.length.of.t
he.huffman.encoded.data#0A...*...(#3D.the.sum.of.th
e.internal.node.frequencies)#0A..*/#0A..LET.m,.p,.q
.#3D.?,.?,.?#0A..LET.bits.#3D.?#0A..LET.mlim.#3D.0#0A
..LET.u.#3D.0#0A..LET.r.#3D.22#0A..LET.cts.#3D.VEC.
50#0A..LET.pt.#3D.getvec(n)#0A..LET.type,.sum.#3D.?
,.?#0A#0A..FOR.j#3Dn-1.TO.0.BY.-1.DO#0A..{.LET.x.#3D
.f!j#0A....IF.x.DO.{.pt!mlim.:#3D.j;.mlim.:#3D.mlim
+1;.u.:#3D.u+x.}#0A....len!j.:#3D.0#0A..}#0A../*.pt
.now.contains.pointers.(subscripts).to.the.non-zero
.elements.of.f#0A...*.mlim.#3D.no.of.non-zero.eleme
nts.of.f#0A...*.u.#3D.the.cumulative.total.of.the.f
requencies,.ie.SUM(f!i)#0A..*/#0A#0A..type.:#3D.get
vec(mlim)#0A..sum..:#3D.getvec(mlim)#0A#0A..//.Now.
sort.pt!0#2E#2E#2Ept!(mlim-1).so.that.i.#3D>.f!pt!i
<#3Df!pt!(i+1)#0A#0A..shell(f,pt,mlim)#0A#0A..FOR.j
#3D0.TO.mlim-2.IF.f!(pt!j).>.f!(pt!(j+1)).DO.writef
("bug.%n*n",.j)#0A#0Ajs:#0A..FOR.m#3D0.TO.mlim-1.DO
.sum!m.:#3D.#23x7000000.//.no.f!i.will.be.this.big#0A
..m.:#3D.0#0A..p.:#3D.0#0A..q.:#3D.0#0A#0A../*.Form
.the.Huffman.tree.by.successively.combining.nodes#0A
...*.(whether.leaf.or.internal).which.have.the.lowe
st.pair.of#0A...*.frequencies#2E#0A...*#0A...*.f!pt
!0#2E#2E#2Ef!pt!(mlim-1).give.the.leaf.node.frequen
cies#0A...*.sum!0#2E#2E#2Esum!(mlim-2).give.the.int
ernal.node.frequencies#0A...*........(both.are.in.i
ncreasing.frequency.order)#0A...*#0A...*.type!i.des
cribes.how.internal.node.i.was.formed#0A...*.......
..........0.#3D>.leaf.....+.leaf#0A...*............
.....1.#3D>.internal.+.leaf#0A...*.................
2.#3D>.internal.+.internal#0A...*.The.values.in.typ
e.uniquely.specify.the.tree.shape#2E#0A...*#0A...*.
Example:#0A...*#0A...*.f!(pt!*).....1..1..1..1..1..
1..1..1..2..4..5#0A...*.type!*.......0..0..0..0..1.
.2..1..2..1..2#0A...*.sum!*........2..2..2..2..4..4
..6..8.11.19#0A...*#0A...*.The.tree.is.formed.as.fo
llows:#0A...*#0A...*....Type.0.#3D>.N0(2)..#3D.L0(1
).+.L1(1)#0A...*....Type.0.#3D>.N1(2)..#3D.L2(1).+.
L3(1)#0A...*....Type.0.#3D>.N2(2)..#3D.L4(1).+.L5(1
)#0A...*....Type.0.#3D>.N3(2)..#3D.L6(1).+.L7(1)#0A
...*....Type.1.#3D>.N4(4)..#3D.N0(2).+.L8(2)#0A...*
....Type.2.#3D>.N5(4)..#3D.N1(2).+.N2(2)#0A...*....
Type.1.#3D>.N6(6)..#3D.N3(2).+.L9(4)#0A...*....Type
.2.#3D>.N7(8)..#3D.N4(4).+.N5(4)#0A...*....Type.1.#3D
>.N8(11).#3D.N6(6).+.L10(5)#0A...*....Type.2.#3D>.N
9(19).#3D.N7(8).+.N8(11)#0A..*/.#0A..WHILE.q<mlim-1
.DO#0A..{.IF.m+1<mlim.&.f!(pt!(m+1))<#3Dsum!p.DO#0A
....{.type!q.:#3D.0..............//.Combine.two.lea
f.nodes.#0A......sum!q.:#3D.f!(pt!m).+.f!(pt!(m+1))
#0A......q.:#3D.q+1#0A......m.:#3D.m+2#0A......LOOP
#0A....}#0A....IF.m<mlim.&.sum!(p+1)<f!(pt!m).|.m#3D
mlim.DO#0A....{.type!q.:#3D.2;.............//.Combi
ne.two.internal.nodes#0A......sum!q.:#3D.sum!p.+.su
m!(p+1)#0A......q.:#3D.q+1#0A......p.:#3D.p+2;#0A..
....LOOP#0A....}#0A....type!q.:#3D.1;..............
.//.Combine.an.internal.with.a.leaf.node#0A....sum!
q.:#3D.sum!p.+.f!(pt!m)#0A....q.:#3D.q+1#0A....p.:#3D
.p+1#0A....m.:#3D.m+1#0A..}#0A#0A..IF.debug3.DO#0A.
.{.FOR.j#3D0.TO.mlim-2.DO#0A....{.LET.t.#3D.type!j#0A
......LET.ts.#3D.t#3D0.->."LL",.t#3D1.->."LN",."NN"
#0A......writef("..%i6.%s*n",.sum!j,.ts)#0A....}#0A
..}#0A#0A../*.Calculate.the.total.bit.length.of.the
.data.when.encoded#0A...*.using.this.Huffman.tree#2E
#0A...*.This.length.equals.the.sum.of.the.internal.
node.frequencies#2E#0A...*.Do.this.before.the.vecto
r.sum.is.used.for.other.purposes#2E#0A..*/.#0A..bit
s.:#3D.0;.#0A..FOR.j#3D0.TO.mlim-2.DO.bits.:#3D.bit
s.+.sum!j#0A#0A../*.cts!j.will.equal.the.number.of.
codes.of.length.j#0A...*.using.sum!i.to.hold.the.di
stance.of.internal.node.i#0A...*.from.the.root#2E#0A
..*/#0A..FOR.j#3D0.TO.49.DO.cts!j.:#3D.0#0A..sum!(q
-1).:#3D.0..............//.Internal.node.q-1.is.the
.root#0A..WHILE.q.DO#0A..{.LET.y.#3D.?#0A....q.:#3D
.q-1#0A....y.:#3D.sum!q+1....//.the.code.length.for
.children.of.node.q.#0A....SWITCHON.type!q.INTO#0A.
...{.CASE.2:.p.:#3D.p-1#0A..............sum!p.:#3D.
y#0A..............p.:#3D.p-1#0A..............sum!p.
:#3D.y#0A..............ENDCASE#0A......CASE.1:.m.:#3D
.m-1#0A..............len!(pt!m).:#3D.y#0A..........
....p.:#3D.p-1#0A..............sum!p.:#3D.y#0A.....
.........cts!y.:#3D.cts!y.+.1#0A..............ENDCA
SE#0A......CASE.0:.m.:#3D.m-1#0A..............len!(
pt!m).:#3D.y#0A..............m.:#3D.m-1#0A.........
.....len!(pt!m).:#3D.y#0A..............cts!y.:#3D.c
ts!y.+.2#0A..............ENDCASE#0A....}#0A..}#0A#0A
..IF.debug4.DO#0A..{.writef("*nLength.counts*n*n")#0A
....FOR.i.#3D.0.TO.23.IF.cts!i.DO.writef("%i3.codes
.of.length.%n*n",.cts!i,.i)#0A..}#0A#0A..IF.len!(pt
!0).>#3D.24.DO#0A..{./*.The.length.of.the.longest.c
ode.is.>#3D.24#0A.....*.Adjust.the.frequencies.of.t
he.least.frequent.items#0A.....*.without.changing.t
he.cumulative.total.to.reduce.the#0A.....*.longest.
code.length#2E#0A.....*.On.each.attempt.we.approxim
ately.double.the.frequency#0A.....*.of.the.least.co
mmon.items#2E#0A....*/#0A....LET.x.#3D.(u>>r)+1..//
.Choose.a.frequency.to.give.to.the.#0A.............
.........//.least.common.items#0A....LET.z.#3D.0#0A
....LET.q.#3D.0#0A....r.:#3D.r-1#0A#0A....WHILE.z>#3D
0.DO#0A....{.z.:#3D.z.+.x.-.f!(pt!q)..........//.z.
#3D.the.change.in.the.cumulative.total#0A......f!(p
t!q).:#3D.x#0A......q.:#3D.q+1#0A....}#0A....f!(pt!
(q-1)).:#3D.f!(pt!(q-1)).-.z.//.Adjust.to.correct.t
he.cumulative.total.#0A....GOTO.js#0A..}#0A#0A../*.
cts!m.now.holds.the.number.of.Huffman.codes.of.leng
th.m,.m#3D0#2E#2E23#0A...*.(we.have.taken.care.that
.there.are.no.codes.longer.than.23)#0A...*.#0A...*.
............0..1..2..3..4..5..6..7..8..9.10#0A...*.
f!(pt!*)....1..1..1..1..1..1..1..1..2..4..5#0A...*.
type!*......0..0..0..0..1..2..1..2..1..2#0A...*.sum
!*.......3..3..3..3..2..2..2..1..1..0#0A...*.len!(p
t!*)..4..4..4..4..4..4..4..4..3..3..2#0A...*#0A...*
.The.tree.is.formed.as.follows:#0A...*#0A...*....Ty
pe.0.#3D>.N0(2)..#3D.L0(1).+.L1(1)#0A...*....Type.0
.#3D>.N1(2)..#3D.L2(1).+.L3(1)#0A...*....Type.0.#3D
>.N2(2)..#3D.L4(1).+.L5(1)#0A...*....Type.0.#3D>.N3
(2)..#3D.L6(1).+.L7(1)#0A...*....Type.1.#3D>.N4(4).
.#3D.N0(2).+.L8(2)#0A...*....Type.2.#3D>.N5(4)..#3D
.N1(2).+.N2(2)#0A...*....Type.1.#3D>.N6(6)..#3D.N3(
2).+.L9(4)#0A...*....Type.2.#3D>.N7(8)..#3D.N4(4).+
.N5(4)#0A...*....Type.1.#3D>.N8(11).#3D.N6(6).+.L10
(5)#0A...*....Type.2.#3D>.N9(19).#3D.N7(8).+.N8(11)
#0A...*#0A...*.cts(2).#3D.1,.cts(3).#3D.2,.cts(4).#3D
.8,.all.others.are.zero#2E#0A...*#0A...*.These.can.
be.used.to.allocate.the.codes,.for.example#0A...*#0A
...*..symb..f(symb)..len(symb)........code#0A...*#0A
...*...0......2.........3..............101#0A...*..
.1......1.........4.........0111#0A...*...5......1.
........4.........0110#0A...*...6......1.........4.
........0101#0A...*...7......5.........2...........
.......11#0A...*..10......1.........4.........0100#0A
...*..11......4.........3..............100#0A...*..
12......1.........4.........0011#0A...*..13......1.
........4.........0010#0A...*..20......1.........4.
........0001#0A...*..21......1.........4.........00
00#0A...*#0A...*.Smallest.code.of.for.length..0000.
100.11#0A...*.Number.of.codes.................8...2
..1#0A...*#0A...*.Note.that.the.symb->code.mapping.
can.be.deduced.from#0A...*.the.symbb->len.mapping#2E
.#0A..*/#0A#0A..{.LET.x.#3D.0#0A....FOR.m#3D49.TO.0
.BY.-1.DO#0A....{.LET.y.#3D.cts!m#0A......cts!m.:#3D
.x...//.Set.the.smallest.Huffman.code.of.length.m#0A
......x.:#3D.x+y.....//.Allocate.y.codes.of.this.le
ngth#0A......x.:#3D.x>>1....//.Calculate.the.smalle
st.code.of.length.m-1#0A....}#0A..}#0A..//.Replace.
elements.of.f.with.their.corresponding..Huffman.cod
es#0A..FOR.m.#3D.n-1.TO.0.BY.-1.DO#0A....IF.len!m.D
O.{.LET.code.#3D.cts!(len!m)#0A..................f!
m.:#3D.code#0A..................cts!(len!m).:#3D.co
de.+.1#0A................}#0A#0A..freevec(pt)#0A..f
reevec(sum)#0A..freevec(type)#0A..RESULTIS.bits#0A}
#0A#0A#0A

######bcplprogs/demos/inpoly.b#
/*The.code.below.is.from.Wm#2E.Randolph.Franklin.<w
rf@ecse#2Erpi#2Eedu>#0A..with.some.minor.modificati
ons.for.speed#2E#0A..comp#2Egraphics#2Ealgorithms.F
AQ.#0A..References:#0A....[Gems.IV]..pp#2E.24-46#0A
....[O'Rourke].pp#2E.233-238#0A....[Glassner:RayTra
cing].*/#0A#0AGET."libhdr"#0A#0ALET.pnpoly(npol,.xp
,.yp,.x,.y).#3D.VALOF#0A{.LET.j,.c.#3D.npol-1,.FALS
E#0A#0A..FOR.i.#3D.0.TO.npol-1.DO#0A..{.IF.(yp!i.<#3D
.y.<.yp!j.|.yp!j.<#3D.y.<.yp!i).&#0A#09x.<.(xp!j.-.
xp!i).*.(y.-.yp!i)./.(yp!j.-.yp!i).+.xp!i.DO#0A....
..c.:#3D.NOT.c#0A....j.:#3D.i#0A..}#0A..RESULTIS.c#0A
}#0A#0ALET.start().#3D.VALOF#0A{.LET.npol,.count.#3D
.20,.0#0A#0A..LET.xp#3D.TABLE.000,100,100,000,000,1
00,-50,-100,-100,-200,#0A...............-250,-200,-
150,-50,100,100,000,-50,-100,-50#0A..LET.yp#3D.TABL
E.000,000,100,100,200,300,200,300,000,-50,#0A......
.........-100,-150,-200,-200,-150,-100,-50,-100,-10
0,-50#0A#0A..FOR.i.#3D.1.TO.100000.DO#0A..{.IF.pnpo
ly(npol,xp,yp,.050,.050).DO.count.:#3D.count+1#0A..
..IF.pnpoly(npol,xp,yp,.050,.150).DO.count.:#3D.cou
nt+1#0A....IF.pnpoly(npol,xp,yp,.-50,.150).DO.count
.:#3D.count+1#0A....IF.pnpoly(npol,xp,yp,.075,.225)
.DO.count.:#3D.count+1#0A....IF.pnpoly(npol,xp,yp,.
..0,.201).DO.count.:#3D.count+1#0A....IF.pnpoly(npo
l,xp,yp,.-50,.250).DO.count.:#3D.count+1#0A....IF.p
npoly(npol,xp,yp,-100,.-50).DO.count.:#3D.count+1#0A
....IF.pnpoly(npol,xp,yp,-150,..50).DO.count.:#3D.c
ount+1#0A....IF.pnpoly(npol,xp,yp,-225,-100).DO.cou
nt.:#3D.count+1#0A....IF.pnpoly(npol,xp,yp,.050,.-2
5).DO.count.:#3D.count+1#0A....IF.pnpoly(npol,xp,yp
,.050,-125).DO.count.:#3D.count+1#0A....IF.pnpoly(n
pol,xp,yp,.-50,-250).DO.count.:#3D.count+1#0A..}#0A
#0A..writef("count.%n*n",.count);#0A..RESULTIS.0#0A
}#0A#0A

######bcplprogs/demos/julian.b#
GET."libhdr"#0A#0A//.This.program.calulates.the.mod
ified.Julian.date#0A//.for.00:00.on.the.given.date#2E
#0A#0A//.On.17.November.1858.it.is.0#0A//.12.hours.
before.the.astronomers.fundamental.epoch#0A//.(noon
.on.1.January.4713.BC.(year#3D-4712)),.it.is.-24000
00#0A.#0ALET.start().#3D.VALOF#0A$(.LET.argv.#3D.VE
C.50#0A...LET.year,.month,.day.#3D.-4712,.1,.1#0A#0A
...IF.rdargs("YEAR,MONTH,DAY",.argv,.50).#3D.0#0A..
.$(.writes("Bad.arguments.for.julian*n")#0A......RE
SULTIS.20#0A...$)#0A...UNLESS.argv!0#3D0.DO.year..:
#3D.str2numb(argv!0)#0A...UNLESS.argv!1#3D0.DO.mont
h.:#3D.str2numb(argv!1)#0A...UNLESS.argv!2#3D0.DO.d
ay...:#3D.str2numb(argv!2)#0A#0A...IF.later(year,.m
onth,.day,.58795,.2,.28).DO#0A...{.writef("Unable.t
o.deal.with.such.a.large.date*n")#0A.....RESULTIS.0
#0A...}#0A#0A...writef("The.Modified.Julian.date.fo
r.%n/%n/%n.is:.%n*n",#0A...........day,.month,.year
,.modifiedjulian(year,.month,.day))#0A#0A...writef(
"It.is.a.%s*n",.dayname(year,.month,.day))#0A...RES
ULTIS.0#0A$)#0A#0AAND.modifiedjulian(year,.month,.d
ay).#3D.VALOF#0A{.LET.b,.c,.d.#3D.0,.0,.0#0A..IF.1<
#3Dmonth<#3D2.DO.year,.month.:#3D.year-1,.month+12#0A
..IF.later(year,.month,.day,.1582,.10+2,.14).DO#0A.
.{.LET.a.#3D.year./.100....//.a.#3D.INT(year/100)#0A
....IF.year<0.DO.a.:#3D.a+1.//.INT.meant.to.round.t
owards.0#0A....b.:#3D.2.-.a.+.a/4#0A..}#0A..TEST.ye
ar<#3D0#0A..THEN.c.:#3D.(36525*year.-.75)/100..//.I
NT(365#2E25*year.-.0#2E75)#0A..ELSE.c.:#3D.(36525*y
ear)/100.......//.INT(365#2E25*year)#0A..IF.year<0.
DO.c.:#3D.c+1............//.INT.meant.to.round.towa
rds.0#0A..d.:#3D.306*(month+1)/10............//.d.#3D
.INT(30#2E6*(month+1))#0A..RESULTIS.b.+.c.+.d.+.day
.+.(1720994.-.2400000)#0A}#0A#0AAND.later(y1,.m1,.d
1,.y2,.m2,.d2).#3D#0A..y1>y2.->.TRUE,#0A#0A..y1<y2.
->.FALSE,#0A..m1>m2.->.TRUE,#0A..m1<m2.->.FALSE,#0A
..d1>d2.->.TRUE,#0A..FALSE#0A#0A//.dayname.does.not
.always.yield.the.right.value.between#0A//.11.Octob
er.1582.and.14.September.1752,.because.of.the.chang
e#0A//.to.the.Gregorian.calenda#0AAND.dayname(year,
.month,.day).#3D.VALOF#0A{.LET.d.#3D.(700000002.+.m
odifiedjulian(year,.month,.day)).REM.7#0A..RESULTIS
.select(d,."Monday",."Tuesday",."Wednesday",."Thurs
day",#0A....................."Friday",."Saturday",.
"Sunday")#0A}#0A#0AAND.select(s,.a,.b,.c,.d,.e,.f,.
g).#3D.s!(@a)#0A#0A

######bcplprogs/demos/life.b#
GET."libhdr"#0A#0AGLOBAL.{.x.:.ug;.y;.z.}#0A#0ALET.
start().#3D.VALOF#0A{.LET.a,.b,.c.#3D.0,.#23b_10111
00_10100100_00101000_10100101_01001001,.#23x8000000
0#0A..LET.d,.e,.f.#3D.1,.#23b_0001100_01100011_1001
0110_01100010_00111100,.#23x80000000#0A..LET.g,.h,.
i.#3D.1,.#23b_1101001_00001001_01001101_10100011_10
110001,.#23x00000000#0A..LET.res.#3D.next(a,b,c,d,e
,f,g,h,i)#0A#0A..writef("%n.%bW.%n*n",.a,.b,.c>>31)
#0A..writef("%n.%bW.%n*n",.d,.e,.f>>31)#0A..writef(
"%n.%bW.%n*n",.g,.h,.i>>31)#0A#0A..newline()#0A..wr
itef("x.%bW*n",.x)#0A..writef("y.%bW*n",.y)#0A..wri
tef("z.%bW*n",.z)#0A..newline()#0A#0A..writef("..%b
W*n",.res)#0A..writef("Instruction.count:..%n*n",.#0A
..........instrcount(next,.a,b,c,d,e,f,g,h,i))#0A..
RESULTIS.0#0A}#0A#0A//.Calculate.the.next.generatio
n.of.the.life.game#0AAND.next(al,.a,.ar,.bl,.b,.br,
.cl,.c,.cr).#3D.VALOF#0A{.//.The.arguments.provide.
3x32.bits.of.three.consecutive#0A..//.raster.lines,
.arranged.as.follows:#0A#0A..//..#2E.#2E.#2E.#2E.al
..a..ar.#2E.#2E.#2E.#2E#0A..//..#2E.#2E.#2E.#2E.bl.
.b..br.#2E.#2E.#2E.#2E#0A..//..#2E.#2E.#2E.#2E.cl..
c..cr.#2E.#2E.#2E.#2E#0A#0A..//.The.function.return
s.the.replacement.for.b#0A#0A..//..a.is.the.bit.pat
tern:..#2E.#2E.#2E.l.m.n.#2E.#2E.#2E#0A..//..b.is.t
he.bit.pattern:..#2E.#2E.#2E.p.q.r.#2E.#2E.#2E#0A..
//..c.is.the.bit.pattern:..#2E.#2E.#2E.u.v.w.#2E.#2E
.#2E#0A#0A..//..Assume.q.is.at.bit.position.i.in.b#0A
#0A..//..count.is.the.count.of.neighbours.of.q.(in.
range.0.#2E#2E.8)#0A..//........its.value.#3D.l+m+n
+p+r+u+v+w#0A#0A..x,.y,.z.:#3D.a.XOR.c,.a.&.c,.0#0A
#0A..inc((al<<31).+.(a>>1))#0A..inc((ar>>31).+.(a<<
1))#0A..inc((bl<<31).+.(b>>1))#0A..inc((br>>31).+.(
b<<1))#0A..inc((cl<<31).+.(c>>1))#0A..inc((cr>>31).
+.(c<<1))#0A#0A..//.Position.i.is.alive.if.it.had.e
xactly.3.neighbours,#0A..//........................
or.was.alive.and.had.2.neighbours#0A..RESULTIS.(x.|
.~x.&.b).&.//.odd.count..or..even.count.and.alive#0A
...........y.&.~z.........//.count.is.2.or.3#0A}#0A
#0AAND.inc(bits).BE#0A{.LET.carry.#3D.x.&.bits...//
.Carry.from.bit.0.of.each.counts#0A..z.:#3D.z..|..y
.&.carry...//.Overflow.bits.for.each.count#0A..y.:#3D
.y.XOR.carry.......//.Bit.1.of.each.count#0A..x.:#3D
.x.XOR.bits........//.Bit.0.of.each.count.(least.si
gnificant)#0A}#0A#0A/*.The.program.outputs:#0A#0A0.
10100100001010001010010101001001.1#0A1.011000111001
01100110001000111100.1#0A1.000010010100110110100011
10110001.0#0A#0Ax.01010111111110100111110100010010#0A
y.01111111111100100011010000000110#0Az.100000000000
11011100001111111001#0A#0A..01110111111100100011010
000000110#0AInstruction.count:..185#0A*/#0A#0A#0A

######bcplprogs/demos/mcqueens.b#
/*#0AThis.is.a.solution.to.the.n-queens.problem.usi
ng.the#0AMC.package#2E.It.follows.the.same.algorith
m.as.used.in#0Abcplprogs/demos/queens#2Eb#0A#0AImpl
emented.by.Martin.Richrds.(c).January.2008#0A*/#0A#0A
GET."libhdr"#0AGET."mc#2Eh"#0A#0AMANIFEST.{#0A.lo#3D
1;.hi#3D16#0A.dlevel#3D#23b0000#0A#0A.//.Register.m
nemonics#0A.ld....#3D.mc_a#0A.row...#3D.mc_b#0A.rd.
...#3D.mc_c#0A.poss..#3D.mc_d#0A.p.....#3D.mc_e#0A.
count.#3D.mc_f#0A}#0A#0ALET.start().#3D.VALOF#0A{./
/.Load.the.dynamic.code.generation.package#0A..LET.
mcseg.#3D.globin(loadseg("mci386"))#0A..LET.mcb.#3D
.0#0A#0A..UNLESS.mcseg.DO#0A..{.writef("Trouble.wit
h.MC.package:.mci386*n")#0A....GOTO.fin#0A..}#0A#0A
..//.Create.an.MC.instance.for.hi.functions.with.a.
data.space#0A..//.of.10.words.and.code.space.of.400
0#0A..mcb.:#3D.mcInit(hi,.10,.40000)#0A#0A..UNLESS.
mcb.DO#0A..{.writef("Unable.to.create.an.mci386.ins
tance*n")#0A....GOTO.fin#0A..}.#0A#0A..mc.:#3D.0...
.......//.Currently.no.selected.MC.instance#0A..mcS
elect(mcb)#0A#0A..mcK(mc_debug,.dlevel)#0A#0A..FOR.
n.#3D.lo.TO.hi.DO#0A..{.mcComment("*n*n//.Code.for.
a.%nx%n.board*n",.n,.n)#0A....gencode(n).//.Compile
.the.code.for.an.nxn.board#0A..}#0A#0A..mcF(mc_end)
#0A#0A..writef("Code.generation.complete*n")#0A#0A.
.FOR.n.#3D.lo.TO.hi.DO#0A..{.LET.k.#3D.mcCall(n)#0A
....writef("Number.of.solutions.to.%i2-queens.is.%i
9*n",.n,.k)#0A..}#0A#0Afin:#0A..IF.mc....DO.mcClose
()#0A..IF.mcseg.DO.unloadseg(mcseg)..#0A#0A..writef
("*n*nEnd.of.run*n")#0A}#0A#0AAND.gencode(n).BE#0A{
.LET.all.#3D.(1<<n).-.1#0A..mcKKK(mc_entry,.n,.3,.0
)#0A#0A..mcRK(mc_mv,.ld,....0)#0A..mcRK(mc_mv,.row,
...0)#0A..mcRK(mc_mv,.rd,....0)#0A..mcRK(mc_mv,.cou
nt,.0)#0A#0A..cmpltry(1,.n,.all)........//.Compile.
the.outermost.call.of.try#0A#0A..mcRR(mc_mv,.mc_a,.
count)..//.return.count#0A..mcF(mc_rtn)#0A..mcF(mc_
endfn)#0A}#0A#0AAND.cmpltry(i,.n,.all).BE#0A{.LET.L
.#3D.mcNextlab()#0A#0A..mcComment("*n//.Start.of.co
de.from.try(%n,.%n,.%n)*n",.i,.n,.all)#0A#0A..mcRR(
mc_mv,..poss,.ld).........//.LET.poss.#3D.(~(ld.|.r
ow.|.rd)).&.all#0A..mcRR(mc_or,..poss,.row)#0A..mcR
R(mc_or,..poss,.rd)#0A..mcR.(mc_not,.poss)#0A..mcRK
(mc_and,.poss,.all)#0A#0A..mcRK(mc_cmp,.poss,.0)...
.......//.IF.poss.DO#0A..TEST.n-i<#3D2#0A..THEN.mcJ
S(mc_jeq,.L)...........//.(use.a.short.jump.if.near
.the.last.row)#0A..ELSE.mcJL(mc_jeq,.L)#0A#0A..TEST
.i#3Dn#0A..THEN.{.//.We.can.place.a.queen.in.the.fi
nal.row#2E#0A.........mcR(mc_inc,..count).....//...
count.:#3D.count+1#0A.......}#0A..ELSE.{.//.We.can.
place.queen(s).in.a.non.final.row#2E#0A.........LET
.M.#3D.mcNextlab()#0A#0A.........mcL.(mc_lab,..M)..
......//.{.Start.of.REPEATWHILE.loop#0A#0A.........
mcRR(mc_mv,...p,.poss)..//...LET.p.#3D.poss.&.-poss
#0A.........mcR.(mc_neg,..p)#0A.........mcRR(mc_and
,..p,.poss)..//...//.p.is.a.valid.queens.position#0A
.........mcRR(mc_sub,..poss,.p)..//...poss.:#3D.pos
s.-.p#0A#0A#0A.........mcR.(mc_push,.ld).......//..
.Save.current.state#0A.........mcR.(mc_push,.row)#0A
.........mcR.(mc_push,.rd)#0A.........mcR.(mc_push,
.poss)#0A.................................//...Call
.try((ld+p)<<1,.row+p,.(rd+p)>>1)#0A.........mcRR(m
c_add,..ld,..p)#0A.........mcRK(mc_lsh,..ld,..1)...
//...ld..:#3D.(ld+p)<<1#0A.........mcRR(mc_add,..ro
w,.p)...//...row.:#3D.row+p#0A.........mcRR(mc_add,
..rd,..p)#0A.........mcRK(mc_rsh,..rd,..1)...//...r
d..:#3D.(rd+p)>>1#0A#0A.........cmpltry(i+1,.n,.all
)....//...Compile.code.for.row.i+1#0A#0A.........mc
R.(mc_pop,..poss).....//...Restore.the.state#0A....
.....mcR.(mc_pop,..rd)#0A.........mcR.(mc_pop,..row
)#0A.........mcR.(mc_pop,..ld)#0A#0A.........mcRK(m
c_cmp,..poss,.0)#0A.........mcJL(mc_jne,.M)........
.//.}.REPEATWHILE.poss#0A.......}#0A#0A.......mcL(m
c_lab,.L)#0A.......mcComment("//.End...of.code.from
.try(%n,.%n,.%n)*n*n",#0A.................i,.n,.all
)#0A}#0A#0A

######bcplprogs/demos/mctest.b#
GET."libhdr"#0AGET."mc#2Eh"#0A#0AMANIFEST.{#0A.A#3D
mc_a;.B#3Dmc_b;.C#3Dmc_c;.D#3Dmc_d;.E#3Dmc_e;.F#3Dm
c_f#0A.a1#3D1;.a2;.a3#0A.v1#3D1;.v2;.v3#0A}#0A#0ALE
T.start().#3D.VALOF#0A{.//.Load.the.dynamic.code.ge
neration.package#0A..LET.mcseg.#3D.globin(loadseg("
mci386"))#0A..LET.mcb.#3D.0#0A..LET.L,.M,.N.#3D.0,.
0,.0.//.For.local.labels#0A..LET.v.#3D.VEC.1000#0A.
.FOR.i.#3D.0.TO.1000.DO.v!i.:#3D.1000+i#0A#0A..UNLE
SS.mcseg.DO#0A..{.writef("Trouble.with.MC.package:.
mci386*n")#0A....GOTO.fin#0A..}#0A#0A..//.Create.an
.MC.instance.for.10.functions.with.a.data.space#0A.
.//.of.100.words.and.code.space.of.4000#0A..mcb.:#3D
.mcInit(10,.100,.4000)#0A#0A..UNLESS.mcb.DO#0A..{.w
ritef("Unable.to.create.an.mci386.instance*n")#0A..
..GOTO.fin#0A..}.#0A#0A..mc.:#3D.0..........//.Curr
ently.no.selected.MC.instance#0A..mcSelect(mcb)#0A#0A
..L,.M,.N.:#3D.mcNextlab(),.mcNextlab(),.mcNextlab(
)#0A#0A..mcK(mc_debug,.#23b1011)..#0A#0A..mcK(mc_al
ignd,.4)#0A..mcL(mc_dlab,.M)#0A..mcK(mc_datak,.1234
)#0A..mcL(mc_datal,.N)#0A..mcL(mc_datal,.M)#0A..mcL
(mc_dlab,..N)#0A#0A..mcK(mc_debug,.#23b0011)..#0A#0A
..mcKKK(mc_entry,.1,.3,.5);#0A#0A..mcRK(mc_mv,.A,.1
1)#0A..mcRK(mc_mv,.B,.22)#0A..mcRK(mc_mv,.C,.33)#0A
..mcRK(mc_mv,.D,.44)#0A..mcRK(mc_mv,.E,.55)#0A..mcR
K(mc_mv,.F,.66)#0A#0A..mcK(mc_debug,.#23b1111)..#0A
#0A..//mcDXsBK(mc_cmp,.80,.B,.4,.A,.10)#0A..//mcGK(
mc_mv,.0,.999)#0A#0A...#0A//..mcRG(mc_mvzxh,.A,.0)#0A
#0A..mcK(mc_debug,.#23b1111)#0A#0A#0A..mcStrR(mc_pr
f,."arg#3D%d*n",.A)#0A..mcK(mc_debug,.#23b0011)#0A#0A
..mcRK(mc_cmp,.A,.12)#0A..mcStrR(mc_prf,."A#3D%d*n"
,.A)#0A..mcStrR(mc_prf,."B#3D%d*n",.B)#0A..mcStrR(m
c_prf,."C#3D%d*n",.C)#0A..mcStrR(mc_prf,."D#3D%d*n"
,.D)#0A..mcStrR(mc_prf,."E#3D%d*n",.E)#0A..mcStrR(m
c_prf,."F#3D%d*n",.F)#0A#0A..L.:#3D.mcNextlab()#0A.
.mcJL(mc_jeq,.L)#0A..mcR(mc_push,.A)#0A..mcStr(mc_p
rf,."A~#3D11*n")#0A..mcL(mc_lab,.L)#0A..#0A..mcF(mc
_rtn);#0A..mcF(mc_endfn);#0A..mcF(mc_end);#0A#0A..n
ewline()#0A..//writef("*n*nCalling.function.F%n*n",
.1)#0A..writef("*n*nF1(10,.20,.30)#3D>.%n*n",.mcCal
l(1,.10,.20,.30))#0A//..writef("*n*nCalling.functio
n.2.#3D>.%n*n",.mcCall(2,.40,.50,.60))#0A#0Afin:#0A
..//writef("fin:.reached*n")#0A..IF.mcseg.DO.unload
seg(mcseg)..#0A..writef("*nReturning.from.mctest*n"
)#0A..RESULTIS.0#0A}#0A#0A....#0A

######bcplprogs/demos/milrabin.b#
/*#0AThis.is.a.simple.implementation.of.the.Miller.
Rabin.test#2E#0A#0AImplemented.in.BCPL.by.Martin.Ri
chards.(c).November.2001#0A#0AThe.program.is.a.dire
ct.translation.of.the.C.program.on.pages.255-257#0A
of."Number.Theory.A.Progrmmer's.Guide".by.Mark.Herk
ommer#2E#0A*/#0A#0AGET."libhdr"#0A#0ALET.millerrabi
n(n,.b).#3D.VALOF#0A{.LET.e,.q,.r,.t.#3D.?,.?,.?,.0
#0A#0A..IF.(n&1)#3D0.RESULTIS.TRUE...//.n.even.-.co
mposite.(except.2)#0A#0A..b.:#3D.b.REM.n#0A..UNLESS
.b.DO....................//.choose:.1.<.b.<.n#0A...
.b.:#3D.randno(n-2).+.1#0A#0A..IF.gcd(b,.n).>.1.RES
ULTIS.TRUE.//.lucky.guess.--.composite#0A#0A..q.:#3D
.n-1#0A..WHILE.(q.&.1)#3D0.DO.t,.q.:#3D.t+1,.q>>1..
.//.while.q.even#0A#0A..r.:#3D.PowMod(b,.q,.n)#0A..
UNLESS.r#3D1.FOR.e.#3D.0.TO.t-2.DO#0A..{.IF.r.#3D.n
-1.BREAK#0A....r.:#3D.MulMod(r,.r,.n)#0A..}#0A#0A..
IF.r#3D1.|.r#3Dn-1.RESULTIS.FALSE...//.Probably.pri
me#0A..RESULTIS.TRUE...................//.composite
#0A}#0A#0AAND.PowMod(a,.n,.m).#3D.VALOF#0A{.LET.r.#3D
.1#0A..WHILE.n>0.DO#0A..{.IF.(n&1)>0.r.:#3D.MulMod(
r,.a,.m)#0A....a.:#3D.MulMod(a,.a,.m)..........//.S
quare#0A....n.:#3D.n>>1.....................//.Divi
de.by.2#0A..}#0A..RESULTIS.r#0A}#0A#0AAND.MulMod(a,
.b,.m).#3D.m#3D0.->.a*b,.VALOF#0A{.LET.r.#3D.0#0A..
WHILE.a.DO#0A..{.IF.(a&1)>0.DO.r.:#3D.(r+b).REM.m#0A
....a.:#3D.a>>1#0A....b.:#3D.(b<<1).REM.m#0A..}#0A.
.RESULTIS.r#0A}#0A#0AAND.gcd(a,.b).#3D.VALOF#0A{.WH
ILE.b>0.DO#0A..{.LET.r.#3D.a.REM.b#0A....a.:#3D.b#0A
....b.:#3D.r#0A..}#0A..RESULTIS.a#0A}#0A#0ALET.star
t().#3D.VALOF#0A{.LET.argv.#3D.VEC.50#0A..LET.n,.b.
#3D.257,.43#0A..UNLESS.rdargs("N,B",.argv,.50).DO#0A
..{.writes("Bad.args.for.milrabin*n")#0A....RESULTI
S.20#0A..}#0A..IF.argv!0.DO.n.:#3D.str2numb(argv!0)
#0A..IF.argv!1.DO.b.:#3D.str2numb(argv!1)#0A#0A..wr
itef("*nTest.compositemenss.using.the.miller-Rabin.
test.")#0A..writef("with.n#3D%n.and.b#3D%n*n",.n,.b
)#0A#0A..writef("*n%n.is.%s*n",.n,#0A..........mill
errabin(n,.b).->."composite",."probably.prime")#0A#0A
..RESULTIS.0#0A}#0A

######bcplprogs/demos/monbfns1.b#
//.This.program.calculates.the.number.of.monadic.bo
olean.#0A//.functions.of.n.boolean.variables#0A#0AG
ET."libhdr"#0A#0AGLOBAL.{#0A..w:.....200#0A..count:
.201#0A..mask:..202#0A}#0A#0AMANIFEST.{.Upb#3D50000
0.}#0A#0ALET.start().#3D.VALOF#0A{.LET.argv.#3D.VEC
.50#0A..LET.stdout.#3D.output()#0A..LET.outfile.#3D
.0#0A#0A..UNLESS.rdargs("TO/K",.argv,.50).DO#0A..{.
writes("Bad.argument.for.monfns1*n")#0A....RESULTIS
.20#0A..}#0A#0A..IF.argv!0.DO.outfile.:#3D.findoutp
ut(argv!0)#0A..IF.outfile.DO.selectoutput(outfile)#0A
#0A..w.:#3D.getvec(Upb)#0A..mask.:#3D.0#0A..FOR.n.#3D
.0.TO.6.DO.//.Number.of.variables#0A..{.count.:#3D.
0#0A....w!Upb.:#3D.0..............//.Initially.the.
rim.contains.just.one.vertex#0A....try(0,.Upb,.Upb,
.Upb+1).//.Start.exploring.with.tset.and.fset.empty
#0A............................//.and.the.rim.conta
ining.just.the.origin#2E#0A....writef("There.are.%i
7.monotonic.boolean.fns.of.%i2.variables*n",#0A....
...........................count,..........n)#0A...
.mask.:#3D.mask<<1.|.1..//.mask.#3D.2**n.-.1#0A..}#0A
..freevec(w)#0A#0A..IF.outfile.&.outfile~#3Dstdout.
DO.endwrite()#0A..selectoutput(stdout)#0A..writef("
End.of.run*n")#0A..RESULTIS.0#0A}#0A#0AAND.try(p,.q
,.r,.s).BE#0A{.//.This.function.explores.the.lattic
e.of.vertices.on.an#0A..//.n-dimensional.cube#2E#0A
#0A..//.w!0.#2E#2E#2E.w!(p-1)..(the.tset).vertices.
assigned.to.true.(T)#2E#0A..//.w!q.#2E#2E#2E.w!(r-1
)..(the.fset).vertices.assigned.F.at.this.level#2E#0A
..//.w!r.#2E#2E#2E.w!(s-1)..(the.rim)..vertices.to.
be.assigned#2E#0A#0A..//.The.rim.and.fset.vertices.
are.the.same.distance.from.the.origin#2E#0A#0A..//.
The.exploration.allocates.the.rim.vertices.to.the.t
set.and.fset#0A..//.in.all.possible.ways#2E#0A#0A..
//.If.the.rim.and.fset.are.both.empty,.a.new.monoto
nic.function#0A..//.has.been.found.causing.count.is
.incremented,#0A..//.otherwise.try.is.called.again.
with.all.distinct.successors.of#0A..//.the.fset.tha
t.are.not.forced.to.be.T.by.the.tset#2E#0A/*#0A..wr
itef("tset:.").........................//.Debugging
.output#0A..FOR.i.#3D.0.TO.p-1.DO.writef("%b4.",.w!
i)#0A..writes("fset:.")#0A..FOR.i.#3D.q.TO.r-1.DO.w
ritef("%b4.",.w!i)#0A..writes("rim:.")#0A..FOR.i.#3D
.r.TO.s-1.DO.writef("%b4.",.w!i)#0A..newline()#0A*/
#0A..IF.r<s.DO#0A..{.LET.x.#3D.w!r#0A....w!p.:#3D.x
#0A....w!r.:#3D.w!q#0A....try(p+1,.q+1,.r+1,.s)..//
.Try.with.x.assigned.to.T#0A....w!q.:#3D.w!r#0A....
w!r.:#3D.x#0A....try(p,.q,.r+1,.s)......//.Try.with
.x.assigned.to.F#0A....RETURN#0A..}#0A#0A..IF.q>#3D
r#0A..{.count.:#3D.count+1..//.A.new.monotonic.func
tion.has.been.found#0A//..IF.count.REM.1000000.#3D.
0.DO.writef("count#3D.%i7*n",.count)#0A....RETURN#0A
..}#0A#0A..//.Now.construct.the.new.rim.consisting.
of.all.distinct#0A..//.successors.of.the.fset.verti
ces.that.are.not.forced.to.T#0A..//.by.vertices.in.
the.tset#2E#0A#0A..{.LET.nq,.ns..#3D.q,.q#0A#0A....
{.LET.bit.#3D.1#0A......UNTIL.(bit.&.mask)#3D0.DO#0A
......{.FOR.i.#3D.q.TO.s-1.DO#0A........{.LET.x.#3D
.w!i#0A..........LET.y.#3D.x.|.bit#0A..........UNLE
SS.x#3Dy.DO#0A..........{.LET.newvertex.#3D.TRUE#0A
//............writef("considering.%b4->%b4.bit.%b4*
n",.x,.y,.bit)#0A............FOR.j.#3D.nq.TO.ns-1.I
F.y#3Dw!j.DO.//.All.rim.vertices.must.be.distinct#0A
............{.newvertex.:#3D.FALSE#0A//............
..writef("already.considered*n")#0A..............BR
EAK#0A............}#0A............IF.newvertex.FOR.
j.#3D.0.TO.p-1.DO#0A............{.LET.t.#3D.w!j....
............//.A.vertex.already.assigned.T#0A......
........IF.(t&y)#3Dt.DO..............//.Is.y.as.des
cendent.of.t#0A..............{.newvertex.:#3D.FALSE
#0A//................writef("%b4->%b4.forced.T.by.%
b4*n",.x,.y,.t)#0A................BREAK#0A.........
.....}#0A............}#0A............IF.newvertex.D
O.{.nq.:#3D.nq-1..//.Add.a.vertex.to.the.new.rim#0A
..............................w!nq.:#3D.y#0A//.....
.........................writef("new.rim.vertex:.%b
4*n",.y)#0A............................}#0A........
..}#0A........}#0A........bit.:#3D.bit<<1#0A......}
#0A....}#0A....try(p,.nq,.nq,.ns)..//.Explore.the.n
ext.level#0A..}#0A}#0A#0A

######bcplprogs/demos/monbfns6.b#
//.This.program.calculates.the.number.of.monadic.bo
olean.#0A//.functions.of.n.boolean.variables,.for.n
<#3D6#0A#0AGET."libhdr"#0A#0AGLOBAL.{#0A..succs0:.2
00..//.<succs0!i,.succs1!1>.#3D.set.of.successors.t
o.vertex.i#0A..succs1:.201#0A}#0A#0ALET.start().#3D
.VALOF#0A{.LET.v0.#3D.VEC.63#0A..LET.v1.#3D.VEC.63#0A
..FOR.i.#3D.0.TO.63.DO#0A..{.v0!i,.v1!i.:#3D.0,.0#0A
....FOR.j.#3D.i.TO.63.IF.(i&j)#3Di.TEST.j<32#0A....
THEN.v0!i.:#3D.v0!i.|.1<<j#0A....ELSE.v1!i.:#3D.v1!
i.|.1<<(j-32)#0A..}#0A..succs0,.succs1.:#3D.v0,.v1.
.#0A#0A//FOR.n.#3D.0.TO.63.DO.writef("%b6.%bW.%bW*n
",.n,.succs1!n,.succs0!n)#0A#0A..FOR.n.#3D.0.TO.6.D
O#0A....writef("There.are.%i7.monotonic.boolean.fun
ctions.of.%n.variables*n",#0A......................
mbfns(0,.1<<n,.0),.n)#0A..RESULTIS.0#0A}#0A#0AAND.m
bfns(i,.bit,.bits1,.bits0).#3D.VALOF#0A{.LET.count.
#3D.0#0A..//writef("i#3D%n.bits.%b6*n",.i,.bits)#0A
..IF.i>#3Dbit.RESULTIS.1#0A..IF.((i<32.->.bits0>>i,
.bits1>>(i-32)).&.1).#3D.0.DO#0A..........count.:#3D
.mbfns(i+1,.bit,.bits1.|.succs1!i,#0A..............
.....................bits0.|.succs0!i).//.Vi.assign
ed.T#0A..RESULTIS.count.+.mbfns(i+1,.bit,.bits1,.bi
ts0).....//.Vi.assigned.F#0A}#0A#0A#0A

######bcplprogs/demos/monbfns.b#
//.This.program.calculates.the.number.of.monadic.bo
olean.#0A//.functions.of.n.boolean.variables#0A#0AG
ET."libhdr"#0A#0AGLOBAL.{#0A..succs:.200..//.succs!
i.#3D.set.of.successors.to.vertex.i#0A}#0A#0ALET.st
art().#3D.VALOF#0A{.LET.v.#3D.VEC.32#0A..FOR.i.#3D.
0.TO.31.DO#0A..{.v!i.:#3D.0#0A....FOR.j.#3D.i.TO.31
.IF.(i&j)#3Di.DO.v!i.:#3D.v!i.|.1<<j#0A..}#0A..succ
s.:#3D.v........#0A#0A//..FOR.n.#3D.0.TO.31.DO.writ
ef("%b5.%bW*n",.n,.succs!n)#0A#0A..FOR.n.#3D.0.TO.5
.DO#0A....writef("There.are.%i4.monotonic.boolean.f
unctions.of.%n.variables*n",#0A....................
..mbfns(0,.1<<n,.0),.n)#0A..RESULTIS.0#0A}#0A#0AAND
.mbfns(i,.bit,.bits).#3D.VALOF#0A{.LET.count.#3D.0#0A
..//writef("i#3D%n.bits.%b4*n",.i,.bits)#0A..IF.i>#3D
bit.RESULTIS.1#0A..IF.(bits>>i.&.1)#3D0.DO#0A......
....count.:#3D.mbfns(i+1,.bit,.bits.|.succs!i).//.V
i.assigned.T#0A..RESULTIS.count.+.mbfns(i+1,.bit,.b
its)...........//.Vi.assigned.F#0A}#0A#0A#0A

######bcplprogs/demos/nqueens.b#
SECTION."NQUEENS"#0A.#0AGET."libhdr"#0A.#0ASTATIC.$
(.count.#3D.0;.all#3D1..$)#0A.#0ALET.try(ld,row,..r
d).BE.TEST.row#3Dall#0ATHEN.count.:#3D.count.+.1#0A
ELSE.$(.LET.poss.#3D.all.&.NOT.(ld.|.row.|.rd)#0A..
......UNTIL.poss#3D0.DO.$(.LET.p.#3D.poss.&.-poss#0A
...........................poss.:#3D.poss.-.p#0A...
........................try(ld+p.<<.1,.row+p,.rd+p.
>>.1)#0A........................$)#0A.....$)#0A.#0A
LET.start().#3D.VALOF#0A$(.FOR.i.#3D.1.TO.12.DO#0A.
..$(.count.:#3D.0#0A......try(0,.0,.0)#0A......writ
ef("%i2.queens.solutions.is.%n*n",.i,.count)#0A....
..all.:#3D.2*all+1#0A...$)#0A...RESULTIS.0#0A$)#0A

######bcplprogs/demos/objdemo.b#
GET."libhdr"#0A#0A/*#0A1#2E.Object.oriented.program
ming.in.BCPL#2E#0A#0A#0AIt.is.commonly.thought.that
.object.oriented.programming.and.type#0Asystems.are
.inseparably.mixed,.but.some.features.of.an.object.
oriented#0Aprogramming.language.can.be.incorporated
.in.a.typeless.language.to#0Agive.it.many.of.the.be
nefits.of.OOP.programming#2E#0A#0AAn.object.is.an.e
ncapsulated.combination.of.data.values.(fields).and
#0Aprocedures.(often.called.methods)#2E.Communicati
on.with.objects.is.by#0Ameans.of.messages.and.retur
ned.results#2E.The.class.of.an.object#0Aspecifies.t
he.types.of.the.fields.and.the.types.of.the.methods
#2E..In#0ABCPL.all.the.fields.would.be.of.the.same.
size.and.would.form.a#0Avector#2E.Similarly,.the.me
thods.could.be.placed.in.a.vector#2E.Although#0Athe
.methods.could.reside.in.the.same.vector.as.the.fie
lds,.it.is#0Asensible.to.hold.them.in.separate.vect
ors.so.that.all.objects.of.a#0Aclass.can.share.the.
same.methods.vector#2E..In.a.typeless.language.the#0A
natural.way.to.represent.an.object.is.as.a.pointer.
to.its.fields#0Avector.with.its.zeroth.element.poin
ting.to.the.methods.vector#2E#0A#0A2#2E.Class.defin
ition#0A#0AIt.is.convenient,.though.not.compulsory,
.to.define.a.class.(eg.A).by#0Ameans.of.a.header.fi
le.(eg.A#2Eh).and.code.file.(A#2Eb)#2E.The.header.f
ile#0Amight.be:#0A*/#0A#0AGLOBAL#0A{.mkfns_A:200.}.
.//.A.function.to.make.the.methods.vector.for.class
.A#0A#0AMANIFEST#0A{.Af_init#3D0;.Af_destroy#3D1../
/.All.classes.have.these.two.methods.#0A..Af_f#3D2;
.Af_g#3D3...........//.methods.belonging.to.A#0A..A
f_upb#3D3.................//.size.and.upb.of.fns.ve
ctor.for.A#0A}#0A#0A/*#0ABy.convention.the.first.tw
o.methods.of.every.object.are.init.to.initialise.#0A
the.object,.and.destroy.for.its.destruction#2E#0A#0A
3#2E.Message.sending#0A#0AAssuming.an.object.of.cla
ss.A.has.been.created.it.can.be.sent.a.message#0A(x
,.y,#2E#2E#2E,.z).using.method.f,.say,.by.the.follo
wing.call:#0A#0A....res.:#3D.((!obj)!A_f)(obj,.x,.y
,#2E#2E#2E,.z)#0A#0Awhich.is.more.readable.in.its.s
ugared.form:#0A#0A....res.:#3D.A_f#23(obj,.x,.y,#2E
#2E#2E,.z)#0A#0AThe.hash.(#23).is.to.distinguish.th
is.from.an.ordinary.function.call#2E#0A#0AIf.greate
r.efficiency.if.required,.something.like.the.follow
ing#0Acould.be.used:#0A#0A....LET.f.#3D.(!obj)!A_f#0A
....#2E#2E#2E#0A....res.:#3D.f(obj,.x,.y,#2E#2E#2E,
.z)#0A#0A#0A4#2E.The.body.of.a.class#0A#0ABy.way.of
.example,.consider.the.body.file.A#2Eb.for.class.A.
which.could#0Abe.as.follows:#0A#0AGET."libhdr"#0AGE
T."A#2Eh"#0A*/#0A#0AMANIFEST.{#0AA_fns#3D0.........
........//.the.methods.vector.for.A#0AA_a#3D1;.A_b#3D
2;.A_c#3D3.....//.the.fields#0AA_upb#3D3...........
......//.the.upb#0A}#0A#0ALET.mkfns_A().#3D.VALOF..
.//.Make.the.fns.vector.for.class.A#2E#0A{.LET.fns.
#3D.getvec(Af_upb)#0A..UNLESS.fns#3D0.DO#0A..{.fns!
Af_init....:#3D.initA....//.Methods.for.A#0A....fns
!Af_destroy.:#3D.destroyA#0A....fns!Af_f.......:#3D
.fA#0A....fns!Af_g.......:#3D.gA#0A..}#0A..RESULTIS
.fns#0A}#0A#0A//.Definition.of.the.method.functions
.for.A#0A#0AAND.initA(a).BE.FOR.i.#3D.1.TO.A_upb.DO
.a!i.:#3D.0#0A#0AAND.destroyA(a).BE.freevec(a)#0A#0A
AND.fA(a,.x,.y).BE.#0A{.writef("Method.f.of.A.calle
d.with.args.%i2.and.%i2*n",.x,.y)#0A}#0A#0AAND.gA(a
,.x,.y).BE.#0A{.writef("Method.g.of.A.called.with.a
rgs.%i2.and.%i2*n",.x,.y)#0A}#0A#0A/*#0A6#2E.Object
.creation#0A#0AAn.object.is.normally.created.using.
the.mkobj.function.defined.in#0ABLIB,.as.follows:#0A
#0ALET.mkobj(upb,.fns,.a,.b,.c,.d,.e,.f,.g,.h,.i,.j
,.k).#3D.VALOF#0A{.LET.obj.#3D.getvec(upb)#0A..UNLE
SS.obj#3D0.DO#0A..{.A_fns!a.:#3D.fns#0A....InitObj#23
(obj,.@a)....//.Send.the.init.message.to.the.object
#0A..}#0A..RESULTIS.obj#0A}#0A#0AAs.can.be.seen,.mk
obj.take.two.arguments:.upb.the.upper.bound.of.the#0A
fields.vector,.and.fns.the.vector.of.methods.for.th
e.class#2E..As.an#0Aillustration,.an.object.belongi
ng.to.class.A.can.be.made.by.the#0Afollowing.statem
ent:#0A#0A.....LET.fns_A.#3D.mkfns_A()#0A.....LET.o
bjA.#3D.mkobj(A_upb,.fns_A)#0A#0AThis.will.create.t
he.following:#0A#0A.........fields................m
ethods#0A..........----..................----#0Aobj
A.-->.|..*-|-------------->.|....|.Af_init#0A......
...|----|................|----|#0A....A_a..|....|..
..............|....|.Af_destroy#0A.........|----|..
..............|----|#0A....A_b..|....|.............
...|....|.Af_f#0A.........|----|................|--
--|#0A....A_c..|....|................|....|.Af_g#0A
..........----..................----.#0A#0A#0A7#2E.
Derived.classes#0A#0AA.sub-class.can.be.derived.fro
m.another.class#2E..The.derived.class#0Arequires.a.
methods.vector.at.least.as.large.as.the.methods.vec
tor#0Aof.the.parent.class,.and.similarly.its.fields
.vector.may.be.no#0Asmaller.than.the.parent's.field
s.vector#2E.Consider.the.construction#0Aof.a.class.
B.derived.from.class.A.defined.above#2E#0A#0A#0A...
......fields.......methods.for.B.......methods.for.
A#0A..........----............----................-
---#0Aobj.--->.|..*-|-------->.|....|.Bf_init......
|....|.Af_init.#0A.........|----|..........|----|..
............|----|#0AA_a.B_a..|....|..........|....
|.Bf_destroy...|....|.Af_destroy.#0A.........|----|
..........|----|..............|----|#0AA_b.B_b..|..
..|..........|....|.Bf_f.........|....|.Af_f#0A....
.....|----|..........|----|..............|----|#0AA
_c.B_c..|....|.A_upb....|....|.Bf_g.........|....|.
Af_g....Af_upb#0A.........|----|..........|----|...
............----#0A....B_d..|....|..........|....|.
Bf_prevf#0A.........|----|..........|----|#0A....B_
e..|....|.B_upb....|....|.Bf_g..Bf_upb#0A..........
----............----#0A#0AClass.A.has.fields.a,.b.a
nd.c.and.methods.init,.destroy,.f.and.g.while#0AB.i
d.derrived.from.A.having.two.additional.fields.d.an
d.e,.and.an#0Aadditional.method.h#2E.It.also.has.a.
copy.of.the.f.method.belonging.to#0AA#2E..The.heade
r.file.B#2Eh.for.B.could.be.as.follows:#0A*/#0A#0AG
LOBAL.{.mkfns_B:201.}#0A#0AMANIFEST.{#0ABf_init#3D0
;.Bf_destroy#3D1..//.The.two.standard.methods#2E#0A
Bf_f#3D2;.Bf_g#3D3...........//.methods.belonging.t
o.B.and.A#2E#0ABf_prevf#3D4...............//.copy.o
f.parental.method.for.f#2E#0ABf_h#3D5..............
.....//.method.in.B.but.not.in.A#2E#0ABf_upb#3D5...
..............//.upb.of.fns.vector.for.B#0A}#0A#0A/
*#0A8#2E.Body.file.for.class.B#0A#0AThe.body.file.B
#2Eb.is#0A#0AGET."libhdr"#0AGET."A#2Eh"..#0AGET."B#2E
h"#0A*/#0A#0AMANIFEST.{#0AB_fns#3D0.............../
/.the.methods.vector.for.B#0AB_a#3D1;.B_b#3D2;.B_c#3D
3...//.the.fields.in.common.with.the.parent#0AB_d#3D
4;.B_e#3D5..........//.fields.belonging.to.B.only#0A
B_upb#3D5...............//.upb#0A}#0A#0ALET.mkfns_B
(pfns).#3D.VALOF.//.Make.the.fns.vector.for.class.B
#2E#0A..........................//.pfns.is.the.pare
nt's.methods.vector#2E#0A..........................
//.A.copy.of.a.parental.method.must.be.made#0A.....
.....................//.in.the.new.fns.vector.if#0A
..........................//.....(a).the.method.has
.been.overridden#0A..........................//.and
.(b).the.previous.methon.is.needed#2E#0A...........
...............//.Such.a.situation.is.considered.ra
re#2E#0A{.LET.fns.#3D.getvec(Bf_upb)#0A..UNLESS.fns
#3D0.DO#0A..{.UNLESS.pfns#3D0.DO..............//.co
py.previous.methods,.if.any#0A......FOR.i.#3D.1.TO.
Af_upb.DO.fns!i.:#3D.pfns!i#0A....fns!Bf_init....:#3D
.initB.......//.override.with.new.versions#0A....fn
s!Bf_destroy.:#3D.destroyB....//.with.ne.versions.o
f.init,.destroy#0A....fns!Bf_f.......:#3D.fB.......
...//.and.f,.but.not.g#2E#0A....fns!Bf_prevf...:#3D
.pfns!Af_f...//.private.copy.of.parental.method.f#0A
....fns!Bf_h.......:#3D.hB..........//.A.method.in.
B.but.not.in.A#0A..}#0A..RESULTIS.fns#0A}#0A#0A//.D
efinition.of.the.method.functions.for.A#0A#0AAND.in
itB(b).BE.FOR.i.#3D.1.TO.B_upb.DO.b!i.:#3D.0#0A#0AA
ND.destroyB(b).BE.freevec(b)#0A#0AAND.fB(b,.x,.y).B
E#0A{.writef("Method.f.of.B.called.with.args.%i2.an
d.%i2*n",.x,.y)#0A..//.parental.method.f.can.be.inv
oked.by.call:#0A..Bf_prevf#23(b,.x+10,.y+10.)#0A}#0A
#0AAND.hB(b,.x,.y).BE#0A{.writef("Method.h.of.B.cal
led.with.args.%i2.and.%i2*n",.x,.y)#0A}#0A#0ALET.st
art().#3D.VALOF#0A{#0A//.An.object.belonging.to.cla
ss.A.can.be.constructed.by.the.following.code:#0A#0A
..LET.fns_A.#3D.mkfns_A()#0A..LET.objA.#3D.mkobj(A_
upb,.fns_A)#0A#0A//.An.object.belonging.to.class.B.
can.be.constructed.by.the.following.code:#0A.#0A..L
ET.fns_B.#3D.mkfns_B(fns_A)#0A..LET.objB.#3D.mkobj(
B_upb,.fns_B)#0A#0A//.Let.us.now.send.some.messages
.to.these.classes#0A#0A..Af_f#23(objA,.1,.2)#0A..Af
_g#23(objA,.3,.4)#0A..Bf_f#23(objB,.5,.6)#0A..Bf_g#23
(objB,.7,.8)#0A..Bf_h#23(objB,.9,.10)#0A#0A..Af_des
troy#23(objA)#0A..Bf_destroy#23(objB)#0A#0A..freeve
c(fns_A)#0A..freevec(fns_B)#0A#0A..writef("End.of.d
emo*n")#0A..RESULTIS.0#0A}#0A#0A/*.When.this.progra
m.is.run.it.output:#0A#0AMethod.f.of.A.called.with.
args..1.and..2#0AMethod.g.of.A.called.with.args..3.
and..4#0AMethod.f.of.B.called.with.args..5.and..6#0A
Method.f.of.A.called.with.args.15.and.16#0AMethod.g
.of.A.called.with.args..7.and..8#0AMethod.h.of.B.ca
lled.with.args..9.and.10#0AEnd.of.demo#0A#0A*/

######bcplprogs/demos/pattern.b#
GET."libhdr"#0A#0ASTATIC.{#0Awork#3D0;...wp#3D0;...
succflag#3DFALSE#0Apat#3D0;....aux#3D0#0Ach#3D0;...
..patp#3D0;.patlen#3D0#0Aerrflag#3DFALSE#0A}#0A#0A/
/.The.Interpreter#0A#0ALET.match(pat,.aux,.str).#3D
.VALOF#0A{.LET.w.#3D.VEC.128#0A..LET.s.#3D.0#0A..wo
rk,.wp,.succflag.:#3D.w,.0,.FALSE#0A..put(1)#0A..UN
LESS.aux%0#3D0.DO.put(aux%0)#0A#0A..{.//.FIRST.COMP
LETE.THE.CLOSURE#0A....LET.n.#3D.1#0A....UNTIL.n>wp
.DO#0A....{.LET.p.#3D.work!n#0A......LET.k,.q.#3D.p
at%p,.aux%p#0A......SWITCHON.k.INTO#0A......{.CASE.
'#23':.put(p+1)#0A........CASE.'%':.put(q)#0A......
..DEFAULT:..ENDCASE#0A........CASE.'(':#0A........C
ASE.'/':.put(p+1)#0A..................UNLESS.q#3D0.
DO.put(q)#0A......}#0A......n.:#3D.n+1#0A....}#0A#0A
....IF.s>#3Dstr%0.RESULTIS.succflag#0A....IF.wp#3D0
.RESULTIS.FALSE#0A....s.:#3D.s+1#0A....ch.:#3D.str%
s#0A#0A....//.NOW.DEAL.WITH.MATCH.ITEMS#0A....n.:#3D
.wp#0A....wp,.succflag.:#3D.0,.FALSE#0A#0A....FOR.i
.#3D.1.TO.n.DO#0A....{.LET.p.#3D.work!i#0A......LET
.k.#3D.pat%p#0A......SWITCHON.k.INTO#0A......{.CASE
.'#23':#0A........CASE.'/':#0A........CASE.'%':#0A.
.......CASE.'(':.LOOP#0A#0A........CASE.'*'':IF.ch#3D
pat%[p+1].DO.put(aux%p)#0A..................LOOP#0A
........DEFAULT:..//.A.MATCH.ITEM#0A...............
...UNLESS.ch#3Dk.LOOP#0A........CASE.'?':.//.SUCCES
SFUL.MATCH#0A..................put(aux%p)#0A.......
...........LOOP#0A......}#0A....}#0A..}.REPEAT#0A}#0A
#0AAND.put(n).BE.TEST.n#3D0#0A....THEN.succflag.:#3D
.TRUE#0A....ELSE.{.FOR.i.#3D.1.TO.wp.IF.work!i#3Dn.
RETURN#0A...........wp.:#3D.wp+1#0A...........work!
wp.:#3D.n#0A.........}#0A#0A//.The.Compiler#0A#0ALE
T.rch().BE.TEST.patp>#3Dpatlen#0A....THEN.ch.:#3D.e
ndstreamch#0A....ELSE.{.patp.:#3D.patp+1#0A........
...ch.:#3D.pat%patp#0A.........}#0A#0AAND.nextitem(
).BE#0A....{.IF.ch#3D'*''.DO.rch()#0A......rch()#0A
....}#0A#0AAND.prim().#3D.VALOF#0A{.LET.a,.op.#3D.p
atp,.ch#0A..nextitem()#0A..SWITCHON.op.INTO#0A..{.C
ASE.endstreamch:#0A....CASE.')':#0A....CASE.'/':.er
rflag.:#3D.TRUE#0A....DEFAULT:..RESULTIS.a#0A#0A...
.CASE.'#23':.setexits(prim(),.a)#0A..............RE
SULTIS.a#0A#0A....CASE.'(':.a.:#3D.exp(a)#0A.......
.......UNLESS.ch#3D')'.DO.errflag.:#3D.TRUE#0A.....
.........nextitem()#0A..............RESULTIS.a#0A..
}#0A}#0A#0AAND.exp(altp).#3D.VALOF#0A{.LET.exits.#3D
.0#0A#0A..{.LET.a.#3D.prim()#0A....TEST.ch#3D'/'.|.
ch#3D')'.|.ch#3Dendstreamch#0A....THEN.{.exits.:#3D
.join(exits,a)#0A...........UNLESS.ch#3D'/'.RESULTI
S.exits#0A...........aux%altp.:#3D.patp#0A.........
..altp.:#3D.patp#0A...........nextitem()#0A........
.}#0A....ELSE.setexits(a,patp)#0A..}.REPEAT#0A}#0A#0A
#0AAND.setexits(list,val).BE.UNTIL.list#3D0.DO#0A{.
LET.a.#3D.aux%list#0A..aux%list.:#3D.val#0A..list.:
#3D.a#0A}#0A#0AAND.join(a,b).#3D.VALOF#0A{.LET.t.#3D
.a#0A..IF.a#3D0.RESULTIS.b#0A..UNTIL.aux%a#3D0.DO.a
.:#3D.aux%a#0A..aux%a.:#3D.b#0A..RESULTIS.t#0A}#0A#0A
AND.cmplpat(pattern,.cmplpattern).#3D.VALOF#0A{.pat
,.aux.:#3D.pattern,.cmplpattern#0A..patp,.patlen.:#3D
.0,.pat%0#0A..errflag.:#3D.FALSE#0A..FOR.i.#3D.0.TO
.patlen.DO.aux%i.:#3D.0#0A..rch()#0A..setexits(exp(
0),0)#0A..RESULTIS.NOT.errflag#0A}#0A#0A//.Test.pro
gram.for.cmplpat.and.match#0A#0ALET.start().#3D.VAL
OF#0A{.try("A/B",..........."A",.."B",..........0)#0A
..try("A#23BC",.........."AC",."ABBC",..."ABB",.0)#0A
..try("A(/B)",.........0)#0A..try("(A/%)#23(B/C)D",
."AD",."ACCBCD",."BBCD",.0)#0A..try("#23?'#23'?",..
....."#23?",."A#23?#23#23?",."#23??",.0)#0A..RESULT
IS.0#0A}#0A#0AAND.try(pattern,.s1,.s2,.s3,.s4,.s5).
BE#0A{.LET.aux.#3D.VEC.50#0A..AND.t.#3D.@.s1#0A..TE
ST.cmplpat(pattern,.aux)#0A..THEN.writef("*n*"%s*".
compiled.successfully*n",.pattern)#0A..ELSE.{.write
f("*n*"%s*".failed.to.compile*n",.pattern)#0A......
...RETURN#0A.......}#0A..UNTIL.!t#3D0.DO#0A..{.writ
es(match(pattern,.aux,.!t).->."matches",."does.not.
match")#0A....writef(".*"%s*"*n",.!t)#0A....t.:#3D.
t.+.1#0A..}#0A}#0A#0A

######bcplprogs/demos/primefib.b#
GET."libhdr"#0A#0AMANIFEST.{.upb.#3D.40000.}#0A#0AL
ET.prime1().#3D.VALOF#0A{.LET.isprime.#3D.getvec(up
b)#0A..FOR.i.#3D.2.TO.upb.DO.isprime!i.:#3D.TRUE.//
.Until.disproved#0A.#0A..FOR.p.#3D.2.TO.upb.IF.ispr
ime!p.DO#0A..{.LET.i.#3D.p*p#0A....UNTIL.i>upb.DO.{
.isprime!i.:#3D.FALSE;.i.:#3D.i.+.p.}#0A....cowait(
p)#0A..}#0A..freevec(isprime)#0A..RESULTIS.0#0A}#0A
#0AAND.prime2().#3D.VALOF#0A{.FOR.n.#3D.2.TO.upb.DO
#0A..{.LET.a,.b.#3D.2,.1.#0A....FOR.i.#3D.1.TO.n.DO
.{.LET.c.#3D.(a+b).REM.n#0A........................
a.:#3D.b#0A........................b.:#3D.c#0A.....
.................}#0A....IF.a#3D1.DO.cowait(n)#0A..
}#0A..RESULTIS.0#0A}#0A#0ALET.start().#3D.VALOF#0A{
.LET.P1.#3D.createco(prime1,.100)#0A..LET.P2.#3D.cr
eateco(prime2,.100)#0A..LET.n1,.n2,.min.#3D.0,.0,.0
#0A..{.IF.n1#3Dmin.DO.n1.:#3D.callco(P1)#0A....IF.n
2#3Dmin.DO.n2.:#3D.callco(P2)#0A....min.:#3D.n1<n2.
->.n1,.n2#0A....UNLESS.n1#3Dn2.DO#0A.......writef("
.%i4.from.P%c*n",.min,.n1<n2.->.'1',.'2')#0A..}.REP
EATUNTIL.min#3D0#0A..deleteco(P1)#0A..deleteco(P2)#0A
..RESULTIS.0#0A}#0A

######bcplprogs/demos/primes.b#
GET."libhdr"#0A.#0AGLOBAL.{..count:.ug..}#0A.#0AMAN
IFEST.{..upb.#3D.9999..}#0A//MANIFEST.{..upb.#3D.10
00000..}#0A.#0ALET.start().#3D.VALOF#0A{..LET.ispri
me.#3D.getvec(upb)#0A...LET.bigp.#3D.0#0A...count.:
#3D.0#0A#0A...FOR.i.#3D.2.TO.upb.DO.isprime!i.:#3D.
TRUE..//.Until.proved.otherwise#2E#0A.#0A...FOR.p.#3D
.2.TO.upb.IF.isprime!p.DO#0A...{..LET.i.#3D.p*p#0A.
.....UNTIL.i>upb.DO.{..isprime!i.:#3D.FALSE;.i.:#3D
.i.+.p.}#0A......out(p)#0A......bigp.:#3D.p#0A...}#0A
#0A//writef("*n*nLargest.prime.%n*n",.bigp)#0A...wr
ites("*nend.of.output*n")#0A...freevec(isprime)#0A.
..RESULTIS.0#0A}#0A.#0AAND.out(n).BE#0A{..IF.count.
MOD.10.#3D.0.DO.writef("*n%i5:.",.count+1)#0A...wri
tef(".%i5",.n)#0A...count.:#3D.count.+.1#0A}#0A

######bcplprogs/demos/queens1.b#
GET."libhdr"#0A.#0AGLOBAL.{.count:ug;.all;.instrs..
}#0A.#0ALET.try(ld,.row,.rd).BE.TEST.row#3Dall#0ATH
EN.count.:#3D.count+1#0AELSE.{.LET.poss.#3D.all.&.~
(ld.|.row.|.rd)#0A.......WHILE.poss.DO#0A.......{.L
ET.p.#3D.poss.&.-poss#0A.........try(ld+p.<<.1,.row
+p,.rd+p.>>.1)#0A.........poss.:#3D.poss.-.p#0A....
...}#0A.....}#0A#0ALET.try1(ld,.row,.rd).BE........
//.This.is.about.7%.faster.than.try#0A{.LET.poss.#3D
.all.&.~(ld.|.row.|.rd)#0A#0A..TEST.poss#0A..THEN.{
.LET.p.#3D.poss.&.-poss#0A.........try1(ld+p.<<.1,.
row+p,.rd+p.>>.1)#0A.........poss.:#3D.poss.-.p#0A.
......}.REPEATWHILE.poss#0A..ELSE.IF.row#3Dall.DO.c
ount.:#3D.count+1#0A}#0A#0ALET.start().#3D.VALOF#0A
{.all.:#3D.1#0A..#0A..FOR.i.#3D.1.TO.14.DO..//.Comp
are.the.efficiency.of.try.with.try1#0A..{.count.:#3D
.0#0A....instrs.:#3D.instrcount(try,..0,.0,.0)#0A..
..writef("%i2-queens:.solutions:.%i6..instr.count:.
%iA*n",#0A............i,.....................count,
............instrs)#0A#0A....count.:#3D.0#0A....ins
trs.:#3D.instrcount(try1,.0,.0,.0)#0A....writef("%i
2-queens:.solutions:.%i6..instr.count:.%iA*n",#0A..
..........i,.....................count,............
instrs)#0A....all.:#3D.2*all.+.1#0A..}#0A#0A..RESUL
TIS.0#0A}#0A

######bcplprogs/demos/queens2.b#
GET."libhdr"#0A.#0AGLOBAL.{.count:ug;.all;.instrs..
}#0A.#0ALET.try(ld,.row,.rd).BE#0A{.LET.poss.#3D.al
l.&.~(ld.|.row.|.rd)#0A#0A..TEST.poss#0A..THEN.{.LE
T.p.#3D.poss.&.-poss#0A.........try(ld+p.<<.1,.row+
p,.rd+p.>>.1)#0A.........poss.:#3D.poss.-.p#0A.....
..}.REPEATWHILE.poss#0A..ELSE.IF.row#3Dall.DO.count
.:#3D.count+1#0A}#0A#0ALET.start().#3D.VALOF#0A{.al
l.:#3D.1#0A..FOR.i.#3D.1.TO.18.DO..//.Compare.the.e
fficiency.of.try.with.try1#0A..{.LET.filename.#3D."
resA"#0A....LET.t.#3D.0#0A....filename%4.:#3D.'A'+i
-1#0A....selectoutput(findoutput(filename))#0A....c
ount.:#3D.0#0A....t.:#3D.sys(30)#0A....try(0,.0,.0)
#0A....t.:#3D.sys(30).-.t#0A....writef("%i2-queens:
.solutions:.%iA..in.%iA.msecs*n",.#0A............i,
.....................count,...t)#0A....endwrite()#0A
....all.:#3D.2*all.+.1#0A..}#0A..RESULTIS.0#0A}#0A#0A


######bcplprogs/demos/queens3.b#
GET."libhdr"#0A.#0A//.A.functional.solution.to.the.
.eight.queens.problem#0A.#0ALET.start().#3D.VALOF#0A
{.LET.count.#3D.instrcount(t8,.0,.0,.#23x8001,#23x2
004,#23x0810,#23x0240,#0A..........................
.........#23x0180,#23x0420,#23x1008,#23x4002)#0A..w
rites("*nEight.Queens*n")#0A..writef("*nNumber.of.s
olutions.is.%n,.instruction.count:.%n*n",#0A.......
...t8(0,.0,.#23x8001,#23x2004,#23x0810,#23x0240,#0A
...................#23x0180,#23x0420,#23x1008,#23x4
002),.count)#0A..RESULTIS.0#0A}#0A.#0AAND.t8(diag,.
p,.a,b,c,d,e,f,g,h).#3D.(diag&p).~#3D.0.->.0,.VALOF
#0A{.LET.di.#3D.diag+p.<<.2#0A..RESULTIS.t7(di,.a,.
..b,c,d,e,f,g,h).+#0A...........t7(di,.b,.a,..c,d,e
,f,g,h).+#0A...........t7(di,.c,.a,b,..d,e,f,g,h).+
#0A...........t7(di,.d,.a,b,c,..e,f,g,h).+#0A......
.....t7(di,.e,.a,b,c,d,..f,g,h).+#0A...........t7(d
i,.f,.a,b,c,d,e,..g,h).+#0A...........t7(di,.g,.a,b
,c,d,e,f,..h).+#0A...........t7(di,.h,.a,b,c,d,e,f,
g..)#0A}#0A.#0AAND.t7(diag,.p,.a,b,c,d,e,f,g).#3D.(
diag&p).~#3D.0.->.0,.VALOF#0A{.LET.di.#3D.diag+p.<<
.2#0A..RESULTIS.t6(di,.a,...b,c,d,e,f,g).+#0A......
.....t6(di,.b,.a,..c,d,e,f,g).+#0A...........t6(di,
.c,.a,b,..d,e,f,g).+#0A...........t6(di,.d,.a,b,c,.
.e,f,g).+#0A...........t6(di,.e,.a,b,c,d,..f,g).+#0A
...........t6(di,.f,.a,b,c,d,e,..g).+#0A...........
t6(di,.g,.a,b,c,d,e,f..)#0A}#0A.#0AAND.t6(diag,.p,.
a,b,c,d,e,f).#3D.(diag&p).~#3D.0.->.0,.VALOF#0A{.LE
T.di.#3D.diag+p.<<.2#0A..RESULTIS.t5(di,.a,...b,c,d
,e,f).+#0A...........t5(di,.b,.a,..c,d,e,f).+#0A...
........t5(di,.c,.a,b,..d,e,f).+#0A...........t5(di
,.d,.a,b,c,..e,f).+#0A...........t5(di,.e,.a,b,c,d,
..f).+#0A...........t5(di,.f,.a,b,c,d,e..)#0A}#0A.#0A
AND.t5(diag,.p,.a,b,c,d,e).#3D.(diag&p).~#3D.0.->.0
,.VALOF#0A{.LET.di.#3D.diag+p.<<.2#0A..RESULTIS.t4(
di,.a,...b,c,d,e).+#0A...........t4(di,.b,.a,..c,d,
e).+#0A...........t4(di,.c,.a,b,..d,e).+#0A........
...t4(di,.d,.a,b,c,..e).+#0A...........t4(di,.e,.a,
b,c,d..)#0A}#0A.#0AAND.t4(diag,.p,.a,b,c,d).#3D.(di
ag&p).~#3D.0.->.0,.VALOF#0A{.LET.di.#3D.diag+p.<<.2
#0A..RESULTIS.t3(di,.a,...b,c,d).+#0A...........t3(
di,.b,.a,..c,d).+#0A...........t3(di,.c,.a,b,..d).+
#0A...........t3(di,.d,.a,b,c..)#0A}#0A.#0AAND.t3(d
iag,.p,.a,b,c).#3D.(diag&p).~#3D.0.->.0,.VALOF#0A{.
LET.di.#3D.diag+p.<<.2#0A..RESULTIS.t2(di,.a,...b,c
).+#0A...........t2(di,.b,.a,..c).+#0A...........t2
(di,.c,.a,b..)#0A}#0A.#0AAND.t2(diag,.p,.a,b).#3D.(
diag&p).~#3D.0.->.0,.VALOF#0A{.LET.di.#3D.diag+p.<<
.2#0A..RESULTIS.t1(di,.a,...b).+#0A...........t1(di
,.b,.a..)#0A}#0A.#0AAND.t1(diag,.p,.a).#3D.(diag&p)
.~#3D.0.->.0,.VALOF#0A{.LET.di.#3D.diag+p.<<.2#0A..
RESULTIS.t0(di,.a)#0A}#0A.#0AAND.t0(diag,.p).#3D.(d
iag&p).~#3D.0.->.0,.1#0A#0A

######bcplprogs/demos/queens4.b#
GET."libhdr"#0A.#0A//.A.nearly.functional.solution.
to.the..eight.queens.problem#0A.#0AGLOBAL.{.count:u
g;.k.}#0A#0ALET.start().#3D.VALOF#0A{.count.:#3D.0#0A
..k.:#3D.instrcount(t8,.0,.0,.#23x8001,#23x2004,#23
x0810,#23x0240,#0A............................#23x0
180,#23x0420,#23x1008,#23x4002)#0A..count.:#3D.0#0A
..t8(0,.0,.#23x8001,#23x2004,#23x0810,#23x0240,#0A.
..........#23x0180,#23x0420,#23x1008,#23x4002)#0A#0A
..writes("*nEight.Queens*n")#0A..writef("*nNumber.o
f.solutions.is.%n,.instruction.count:.%n*n",#0A....
...............................count,..............
...k)#0A..RESULTIS.0#0A}#0A.#0AAND.t8(diag,.p,.a,b,
c,d,e,f,g,h).BE.IF.(diag&p).#3D.0.DO#0A{.LET.di.#3D
.diag+p.<<.2#0A..t7(di,.a,...b,c,d,e,f,g,h)#0A..t7(
di,.b,.a,..c,d,e,f,g,h)#0A..t7(di,.c,.a,b,..d,e,f,g
,h)#0A..t7(di,.d,.a,b,c,..e,f,g,h)#0A..t7(di,.e,.a,
b,c,d,..f,g,h)#0A..t7(di,.f,.a,b,c,d,e,..g,h)#0A..t
7(di,.g,.a,b,c,d,e,f,..h)#0A..t7(di,.h,.a,b,c,d,e,f
,g..)#0A}#0A.#0AAND.t7(diag,.p,.a,b,c,d,e,f,g).BE.I
F.(diag&p)#3D0.DO#0A{.LET.di.#3D.diag+p.<<.2#0A..t6
(di,.a,...b,c,d,e,f,g)#0A..t6(di,.b,.a,..c,d,e,f,g)
#0A..t6(di,.c,.a,b,..d,e,f,g)#0A..t6(di,.d,.a,b,c,.
.e,f,g)#0A..t6(di,.e,.a,b,c,d,..f,g)#0A..t6(di,.f,.
a,b,c,d,e,..g)#0A..t6(di,.g,.a,b,c,d,e,f..)#0A}#0A.
#0AAND.t6(diag,.p,.a,b,c,d,e,f).BE.IF.(diag&p)#3D0.
DO#0A{.LET.di.#3D.diag+p.<<.2#0A..t5(di,.a,...b,c,d
,e,f)#0A..t5(di,.b,.a,..c,d,e,f)#0A..t5(di,.c,.a,b,
..d,e,f)#0A..t5(di,.d,.a,b,c,..e,f)#0A..t5(di,.e,.a
,b,c,d,..f)#0A..t5(di,.f,.a,b,c,d,e..)#0A}#0A.#0AAN
D.t5(diag,.p,.a,b,c,d,e).BE.IF.(diag&p)#3D0.DO#0A{.
LET.di.#3D.diag+p.<<.2#0A..t4(di,.a,...b,c,d,e)#0A.
.t4(di,.b,.a,..c,d,e)#0A..t4(di,.c,.a,b,..d,e)#0A..
t4(di,.d,.a,b,c,..e)#0A..t4(di,.e,.a,b,c,d..)#0A}#0A
.#0AAND.t4(diag,.p,.a,b,c,d).BE.IF.(diag&p)#3D0.DO#0A
{.LET.di.#3D.diag+p.<<.2#0A..t3(di,.a,...b,c,d)#0A.
.t3(di,.b,.a,..c,d)#0A..t3(di,.c,.a,b,..d)#0A..t3(d
i,.d,.a,b,c..)#0A}#0A.#0AAND.t3(diag,.p,.a,b,c).BE.
IF.(diag&p)#3D0.DO#0A{.LET.di.#3D.diag+p.<<.2#0A..t
2(di,.a,...b,c)#0A..t2(di,.b,.a,..c)#0A..t2(di,.c,.
a,b..)#0A}#0A.#0AAND.t2(diag,.p,.a,b).BE.IF.(diag&p
)#3D0.DO#0A{.LET.di.#3D.diag+p.<<.2#0A..t1(di,.a,..
.b)#0A..t1(di,.b,.a..)#0A}#0A.#0AAND.t1(diag,.p,.a)
.BE.IF.(diag&p)#3D0.DO#0A{.LET.di.#3D.diag+p.<<.2#0A
..t0(di,.a)#0A}#0A.#0AAND.t0(diag,.p).BE.IF.(diag&p
).#3D.0.DO.count.:#3D.count+1#0A#0A

######bcplprogs/demos/queens.b#
GET."libhdr"#0A.#0AGLOBAL.{.count:ug;.all..}#0A.#0A
LET.try(ld,.row,.rd).BE.TEST.row#3Dall#0A#0A.......
.................THEN.count.:#3D.count.+.1#0A#0A...
.....................ELSE.{.LET.poss.#3D.all.&.~(ld
.|.row.|.rd)#0A...............................WHILE
.poss.DO#0A...............................{.LET.p.#3D
.poss.&.-poss#0A.................................po
ss.:#3D.poss.-.p#0A................................
.try(ld+p.<<.1,.row+p,.rd+p.>>.1)#0A...............
................}#0A.............................}#0A
#0ALET.start().#3D.VALOF#0A{.all.:#3D.1#0A..#0A..FO
R.i.#3D.1.TO.16.DO#0A..{.count.:#3D.0#0A....try(0,.
0,.0)#0A....writef("Number.of.solutions.to.%i2-quee
ns.is.%i7*n",.i,.count)#0A....all.:#3D.2*all.+.1#0A
..}#0A#0A..RESULTIS.0#0A}#0A

######bcplprogs/demos/randtree.b#
SECTION."randtree"#0A#0AGET."libhdr"#0A#0AMANIFEST.
$(.op#3D0;.left#3D1;.right#3D2..$)#0A#0AGLOBAL.$(.s
pacep:200.$)#0A#0ALET.node(n,.x,.y).#3D.VALOF#0A$(.
spacep.:#3D.spacep.-.3#0A...op!spacep,.left!spacep,
.right!spacep.:#3D.n,.x,.y#0A...RESULTIS.spacep#0A$
)#0A#0AAND.randtree(size).#3D.size#3D0.->.0,.VALOF#0A
$(.LET.lsize.#3D.randno(size).-.1#0A...LET.rsize.#3D
.size.-.lsize.-.1#0A...RESULTIS.node(randno(5),.ran
dtree(lsize),.randtree(rsize))#0A$)#0A#0ALET.prtree
(tree).BE#0A$(.STATIC.$(.line.#3D.?..$)#0A#0A...LET
.prt(t,.n).BE.UNLESS.t#3D0.DO#0A...$(.line!(n+1).:#3D
.FALSE#0A......prt(left!t,.n+1)#0A......FOR.i.#3D.0
.TO.n-1.DO.writes(line!i.->."!.",."..")#0A......wri
tef("**-+.%n*n",.op!t)#0A......line!n.:#3D.NOT.line
!n#0A......line!(n+1).:#3D.right!t~#3D0#0A......FOR
.i.#3D.0.TO.n+1.DO.writes(line!i.->."!.",."..")#0A.
.....newline()#0A......prt(right!t,.n+1)#0A...$)#0A
...#0A...LET.v.#3D.VEC.100#0A...line.:#3D.v#0A...li
ne!0.:#3D.TRUE#0A...prt(tree,.0)#0A...newline()#0A$
)#0A#0ALET.start().#3D.VALOF#0A$(.LET.v.#3D.VEC.100
0#0A...spacep.:#3D.v+1000#0A...prtree(randtree(7))#0A
...RESULTIS.0#0A$)#0A

######bcplprogs/demos/ranexpr.b#
GET."libhdr"#0A#0AMANIFEST.$(#0AOp#3D0;.Val#3D1;.L#3D
1;.R#3D2.//.The.selectors#0ANumb#3D0;.Mult#3D1;.Div
#3D2.//.The.operators#0APlus#3D3;.Minus#3D4#0A$)#0A
#0AGLOBAL.$(.ptr:200.$)#0A#0ALET.list(n,.a,.b,.c).#3D
.VALOF#0A$(.LET.v.#3D.@a#0A...ptr.:#3D.ptr.-.n#0A..
.FOR.i.#3D.0.TO.n-1.DO.ptr!i.:#3D.v!i#0A...RESULTIS
.ptr#0A$)#0A#0AAND.randtree(n).#3D#0A...n#3D0.->.li
st(2,.Numb,.randno(1000)),#0A...VALOF.$(.LET.lno.#3D
.randno(n).-.1#0A............LET.rno.#3D.n.-.lno.-.
1#0A............RESULTIS.list(3,.randno(4),#0A.....
........................randtree(lno),#0A..........
...................randtree(rno))#0A.........$)#0A#0A
AND.eval(x).#3D#0A...Op!x.#3D.Numb..->.Val!x,#0A...
Op!x.#3D.Mult..->.eval(L!x).*.eval(R!x),#0A...Op!x.
#3D.Div...->.eval(L!x)./.eval(R!x),#0A...Op!x.#3D.P
lus..->.eval(L!x).+.eval(R!x),#0A...Op!x.#3D.Minus.
->.eval(L!x).-.eval(R!x),#0A...abort(999)#0A#0ALET.
start().#3D.VALOF#0A$(.LET.v.#3D.VEC.1000#0A...ptr.
:#3D.v+1000#0A...writef("Value.#3D.%n*n",.eval(rand
tree(7)))#0A...RESULTIS.0#0A$)#0A

######bcplprogs/demos/shtree.b#
GET."libhdr"#0A#0AGLOBAL.$(..//.variables#0Ahashtab
.....:.200#0Ahashtabsize.:.201#0Aseed........:.202#0A
spacep......:.203#0Aspacesize...:.204#0Aspacet.....
.:.205#0Aspacev......:.206#0A#0Ahashfn......:.210#0A
node........:.211#0Anodesused...:.212#0Aprinttree..
.:.213#0Arandomtree..:.214#0Asimpinit....:.215#0A$)
#0A#0AMANIFEST.$(..//.node.operators#0As#2Eint...#3D
.1#0As#2Eid....#3D.2#0As#2Eplus..#3D.10#0A$)#0A#0AM
ANIFEST.$(..//.selectors#0An#2Elink..#3D.0#0An#2Eco
unt.#3D.1#0An#2Eop....#3D.2#0An#2Ea1....#3D.3#0An#2E
a2....#3D.4#0A#0An#2Eupb...#3D.4#0A$)#0A#0ALET.hash
fn(op,.x,.y).#3D.(op*12345.+.x*54321.+.y*654321.>>.
1).REM.hashtabsize#0A#0AAND.node(op,.x,.y).#3D.VALO
F#0A$(.LET.hashval.#3D.hashfn(op,.x,.y)#0A...LET.pt
r.#3D.@.hashtab!hashval#0A#0A...$(.LET.p.#3D.!ptr#0A
#0A......IF.p.#3D.0.DO#0A......$(.p.:#3D.spacep.-.n
#2Eupb.-.1#0A.........IF.p<spacev.RESULTIS.0#0A....
.....spacep.:#3D.p#0A#0A.........n#2Ecount!p.:#3D.1
#0A.........n#2Eop!p....:#3D.op#0A.........n#2Ea1!p
....:#3D.x#0A.........n#2Ea2!p....:#3D.y#0A#0A.....
....n#2Elink!p.:#3D.hashtab!hashval#0A.........hash
tab!hashval.:#3D.p#0A#0A.........RESULTIS.p#0A.....
.$)#0A#0A......IF.n#2Eop!p#3Dop.&.#0A.........n#2Ea
1!p#3Dx..&#0A.........n#2Ea2!p#3Dy..RESULTIS.p#0A#0A
......ptr.:#3D.p#0A...$).REPEAT#0A$)..#0A#0AAND.nod
esused().#3D.VALOF#0A$(.LET.k.#3D.0#0A...FOR.i.#3D.
0.TO.hashtabsize.DO#0A...$(.LET.p.#3D.hashtab!i#0A.
.....UNTIL.p#3D0.|.k>50000.DO.p,.k.:#3D.n#2Elink!p,
.k+1#0A...$)#0A...RESULTIS.k#0A$)#0A#0AAND.printtre
e(x).BE#0A$(.IF.x#3D0.DO.$(.writes("nil")#0A.......
.........RETURN#0A.............$)#0A#0A...SWITCHON.
n#2Eop!x.INTO#0A...$(.DEFAULT:.....writes("unknown"
)#0A...................RETURN#0A#0A......CASE.s#2Ei
nt:..writef("%N",.n#2Ea1!x)#0A...................RE
TURN#0A#0A......CASE.s#2Eid:...writef("v%N",.n#2Ea1
!x)#0A...................RETURN#0A#0A......CASE.s#2E
plus:.writes("(")#0A...................printtree(n#2E
a1!x)#0A...................wrch('.')#0A............
.......printtree(n#2Ea2!x)#0A...................wrc
h(')')#0A...................RETURN#0A...$)#0A$)#0A#0A
AND.randno(upb).#3D.VALOF#0A$(.seed.:#3D.seed.*.214
7001325.+.715136305#0A...RESULTIS.(seed/3.>>.1).REM
.upb.+.1.#0A$)#0A#0AAND.randomtree(size).#3D.#0A...
.size#3D0.->.0,#0A....size#3D1.->.(.randno(50)>35.-
>.node(s#2Eid,..randno(5),.0),#0A..................
...............node(s#2Eint,.randno(3),.0)#0A......
........),.VALOF.$(.LET.p.#3D.randno(size).-.1#0A..
........................LET.q.#3D.size.-.p.-.1#0A..
........................RESULTIS.node(s#2Eplus,.ran
domtree(p),.randomtree(q))#0A......................
.$)#0A...#0A...#0AAND.simpinit().#3D.VALOF#0A$(.has
htabsize.:#3D.251#0A...seed........:#3D.12345#0A...
spacesize...:#3D.50000#0A.#0A...hashtab.:#3D.getvec
(hashtabsize)#0A...IF.hashtab.#3D.0.RESULTIS.0#0A#0A
...spacev.:#3D.getvec(spacesize)#0A...IF.spacev.#3D
.0.RESULTIS.0#0A...spacet.:#3D.spacev.+.spacesize#0A
...spacep.:#3D.spacet#0A#0A...RESULTIS.-1..//.succe
ssful.return#0A$)#0A#0A#0A#0ALET.start().#3D.VALOF#0A
$(.LET.tree.#3D.0#0A#0A...IF.simpinit()#3D0.DO#0A..
.$(.writes("Insufficient.memory*n")#0A......RESULTI
S.20#0A...$)#0A#0A...FOR.i.#3D.100.TO.2000.BY.100.D
O#0A...$(.FOR.i.#3D.0.TO.hashtabsize.DO.hashtab!i.:
#3D.0#0A......tree.:#3D.randomtree(i)#0A//....print
tree(tree)#0A......writef("Tree.size.%i4,..Nodes.us
ed.#3D.%i4*n",.i,.nodesused())#0A...$)#0A#0A...writ
es("End.of.test*n")#0A...RESULTIS.0#0A$)#0A

######bcplprogs/demos/splay.b#
SECTION."splay"#0A#0AGET."libhdr"#0A#0AMANIFEST.{#0A
..name.....#3D.0..//.tree.node.selectors#0A..data..
...#3D.1#0A..parent...#3D.2#0A..left.....#3D.3#0A..
right....#3D.4#0A}#0A#0AGLOBAL.{#0A..spacev.:.200#0A
..spacep.:.201#0A..line...:.202#0A}#0A#0A#0ALET.pri
ntree(t).BE.{.LET.v.#3D.VEC.100#0A.................
....line.:#3D.v#0A.....................line!1.:#3D.
TRUE#0A.....................printree1(left,.t,.1)#0A
.....................newline()#0A..................
...newline()#0A...................}#0A#0AAND.printr
ee1(side,.t,.indent).BE.UNLESS.t#3D0.DO#0A{.line!in
dent.:#3D.side#3Dleft#0A..printree1(right,.right!t,
.indent+1)#0A#0A..FOR.i.#3D.1.TO.indent-1.DO.writes
(line!i->"|..",."...")#0A..writef("**-+%c%c*n",.nam
e!t,.data!t)#0A..line!indent.:#3D.side#3Dright#0A..
printree1(left,.left!t,.indent+1)#0A//..FOR.i.#3D.1
.TO.indent...DO.writes(line!i->"|..",."...")#0A//..
newline()#0A}#0A#0AAND.maketree(ch,.val,.p,.l,.r).#3D
.VALOF#0A{.LET.node.#3D.spacep.-.5#0A..spacep.:#3D.
node#0A#0A..name...!.node..:#3D..ch#0A..data...!.no
de..:#3D..val#0A..parent.!.node..:#3D..p#0A..left..
.!.node..:#3D..l#0A..right..!.node..:#3D..r#0A#0A..
RESULTIS.node#0A}#0A#0AAND.rotateleft(y).BE#0A{.LET
.x.#3D.right!y#0A..AND.p.#3D.parent!y#0A#0A..UNLESS
.p#3D0.TEST.left!p#3Dy.THEN.left!p..:#3D.x#0A......
.....................ELSE.right!p.:#3D.x#0A..right!
y..:#3D.left!x#0A..left!x...:#3D.y#0A..parent!x.:#3D
.p#0A..parent!y.:#3D.x#0A#0A..UNLESS.right!y#3D0.DO
.parent!(right!y).:#3D.y#0A}#0A#0AAND.rotateright(y
).BE#0A{.LET.x.#3D.left!y#0A..AND.p.#3D.parent!y#0A
#0A..UNLESS.p#3D0.TEST.right!p#3Dy.THEN.right!p.:#3D
.x#0A............................ELSE.left!p..:#3D.
x#0A..left!y...:#3D.right!x#0A..right!x..:#3D.y#0A.
.parent!x.:#3D.p#0A..parent!y.:#3D.x#0A#0A..UNLESS.
left!y#3D0.DO.parent!(left!y).:#3D.y#0A}#0A#0AAND.s
play(x).BE.UNTIL.parent!x#3D0.DO#0A{.LET.p.#3D.pare
nt!x#0A..LET.g.#3D.parent!p#0A#0A..TEST.x.#3D.left!
p#0A..THEN.{.TEST.g#3D0.THEN.rotateright(p)#0A.....
.............ELSE.TEST.p#3Dleft!g.THEN.{.rotaterigh
t(g)#0A............................................
rotateright(p)#0A..................................
........}#0A.....................................EL
SE.{.rotateright(p)#0A.............................
...............rotateleft(g)#0A....................
......................}#0A.......}#0A..ELSE.{.TEST.
g#3D0.THEN.rotateleft(p)#0A..................ELSE.T
EST.p#3Dright!g.THEN.{.rotateleft(g)#0A............
.................................rotateleft(p)#0A..
.........................................}#0A......
................................ELSE.{.rotateleft(p
)#0A.............................................ro
tateright(g)#0A....................................
.......}#0A.......}#0A}#0A#0AAND.lookup(root,.found
,.key).BE#0A{.LET.t.#3D.!root#0A..!found.:#3D.FALSE
#0A#0A..writef("lookup:.%c*n",.key)#0A#0A..UNTIL.!f
ound.|.t#3D0.TEST.name!t#3Dkey.#0A.................
....THEN.{.!found.:#3D.TRUE#0A.....................
.......splay(t)#0A............................!root
.:#3D.t#0A..........................}#0A...........
..........ELSE.TEST.key.<.name!t.THEN.t.:#3D.left!t
#0A............................................ELSE
.t.:#3D.right!t#0A}#0A#0AAND.update(root,.key,.val)
.BE#0A{.LET.changed,.l.#3D.FALSE,.?#0A..AND.t,.p...
....#3D.!root,.0#0A#0A..writef("Update:.%c.#3D.%c*n
",.key,.val)#0A..UNTIL.t#3D0.|.changed.DO#0A..{.p.:
#3D.t#0A....TEST.key#3Dname!t#0A....THEN.{.changed.
:#3D.TRUE#0A...........data!t..:#3D.val#0A.........
}#0A....ELSE.TEST.key.<.name!t.THEN.{.l.:#3D.TRUE#0A
..................................t.:#3D.left!t#0A.
...............................}#0A................
...........ELSE.{.l.:#3D.FALSE#0A..................
................t.:#3D.right!t#0A..................
..............}#0A..}#0A#0A..UNLESS.changed.DO#0A..
{.t.:#3D.maketree(key,.val,.p,.0,.0)#0A....UNLESS.p
.#3D.0.TEST.l.THEN.left!p..:#3D.t#0A...............
.........ELSE.right!p.:#3D.t#0A..}#0A#0A..splay(t)#0A
..!root.:#3D.t#0A}#0A#0ALET.start().BE#0A{.LET.v...
..#3D.VEC.10000#0A..LET.root..#3D.0#0A..LET.found.#3D
.?#0A#0A..spacev,.spacep.:#3D.v,.v+10000#0A#0A..wri
tes("Splay.test.entered*N")#0A#0A..update(@root,'B'
,.'b')#0A..update(@root,'C',.'c')#0A..update(@root,
'D',.'d')#0A..update(@root,'E',.'e')#0A..printree(r
oot)#0A#0A..update(@root,'F',.'f')#0A..update(@root
,'G',.'g')#0A..update(@root,'H',.'h')#0A..update(@r
oot,'A',.'a')#0A..printree(root)#0A.#0A..update(@ro
ot,'L',.'l')#0A..update(@root,'K',.'k')#0A..update(
@root,'J',.'j')#0A..update(@root,'I',.'i')#0A..prin
tree(root)#0A#0A..lookup(@root,.@found,.'A');.print
ree(root)#0A..lookup(@root,.@found,.'H');.printree(
root)#0A..lookup(@root,.@found,.'K');.printree(root
)#0A..lookup(@root,.@found,.'A');.printree(root)#0A
..lookup(@root,.@found,.'I');.printree(root)#0A}#0A
#0A

######bcplprogs/demos/squad1.b#
/*#0AThis.is.a.simple.implementation.of.the.firing.
squad.problem#0Aby.Martin.Richards..(c).September.2
004#0A*/#0A#0AGET."libhdr"#0A#0AMANIFEST.{.upb.#3D.
1000.}#0A.#0AGLOBAL.{.rulev:.ug.}#0A#0ALET.start().
#3D.VALOF#0A{.LET.v.#3D.VEC.upb#0A..AND.n.#3D.50#0A
..LET.argv.#3D.VEC.20#0A#0A..UNLESS.rdargs("N",.arg
v,.20).DO#0A..{.writes("Bad.arguments.for.SQUAD*n")
#0A....RESULTIS.20#0A..}#0A..UNLESS.argv!0#3D0.DO.n
.:#3D.str2numb(argv!0)#0A#0A..UNLESS.2<#3Dn<#3Dupb.
DO#0A..{.writef("The.number.of.soldiers.must.be.bet
ween.2.and.%n*n",.upb)#0A....RESULTIS.0#0A..}#0A#0A
..writef("*nFiring.squad.solution.for.%i2.soldier%-
%ps*n*n",.n)#0A..squad(v,.n)#0A..RESULTIS.0#0A}#0A.
#0AAND.squad(v,.n).BE#0A{.LET.count.#3D.0#0A..initr
ules()#0A..FOR.i.#3D.0.TO.n+1.DO.v!i.:#3D.0........
........//.1#3D-#0A..v!1,.v!n.:#3D.1,.4............
................//.1#3DS.4#3D|#0A#0A..{.LET.p,.a,.b
,.c.#3D.0,.?,.v!0,.v!1#0A....LET.error.#3D.FALSE#0A
....LET.t.#3D.TABLE.'-',.'S',.'#2E',.'+',.'|',.'>',
.'<',.')',#0A..................']',.'\',.'(',.'[',.
'/',.'F',.'#23',.'?'#0A....//LET.t.#3D.TABLE.'0',.'
1',.'2',.'3',.'4',.'5',.'6',.'7',#0A....//.........
.....'8',.'9',.'A',.'B',.'C',.'D',.'E',.'?'#0A....w
ritef("%i3:.",.count)#0A....count.:#3D.count+1#0A..
..FOR.i.#3D.1.TO.n.DO#0A....{.LET.val.#3D.v!i#0A...
...writef("%c",.t!val)#0A......IF.val#3D#23xF.DO.er
ror.:#3D.TRUE#0A....}#0A....newline()#0A....IF.v!2#3D
#23xD.|.error.BREAK#0A....UNTIL.p#3Dn.DO#0A....{.p.
:#3D.p+1#0A......a.:#3D.b#0A......b.:#3D.c#0A......
c.:#3D.v!(p+1)#0A......v!p.:#3D.func(a,.b,.c)#0A...
.}#0A..}.REPEAT#0A.#0A..newline()#0A..closerules()#0A
}#0A#0AAND.setrule(abc,.val).BE#0A{.UNLESS.rulev!ab
c.#3D.#23xF.DO#0A....writef("Error:.rule.#23x%x3.#3D
>.%x1.and.%x1*n",.abc,.rulev!abc,.val)#0A..rulev!ab
c.:#3D.val#0A}#0A#0AAND.initrules().BE#0A{.MANIFEST
.{.A#3D10;.B;.C;.D;.E;.F.}#0A..rulev.:#3D.getvec(#23
xFFF)#0A..FOR.i.#3D.0.TO.#23xFFF.DO.rulev!i.:#3D.#23
xF#0A#0A..setrule(#23x010,.3)#0A..setrule(#23x100,.
5)#0A..setrule(#23x000,.0)#0A..setrule(#23x004,.0)#0A
..setrule(#23x040,.4)#0A..setrule(#23x500,.5)#0A..s
etrule(#23x035,.4)#0A..setrule(#23x350,.7)#0A..setr
ule(#23x047,.4)#0A..setrule(#23x475,.8)#0A..setrule
(#23x750,.0)#0A..setrule(#23x048,.4)#0A..setrule(#23
x480,.9)#0A..setrule(#23x805,.0)#0A..setrule(#23x05
0,.0)#0A..setrule(#23x049,.4)#0A..setrule(#23x490,.
0)#0A..setrule(#23x900,.7)#0A..setrule(#23x005,.0)#0A
..setrule(#23x407,.0)#0A..setrule(#23x070,.8)#0A..s
etrule(#23x700,.0)#0A..setrule(#23x408,.0)#0A..setr
ule(#23x080,.9)#0A..setrule(#23x800,.0)#0A..setrule
(#23x409,.0)#0A..setrule(#23x090,.0)#0A..setrule(#23
x400,.0)#0A..setrule(#23x007,.0)#0A..setrule(#23x00
8,.0)#0A..setrule(#23x009,.0)#0A..setrule(#23x504,.
6)#0A..setrule(#23x006,.6)#0A..setrule(#23x064,.0)#0A
..setrule(#23x640,.4)#0A..setrule(#23x060,.0)#0A..s
etrule(#23x604,.0)#0A..setrule(#23x600,.0)#0A..setr
ule(#23x076,.1)#0A..setrule(#23x760,.1)#0A..setrule
(#23x001,.6)#0A..setrule(#23x011,.3)#0A..setrule(#23
x110,.3)#0A..setrule(#23x063,.A)#0A..setrule(#23x63
3,.4)#0A..setrule(#23x335,.4)#0A..setrule(#23x06A,.
0)#0A..setrule(#23x6A4,.B)#0A..setrule(#23xA44,.4)#0A
..setrule(#23x447,.4)#0A..setrule(#23x60B,.0)#0A..s
etrule(#23x0B4,.C)#0A..setrule(#23xB44,.4)#0A..setr
ule(#23x448,.4)#0A..setrule(#23x00C,.A)#0A..setrule
(#23x0C4,.0)#0A..setrule(#23xC44,.4)#0A..setrule(#23
x449,.4)#0A..setrule(#23x00A,.0)#0A..setrule(#23x0A
0,.B)#0A..setrule(#23xA04,.0)#0A..setrule(#23x044,.
4)#0A..setrule(#23x440,.4)#0A..setrule(#23x00B,.0)#0A
..setrule(#23x0B0,.C)#0A..setrule(#23xB04,.0)#0A..s
etrule(#23x0C0,.0)#0A..setrule(#23xC04,.0)#0A..setr
ule(#23x406,.5)#0A..setrule(#23xA00,.0)#0A..setrule
(#23x045,.4)#0A..setrule(#23x450,.0)#0A..setrule(#23
xB00,.0)#0A..setrule(#23x405,.0)#0A..setrule(#23xC0
0,.0)#0A..setrule(#23x50B,.1)#0A..setrule(#23x806,.
1)#0A..setrule(#23x01C,.3)#0A..setrule(#23x1C0,.5)#0A
..setrule(#23x091,.6)#0A..setrule(#23x910,.3)#0A..s
etrule(#23x635,.4)#0A..setrule(#23xA47,.4)#0A..setr
ule(#23xB48,.4)#0A..setrule(#23xC49,.4)#0A..setrule
(#23x644,.4)#0A..setrule(#23x445,.4)#0A..setrule(#23
x05A,.1)#0A..setrule(#23x5A0,.1)#0A..setrule(#23x40
1,.1)#0A..setrule(#23x104,.1)#0A..setrule(#23x041,.
D)#0A..setrule(#23x413,.D)#0A..setrule(#23x133,.D)#0A
..setrule(#23x331,.D)#0A..setrule(#23x314,.D)#0A..s
etrule(#23x141,.D)#0A..setrule(#23x144,.D)#0A..setr
ule(#23x441,.D)#0A..setrule(#23x140,.D)#0A..setrule
(#23x645,.4)#0A..setrule(#23x45A,.1)#0A..setrule(#23
x5A4,.1)#0A..setrule(#23x476,.1)#0A..setrule(#23x76
4,.1)#0A..setrule(#23x411,.D)#0A..setrule(#23x114,.
D)#0A..setrule(#23x1C4,.1)#0A..setrule(#23x491,.1)#0A
..setrule(#23x131,.D)#0A..setrule(#23x031,.D)#0A..s
etrule(#23x030,.D)#0A..setrule(#23x014,.D)#0A#0A#0A
/*#0A..0#3D-#0A..1#3DS#0A..2#3D#2E....not.used#0A..
3#3D+#0A..4#3D|#0A..5#3D>#0A..6#3D<#0A..7#3D)#0A..8
#3D]#0A..9#3D\#0A.10#3D(#0A.11#3D[#0A.12#3D/#0A.13#3D
F#0A*/#0A}#0A#0AAND.closerules().BE.IF.rulev.DO.fre
evec(rulev)#0A#0AAND.func(a,.b,.c).#3D.rulev!((a<<8
).+.(b<<4).+.c)#0A#0A/*#0A0>.squad1.27#0A#0AFiring.
squad.solution.for.27.soldiers#0A#0A..0:.S---------
----------------|#0A..1:.+>------------------------
|#0A..2:.|)>-----------------------|#0A..3:.|]->---
-------------------|#0A..4:.|\-->------------------
---|#0A..5:.|-)-->--------------------|#0A..6:.|-]-
-->-------------------|#0A..7:.|-\---->------------
------|#0A..8:.|--)---->-----------------|#0A..9:.|
--]----->----------------|#0A.10:.|--\------>------
---------|#0A.11:.|---)------>--------------|#0A.12
:.|---]------->-------------|#0A.13:.|---\-------->
------------|#0A.14:.|----)-------->-----------|#0A
.15:.|----]--------->----------|#0A.16:.|----\-----
----->---------|#0A.17:.|-----)---------->--------|
#0A.18:.|-----]----------->-------|#0A.19:.|-----\-
----------->------|#0A.20:.|------)------------>---
--|#0A.21:.|------]------------->----|#0A.22:.|----
--\-------------->---|#0A.23:.|-------)------------
-->--|#0A.24:.|-------]--------------->-|#0A.25:.|-
------\----------------<|#0A.26:.|--------)--------
------<-|#0A.27:.|--------]-------------<--|#0A.28:
.|--------\------------<---|#0A.29:.|---------)----
------<----|#0A.30:.|---------]---------<-----|#0A.
31:.|---------\--------<------|#0A.32:.|----------)
------<-------|#0A.33:.|----------]-----<--------|#0A
.34:.|----------\----<---------|#0A.35:.|----------
-)--<----------|#0A.36:.|-----------]-<-----------|
#0A.37:.|-----------\S------------|#0A.38:.|-------
----<+>-----------|#0A.39:.|----------<(|)>--------
--|#0A.40:.|---------<-[|]->---------|#0A.41:.|----
----<--/|\-->--------|#0A.42:.|-------<--(-|-)-->--
-----|#0A.43:.|------<---[-|-]--->------|#0A.44:.|-
----<----/-|-\---->-----|#0A.45:.|----<----(--|--)-
--->----|#0A.46:.|---<-----[--|--]----->---|#0A.47:
.|--<------/--|--\------>--|#0A.48:.|-<------(---|-
--)------>-|#0A.49:.|>-------[---|---]-------<|#0A.
50:.|->------/---|---\------<-|#0A.51:.|-->----(---
-|----)----<--|#0A.52:.|--->---[----|----]---<---|#0A
.53:.|---->--/----|----\--<----|#0A.54:.|----->(---
--|-----)<-----|#0A.55:.|-----SS-----|-----SS-----|
#0A.56:.|----<++>----|----<++>----|#0A.57:.|---<(||
)>---|---<(||)>---|#0A.58:.|--<-[||]->--|--<-[||]->
--|#0A.59:.|-<--/||\-->-|-<--/||\-->-|#0A.60:.|>--(
-||-)--<|>--(-||-)--<|#0A.61:.|->-[-||-]-<-|->-[-||
-]-<-|#0A.62:.|--S/-||-\S--|--S/-||-\S--|#0A.63:.|-
<+>-||-<+>-|-<+>-||-<+>-|#0A.64:.|>(|)<||>(|)<|>(|)
<||>(|)<|#0A.65:.|SS|SS||SS|SS|SS|SS||SS|SS|#0A.66:
.FFFFFFFFFFFFFFFFFFFFFFFFFFF#0A#0A10>.#0A*/#0A.#0A

######bcplprogs/demos/squad2.b#
/*#0AThis.is.a.implementation.of.the.firing.squad.p
roblem.deduced.from#0Athe.image:.http://mathworld#2E
wolfram#2Ecom/fimg1392#2Egif#0A#0AThe.BCPL.implemen
tion.is.by.Martin.Richards#0A#0ARef:#0A#0AEric.W#2E
.Weisstein,."Firing.Squad.Problem#2E".From.MatthWor
ld.--.A.Wolfram#0AWeb.Resource#2E.http://mathworld#2E
wolfram#2Ecom/FiringSquadProblem#2Ehtml#0A*/#0A#0AG
ET."libhdr"#0A#0AMANIFEST.{.upb.#3D.1000.}#0A.#0AGL
OBAL.{.rulev:.ug.}#0A#0ALET.start().#3D.VALOF#0A{.L
ET.v.#3D.VEC.upb#0A..AND.n.#3D.50#0A..LET.argv.#3D.
VEC.20#0A#0A..UNLESS.rdargs("N",.argv,.20).DO#0A..{
.writes("Bad.arguments.for.SQUAD*n")#0A....RESULTIS
.20#0A..}#0A..UNLESS.argv!0#3D0.DO.n.:#3D.str2numb(
argv!0)#0A#0A..UNLESS.1<#3Dn<#3Dupb.DO#0A..{.writef
("The.number.of.soldiers.must.be.between.1.and.%n*n
",.upb)#0A....RESULTIS.0#0A..}#0A#0A..writef("*nFir
ing.squad.solution.for.%i2.soldier%-%ps*n*n",.n)#0A
..squad(v,.n+2)#0A..RESULTIS.0#0A}#0A.#0AAND.squad(
v,.n).BE#0A{.LET.count.#3D.0#0A..initrules()#0A..FO
R.i.#3D.0.TO.n+1.DO.v!i.:#3D.0#0A..v!1,.v!2,.v!n.:#3D
.5,.1,.5#0A#0A..{.LET.p,.a,.b,.c.#3D.0,.?,.v!0,.v!1
#0A....LET.error.#3D.FALSE#0A....LET.t.#3D.TABLE.'.
',.'1',.'2',.'3',.'X',.'|',.'**',.'7',#0A..........
........'8',.'9',.'A',.'B',.'C',.'D',.'E',.'?'#0A..
..//LET.t.#3D.TABLE.'0',.'1',.'2',.'3',.'4',.'5',.'
6',.'7',#0A....//..............'8',.'9',.'A',.'B',.
'C',.'D',.'E',.'?'#0A....writef("%i3:.",.count)#0A.
...count.:#3D.count+1#0A....FOR.i.#3D.1.TO.n.DO#0A.
...{.LET.val.#3D.v!i#0A......writef("%c",.t!val)#0A
......IF.val#3D#23xF.DO.error.:#3D.TRUE#0A....}#0A.
...newline()#0A....IF.v!2#3D6.|.error.BREAK#0A....U
NTIL.p#3Dn.DO#0A....{.p.:#3D.p+1#0A......a.:#3D.b#0A
......b.:#3D.c#0A......c.:#3D.v!(p+1)#0A......v!p.:
#3D.func(a,.b,.c)#0A....}#0A..}.REPEAT#0A.#0A..newl
ine()#0A..closerules()#0A}#0A#0AAND.setrule(abc,.va
l).BE#0A{.UNLESS.rulev!abc.#3D.#23xF.DO#0A....write
f("Error:.rule.#23x%x3.#3D>.%x1.and.%x1*n",.abc,.ru
lev!abc,.val)#0A..rulev!abc.:#3D.val#0A}#0A#0AAND.i
nitrules().BE#0A{.rulev.:#3D.getvec(#23xFFF)#0A..FO
R.i.#3D.0.TO.#23xFFF.DO.rulev!i.:#3D.#23xF#0A#0A..s
etrule(#23x051,.5)#0A..setrule(#23x510,.3)#0A..setr
ule(#23x100,.2)#0A..setrule(#23x000,.0)#0A..setrule
(#23x005,.0)#0A..setrule(#23x050,.5)#0A..setrule(#23
x053,.5)#0A..setrule(#23x532,.1)#0A..setrule(#23x32
0,.4)#0A..setrule(#23x200,.3)#0A..setrule(#23x514,.
1)#0A..setrule(#23x143,.2)#0A..setrule(#23x430,.1)#0A
..setrule(#23x300,.1)#0A..setrule(#23x512,.1)#0A..s
etrule(#23x121,.4)#0A..setrule(#23x211,.3)#0A..setr
ule(#23x110,.4)#0A..setrule(#23x434,.1)#0A..setrule
(#23x342,.0)#0A..setrule(#23x420,.2)#0A..setrule(#23
x102,.0)#0A..setrule(#23x230,.3)#0A..setrule(#23x21
0,.3)#0A..setrule(#23x023,.3)#0A..setrule(#23x303,.
0)#0A..setrule(#23x033,.3)#0A..setrule(#23x331,.4)#0A
..setrule(#23x310,.4)#0A..setrule(#23x103,.0)#0A..s
etrule(#23x034,.0)#0A..setrule(#23x344,.4)#0A..setr
ule(#23x442,.2)#0A..setrule(#23x004,.0)#0A..setrule
(#23x042,.0)#0A..setrule(#23x422,.2)#0A..setrule(#23
x223,.3)#0A..setrule(#23x305,.2)#0A..setrule(#23x00
2,.0)#0A..setrule(#23x233,.3)#0A..setrule(#23x332,.
2)#0A..setrule(#23x325,.4)#0A..setrule(#23x250,.5)#0A
..setrule(#23x203,.0)#0A..setrule(#23x324,.4)#0A..s
etrule(#23x245,.0)#0A..setrule(#23x450,.5)#0A..setr
ule(#23x020,.2)#0A..setrule(#23x032,.1)#0A..setrule
(#23x240,.0)#0A..setrule(#23x405,.0)#0A..setrule(#23
x302,.0)#0A..setrule(#23x201,.1)#0A..setrule(#23x01
4,.1)#0A..setrule(#23x140,.2)#0A..setrule(#23x400,.
0)#0A..setrule(#23x021,.1)#0A..setrule(#23x112,.1)#0A
..setrule(#23x120,.4)#0A..setrule(#23x301,.2)#0A..s
etrule(#23x013,.1)#0A..setrule(#23x131,.2)#0A..setr
ule(#23x314,.1)#0A..setrule(#23x212,.1)#0A..setrule
(#23x125,.4)#0A..setrule(#23x141,.1)#0A..setrule(#23
x414,.1)#0A..setrule(#23x145,.1)#0A..setrule(#23x51
1,.6)#0A..setrule(#23x111,.6)#0A..setrule(#23x115,.
6)#0A..setrule(#23x150,.5)#0A..setrule(#23x334,.4)#0A
..setrule(#23x440,.1)#0A..setrule(#23x403,.0)#0A..s
etrule(#23x041,.4)#0A..setrule(#23x410,.4)#0A..setr
ule(#23x104,.0)#0A..setrule(#23x044,.4)#0A..setrule
(#23x340,.1)#0A..setrule(#23x404,.0)#0A..setrule(#23
x330,.3)#0A..setrule(#23x333,.3)#0A..setrule(#23x22
0,.2)#0A..setrule(#23x222,.2)#0A..setrule(#23x022,.
2)#0A..setrule(#23x402,.0)#0A..setrule(#23x441,.4)#0A
..setrule(#23x444,.4)#0A..setrule(#23x204,.0)#0A..s
etrule(#23x321,.4)#0A..setrule(#23x202,.0)#0A..setr
ule(#23x241,.0)#0A..setrule(#23x401,.0)#0A..setrule
(#23x012,.1)#0A..setrule(#23x001,.0)#0A..setrule(#23
x205,.1)#0A..setrule(#23x221,.4)#0A..setrule(#23x21
5,.3)#0A..setrule(#23x024,.1)#0A..setrule(#23x243,.
3)#0A..setrule(#23x435,.2)#0A..setrule(#23x350,.5)#0A
..setrule(#23x132,.2)#0A..setrule(#23x124,.4)#0A..s
etrule(#23x415,.1)#0A..setrule(#23x304,.0)#0A..setr
ule(#23x224,.4)#0A..setrule(#23x432,.2)#0A..setrule
(#23x105,.3)#0A..setrule(#23x431,.2)#0A..setrule(#23
x101,.3)#0A..setrule(#23x443,.3)#0A..setrule(#23x31
2,.1)#0A..setrule(#23x214,.1)#0A..setrule(#23x412,.
1)#0A..setrule(#23x043,.1)#0A..setrule(#23x114,.1)#0A
..setrule(#23x343,.4)#0A..setrule(#23x135,.2)#0A..s
etrule(#23x142,.4)#0A..setrule(#23x421,.1)#0A..setr
ule(#23x411,.1)#0A..setrule(#23x533,.6)#0A..setrule
(#23x335,.6)#0A..setrule(#23x425,.1)#0A..setrule(#23
x515,.6)#0A}#0A#0AAND.closerules().BE.IF.rulev.DO.f
reevec(rulev)#0A#0AAND.func(a,.b,.c).#3D.VALOF#0A{.
LET.i.#3D.a<<8.|.b<<4.|.c#0A..RESULTIS.rulev!i#0A}#0A
#0A/*#0A0>.squadf.50#0A#0AFiring.squad.solution.for
.50.soldiers#0A#0A..0:.|1..........................
.......................|#0A..1:.|32................
................................|#0A..2:.|1X3......
.........................................|#0A..3:.|
1211..............................................|
#0A..4:.|1X3X2.....................................
........|#0A..5:.|121.23...........................
.................|#0A..6:.|1X3.331.................
..........................|#0A..7:.|121.3XX2.......
...................................|#0A..8:.|1X3..X
223.........................................|#0A..9
:.|1211..2331......................................
..|#0A.10:.|1X3X2.33XX2............................
...........|#0A.11:.|121.2.3XX223..................
....................|#0A.12:.|1X3.2..X22331........
.............................|#0A.13:.|121.23..233X
X2....................................|#0A.14:.|1X3
.331.33XX223...................................|#0A
.15:.|121.3XX.3XX22331.............................
.....|#0A.16:.|1X3..X1..X2233XX2...................
..............|#0A.17:.|1211.XX2..233XX223.........
.......................|#0A.18:.|1X3X.X223.33XX2233
1...............................|#0A.19:.|1211..233
.3XX2233XX2..............................|#0A.20:.|
1X3X2.333..X2233XX223.............................|
#0A.21:.|121.2.3331..233XX22331....................
........|#0A.22:.|1X3.2.33XX2.33XX2233XX2..........
.................|#0A.23:.|121.2.3XX22.3XX2233XX223
..........................|#0A.24:.|1X3.2..X222..X2
233XX22331.........................|#0A.25:.|121.23
..2223..233XX2233XX2........................|#0A.26
:.|1X3.331.22331.33XX2233XX223.....................
..|#0A.27:.|121.3XX.233XX.3XX2233XX22331...........
...........|#0A.28:.|1X3..X1.33XX1..X2233XX2233XX2.
....................|#0A.29:.|1211.XX.3XXXX2..233XX
2233XX223....................|#0A.30:.|1X3X.X1..XXX
223.33XX2233XX22331...................|#0A.31:.|121
1.XX2.XX2233.3XX2233XX2233XX2..................|#0A
.32:.|1X3X.X22.X22333..X2233XX2233XX223............
.....|#0A.33:.|1211..22..233331..233XX2233XX22331..
..............|#0A.34:.|1X3X2.223.3333XX2.33XX2233X
X2233XX2...............|#0A.35:.|121.2.233.333XX22.
3XX2233XX2233XX223..............|#0A.36:.|1X3.2.333
.33XX222..X2233XX2233XX22331.............|#0A.37:.|
121.2.333.3XX22223..233XX2233XX2233XX2............|
#0A.38:.|1X3.2.333..X2222331.33XX2233XX2233XX223...
........|#0A.39:.|121.2.3331..22233XX.3XX2233XX2233
XX22331..........|#0A.40:.|1X3.2.33XX2.2233XX1..X22
33XX2233XX2233XX2.........|#0A.41:.|121.2.3XX22.233
XXXX2..233XX2233XX2233XX223........|#0A.42:.|1X3.2.
.X222.33XXXX223.33XX2233XX2233XX22331.......|#0A.43
:.|121.23..222.3XXXX2233.3XX2233XX2233XX2233XX2....
..|#0A.44:.|1X3.331.222..XXX22333..X2233XX2233XX223
3XX223.....|#0A.45:.|121.3XX.2223.XX2233331..233XX2
233XX2233XX22331....|#0A.46:.|1X3..X1.2233.X223333X
X2.33XX2233XX2233XX2233XX2...|#0A.47:.|1211.XX.2333
..23333XX22.3XX2233XX2233XX2233XX223..|#0A.48:.|1X3
X.X1.33331.3333XX222..X2233XX2233XX2233XX22331.|#0A
.49:.|1211.XX.333XX.333XX22223..233XX2233XX2233XX22
33XX3|#0A.50:.|1X3X.X1.33XX1.33XX2222331.33XX2233XX
2233XX2233XX32|#0A.51:.|1211.XX.3XXXX.3XX222233XX.3
XX2233XX2233XX2233XX32X|#0A.52:.|1X3X.X1..XXX1..X22
2233XX1..X2233XX2233XX2233XX32X.|#0A.53:.|1211.XX2.
XXXX2..22233XXXX2..233XX2233XX2233XX32X..|#0A.54:.|
1X3X.X22.XXX223.2233XXXX223.33XX2233XX2233XX32X...|
#0A.55:.|1211..22.XX2233.233XXXX2233.3XX2233XX2233X
X32X....|#0A.56:.|1X3X2.22.X22333.33XXXX22333..X223
3XX2233XX32X.....|#0A.57:.|121.2.22..23333.3XXXX223
3331..233XX2233XX32X......|#0A.58:.|1X3.2.223.33333
..XXX223333XX2.33XX2233XX32X.......|#0A.59:.|121.2.
233.333331.XX223333XX22.3XX2233XX32X........|#0A.60
:.|1X3.2.333.3333XX.X223333XX222..X2233XX32X.......
..|#0A.61:.|121.2.333.333XX1..23333XX22223..233XX32
X..........|#0A.62:.|1X3.2.333.33XXXX2.3333XX222233
1.33XX32X...........|#0A.63:.|121.2.333.3XXXX22.333
XX222233XX.3XX32X............|#0A.64:.|1X3.2.333..X
XX222.33XX222233XX1..X32X.............|#0A.65:.|121
.2.3331.XX2222.3XX222233XXXX2.12X..............|#0A
.66:.|1X3.2.33XX.X22222..X222233XXXX2211X..........
.....|#0A.67:.|121.2.3XX1..222223..22233XXXX22X312.
..............|#0A.68:.|1X3.2..XXX2.2222331.2233XXX
X22X321X3..............|#0A.69:.|121.23.XX22.22233X
X.233XXXX22X32X1211.............|#0A.70:.|1X3.33.X2
22.2233XX1.33XXXX22X32X.1X3X2............|#0A.71:.|
121.33..222.233XXXX.3XXXX22X32X..121.23...........|
#0A.72:.|1X3.331.222.33XXXX1..XXX22X32X...1X3.331..
........|#0A.73:.|121.3XX.222.3XXXXXX2.XX22X32X....
121.3XX2.........|#0A.74:.|1X3..X1.222..XXXXX22.X22
X32X.....1X3..X223........|#0A.75:.|1211.XX.2223.XX
XX222..2X32X......1211..2331.......|#0A.76:.|1X3X.X
1.2233.XXX22223.132X.......1X3X2.33XX2......|#0A.77
:.|1211.XX.2333.XX222233212X........121.2.3XX223...
..|#0A.78:.|1X3X.X1.3333.X2222332X1X.........1X3.2.
.X22331....|#0A.79:.|1211.XX.3333..222332X.12......
...121.23..233XX2...|#0A.80:.|1X3X.X1.33331.22332X.
.1X3........1X3.331.33XX223..|#0A.81:.|1211.XX.333X
X.2332X...1211.......121.3XX.3XX22331.|#0A.82:.|1X3
X.X1.33XX1.332X....1X3X2......1X3..X1..X2233XX3|#0A
.83:.|1211.XX.3XXXX.32X.....121.23.....1211.XX2..23
3XX32|#0A.84:.|1X3X.X1..XXX1.1X......1X3.331....1X3
X.X223.33XX32X|#0A.85:.|1211.XX2.XXXX312......121.3
XX2...1211..233.3XX32X.|#0A.86:.|1X3X.X22.XXX321X3.
....1X3..X223..1X3X2.333..X32X..|#0A.87:.|1211..22.
XX32X1211....1211..2331.121.2.3331.12X...|#0A.88:.|
1X3X2.22.X32X.1X3X2...1X3X2.33XX31X3.2.33XX31X....|
#0A.89:.|121.2.22.12X..121.23..121.2.3XX32121.2.3XX
3212....|#0A.90:.|1X3.2.2211X...1X3.331.1X3.2..X32X
1X3.2..X32X1X3...|#0A.91:.|121.2.2X312...121.3XX312
1.23.12X.121.23.12X.1211..|#0A.92:.|1X3.2.1321X3..1
X3..X321X3.3321X..1X3.3321X..1X3X2.|#0A.93:.|121.21
12X1211.1211.12X121.32X12..121.32X12..121.21|#0A.94
:.|1X3.131X.1X3X31X3X31X.1X3.1X.1X3.1X3.1X.1X3.1X3.
13|#0A.95:.|12121212.121X2121X212.121212.1212121212
.1212121212|#0A.96:.|1X1X1X1X11X1X11X1X11X11X1X1X11
X1X1X1X1X11X1X1X1X1X|#0A.97:.|111111111111111111111
11111111111111111111111111111|#0A.98:.|************
**************************************|#0A#0A30>#0A
*/#0A.#0A

######bcplprogs/demos/squad3.b#
/*#0AThis.is.a.framework.for.experimenting.with.sol
utions#0Ato.the.firing.squad.problem#2E#0A*/#0A#0AG
ET."libhdr"#0A#0AMANIFEST.{.upb.#3D.1000.}#0A.#0AGL
OBAL.{.rulev:.ug;.codetab.}#0A#0ALET.start().#3D.VA
LOF#0A{.LET.v.#3D.VEC.upb#0A..AND.n.#3D.50#0A..LET.
argv.#3D.VEC.20#0A#0A..UNLESS.rdargs("N",.argv,.20)
.DO#0A..{.writes("Bad.arguments.for.SQUAD*n")#0A...
.RESULTIS.20#0A..}#0A..UNLESS.argv!0#3D0.DO.n.:#3D.
str2numb(argv!0)#0A#0A..UNLESS.1<#3Dn<#3Dupb.DO#0A.
.{.writef("The.number.of.soldiers.must.be.between.1
.and.%n*n",.upb)#0A....RESULTIS.0#0A..}#0A#0A..writ
ef("*nFiring.squad.solution.for.%i2.soldier%-%ps*n*
n",.n)#0A..squad(v,.n+2)#0A..RESULTIS.0#0A}#0A.#0AA
ND.squad(v,.n).BE#0A{.LET.count.#3D.0#0A..codetab.:
#3D.TABLE.'.',.'|',.'>',.')',.']',.'<',.'(',.'[',#0A
...................'1',.'2',.'3',.'4',.'5',.'6',.'#23
',.'?'#0A..initrules()#0A..FOR.i.#3D.0.TO.n+1.DO.v!
i.:#3D.0#0A..v!1,.v!2,.v!n.:#3D.1,.2,.1#0A#0A..{.LE
T.p,.a,.b,.c.#3D.0,.?,.v!0,.v!1#0A....LET.error.#3D
.FALSE#0A....writef("%i3:.",.count)#0A....count.:#3D
.count+1#0A....FOR.i.#3D.1.TO.n.DO#0A....{.LET.val.
#3D.v!i#0A......writef("%c",.codetab!val)#0A......I
F.val#3D#23xF.DO.error.:#3D.TRUE#0A....}#0A....newl
ine()#0A....IF.v!2#3D6.|.error.BREAK#0A....UNTIL.p#3D
n.DO#0A....{.p.:#3D.p+1#0A......a.:#3D.b#0A......b.
:#3D.c#0A......c.:#3D.v!(p+1)#0A......v!p.:#3D.func
(a,.b,.c)#0A....}#0A..}.REPEAT#0A.#0A..newline()#0A
..closerules()#0A}#0A#0AAND.setrule(abc,.val).BE#0A
{.UNLESS.rulev!abc.#3D.#23xF.DO#0A..{.LET.a.#3D.cod
ech(abc>>8)#0A....LET.b.#3D.codech(abc>>4)#0A....LE
T.c.#3D.codech(abc...)#0A....writef("Error:.rule.'%
c%c%c'.#3D>.%c.and.%c*n",#0A.......................
..a,b,c,.codech(rulev!abc),.codech(val))#0A..}#0A..
rulev!abc.:#3D.val#0A}#0A#0AAND.codech(x).#3D.codet
ab!(x&15)#0A#0AAND.code(ch).#3D.VALOF#0A{.FOR.i.#3D
.0.TO.15.IF.ch#3Dcodetab!i.RESULTIS.i.#0A..RESULTIS
.-1#0A}#0A#0AAND.rule(s).BE#0A{.LET.a...#3D.code(s%
1)#0A..LET.b...#3D.code(s%2)#0A..LET.c...#3D.code(s
%3)#0A..LET.val.#3D.code(s%5)#0A..UNLESS.s%0#3D5.&.
(a|b|c|val)>#3D0.DO#0A..{.writef("Bad.rule:.%s*n",.
s)#0A....RETURN#0A..}#0A..setrule(a<<8.|.b<<4.|.c,.
val)#0A}#0A#0AAND.initrules().BE#0A{.rulev.:#3D.get
vec(#23xFFF)#0A..FOR.i.#3D.0.TO.#23xFFF.DO.rulev!i.
:#3D.#23xF#0A#0A..rule(".|>#3D|")#0A..rule("|>.#3D.
")#0A..rule(">..#3D>")#0A..rule("...#3D.")#0A..rule
("..|#3D.")#0A..rule(".|.#3D|")#0A..rule("|.>#3D.")
#0A..rule(".>.#3D.")#0A..rule("|..#3D.")#0A..rule("
..>#3D<")#0A..rule(">.|#3D<")#0A..rule(".<|#3D<")#0A
..rule("..<#3D<")#0A..rule(".<<#3D<")#0A..rule("<<|
#3D<")#0A..rule("<<<#3D<")#0A..rule("<|.#3D|")#0A..
rule(".<.#3D.")#0A..rule("<.|#3D.")#0A..rule("<..#3D
.")#0A..rule("<.>#3D.")#0A..rule("|.<#3D>")#0A..rul
e(">.<#3D1")#0A..rule("..1#3D<")#0A..rule(".1.#3D."
)#0A..rule("1..#3D>")#0A..rule("<.<#3D<")#0A..rule(
"1.<#3D<")#0A}#0A#0AAND.closerules().BE.IF.rulev.DO
.freevec(rulev)#0A#0AAND.func(a,.b,.c).#3D.VALOF#0A
{.LET.i.#3D.a<<8.|.b<<4.|.c#0A..RESULTIS.rulev!i#0A
}#0A#0A/*#0A0>.squadf.50#0A#0AFiring.squad.solution
.for.50.soldiers#0A#0A..0:.|1......................
...........................|#0A*/#0A.#0A

######bcplprogs/demos/squad.b#
GET."libhdr"#0A#0AMANIFEST.{.upb.#3D.1000.}#0A.#0AL
ET.start().#3D.VALOF#0A{.LET.v.#3D.VEC.upb#0A..AND.
n.#3D.12#0A..LET.argv.#3D.VEC.20#0A#0A..UNLESS.rdar
gs("N",.argv,.20).DO#0A..{.writes("Bad.arguments.fo
r.SQUAD*n")#0A....RESULTIS.20#0A..}#0A..IF.argv!0.D
O.n.:#3D.str2numb(argv!0)#0A#0A..UNLESS.2<#3Dn<#3Du
pb.DO#0A..{.writef("The.number.of.soldiers.must.be.
between.2.and.%n*n",.upb)#0A....RESULTIS.0#0A..}#0A
#0A..writef("*nFiring.squad.solution.for.%i2.soldie
rs*n*n",.n)#0A..squad(v,.n)#0A..RESULTIS.0#0A}#0A.#0A
AND.squad(v,.n).BE#0A{.v!1.:#3D.'S'#0A..FOR.i.#3D.2
.TO.n-1.DO.v!i.:#3D.'-'#0A..v!n.:#3D.'|'#0A..v!(n+1
).:#3D.0#0A.#0A..{.LET.p,.a,.b,.c.#3D.0,.0,.0,.v!1#0A
....FOR.i.#3D.1.TO.n.DO.writef(".%c",.v!i)#0A....ne
wline()#0A....IF.c#3D'F'.BREAK#0A....UNTIL.p#3Dn.DO
#0A....{.p.:#3D.p+1#0A......a.:#3D.b#0A......b.:#3D
.c#0A......c.:#3D.v!(p+1)#0A......v!p.:#3D.func(a,.
b,.c)#0A....}#0A..}.REPEAT#0A.#0A..newline()#0A}#0A
.#0AAND.func(a,.b,.c).#3D.VALOF.SWITCHON.b.INTO#0A{
.DEFAULT:..RESULTIS.'F'#0A.#0A..CASE.'S':.RESULTIS.
a#3D'|'.->.'F',#0A.....................c#3D'|'.->.'
F',#0A.....................'#2E'#0A.#0A..CASE.'#2E'
:.RESULTIS.'+'#0A.#0A..CASE.'+':.RESULTIS.'|'#0A.#0A
..CASE.'(':.RESULTIS.a#3D'>'.->.'S',#0A............
.........'['#0A.#0A..CASE.'[':.RESULTIS.a#3D'>'.->.
'S',#0A.....................'/'#0A.#0A..CASE.'/':.R
ESULTIS.'-'#0A.#0A..CASE.')':.RESULTIS.c#3D'<'.->.'
S',#0A.....................']'#0A.#0A..CASE.']':.RE
SULTIS.c#3D'<'.->.'S',#0A.....................'\'#0A
.#0A..CASE.'\':.RESULTIS.'-'#0A.#0A..CASE.'-':.RESU
LTIS.a#3D'S'.->.'>',#0A.....................a#3D'>'
.->.'>',#0A.....................a#3D'\'.->.')',#0A.
....................a#3D'+'.->.')',#0A.............
........c#3D'S'.->.'<',#0A.....................c#3D
'<'.->.'<',#0A.....................c#3D'/'.->.'(',#0A
.....................c#3D'+'.->.'(',#0A............
.........'-'#0A.#0A..CASE.'<':.RESULTIS.a#3D'|'.->.
'>',#0A.....................a#3D'+'.->.'S',#0A.....
................a#3D')'.->.'S',#0A.................
....a#3D'\'.->.'S',#0A.....................'-'#0A.#0A
..CASE.'>':.RESULTIS.c#3D'|'.->.'<',#0A............
.........c#3D'+'.->.'S',#0A.....................c#3D
'('.->.'S',#0A.....................c#3D'/'.->.'S',#0A
.....................'-'#0A.#0A..CASE.'|':.RESULTIS
.a#3D'S'.->.'F',#0A.....................c#3D'S'.->.
'F',#0A.....................'|'#0A}#0A#0A/*#0A0>.sq
uad.31#0A#0AFiring.squad.solution.for.31.soldiers#0A
#0A.S.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
.-.-.-.-.-.-.|#0A.#2E.>.-.-.-.-.-.-.-.-.-.-.-.-.-.-
.-.-.-.-.-.-.-.-.-.-.-.-.-.-.|#0A.+.-.>.-.-.-.-.-.-
.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.|#0A.|.)
.-.>.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.
-.-.-.|#0A.|.].-.-.>.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.
-.-.-.-.-.-.-.-.-.-.|#0A.|.\.-.-.-.>.-.-.-.-.-.-.-.
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.|#0A.|.-.).-.-.-.
>.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.|#0A
.|.-.].-.-.-.-.>.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.
-.-.-.-.-.|#0A.|.-.\.-.-.-.-.-.>.-.-.-.-.-.-.-.-.-.
-.-.-.-.-.-.-.-.-.-.-.-.|#0A.|.-.-.).-.-.-.-.-.>.-.
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.|#0A.|.-.-.].
-.-.-.-.-.-.>.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-
.|#0A.|.-.-.\.-.-.-.-.-.-.-.>.-.-.-.-.-.-.-.-.-.-.-
.-.-.-.-.-.-.-.|#0A.|.-.-.-.).-.-.-.-.-.-.-.>.-.-.-
.-.-.-.-.-.-.-.-.-.-.-.-.-.-.|#0A.|.-.-.-.].-.-.-.-
.-.-.-.-.>.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.|#0A.|.-
.-.-.\.-.-.-.-.-.-.-.-.-.>.-.-.-.-.-.-.-.-.-.-.-.-.
-.-.-.|#0A.|.-.-.-.-.).-.-.-.-.-.-.-.-.-.>.-.-.-.-.
-.-.-.-.-.-.-.-.-.-.|#0A.|.-.-.-.-.].-.-.-.-.-.-.-.
-.-.-.>.-.-.-.-.-.-.-.-.-.-.-.-.-.|#0A.|.-.-.-.-.\.
-.-.-.-.-.-.-.-.-.-.-.>.-.-.-.-.-.-.-.-.-.-.-.-.|#0A
.|.-.-.-.-.-.).-.-.-.-.-.-.-.-.-.-.-.>.-.-.-.-.-.-.
-.-.-.-.-.|#0A.|.-.-.-.-.-.].-.-.-.-.-.-.-.-.-.-.-.
-.>.-.-.-.-.-.-.-.-.-.-.|#0A.|.-.-.-.-.-.\.-.-.-.-.
-.-.-.-.-.-.-.-.-.>.-.-.-.-.-.-.-.-.-.|#0A.|.-.-.-.
-.-.-.).-.-.-.-.-.-.-.-.-.-.-.-.-.>.-.-.-.-.-.-.-.-
.|#0A.|.-.-.-.-.-.-.].-.-.-.-.-.-.-.-.-.-.-.-.-.-.>
.-.-.-.-.-.-.-.|#0A.|.-.-.-.-.-.-.\.-.-.-.-.-.-.-.-
.-.-.-.-.-.-.-.>.-.-.-.-.-.-.|#0A.|.-.-.-.-.-.-.-.)
.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.>.-.-.-.-.-.|#0A.|.-
.-.-.-.-.-.-.].-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.>.-.
-.-.-.|#0A.|.-.-.-.-.-.-.-.\.-.-.-.-.-.-.-.-.-.-.-.
-.-.-.-.-.-.>.-.-.-.|#0A.|.-.-.-.-.-.-.-.-.).-.-.-.
-.-.-.-.-.-.-.-.-.-.-.-.-.-.>.-.-.|#0A.|.-.-.-.-.-.
-.-.-.].-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.>.-.|#0A
.|.-.-.-.-.-.-.-.-.\.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.
-.-.-.-.>.|#0A.|.-.-.-.-.-.-.-.-.-.).-.-.-.-.-.-.-.
-.-.-.-.-.-.-.-.-.-.-.<.|#0A.|.-.-.-.-.-.-.-.-.-.].
-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.<.-.|#0A.|.-.-.-.
-.-.-.-.-.-.\.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.<.-.-
.|#0A.|.-.-.-.-.-.-.-.-.-.-.).-.-.-.-.-.-.-.-.-.-.-
.-.-.-.<.-.-.-.|#0A.|.-.-.-.-.-.-.-.-.-.-.].-.-.-.-
.-.-.-.-.-.-.-.-.-.<.-.-.-.-.|#0A.|.-.-.-.-.-.-.-.-
.-.-.\.-.-.-.-.-.-.-.-.-.-.-.-.<.-.-.-.-.-.|#0A.|.-
.-.-.-.-.-.-.-.-.-.-.).-.-.-.-.-.-.-.-.-.-.<.-.-.-.
-.-.-.|#0A.|.-.-.-.-.-.-.-.-.-.-.-.].-.-.-.-.-.-.-.
-.-.<.-.-.-.-.-.-.-.|#0A.|.-.-.-.-.-.-.-.-.-.-.-.\.
-.-.-.-.-.-.-.-.<.-.-.-.-.-.-.-.-.|#0A.|.-.-.-.-.-.
-.-.-.-.-.-.-.).-.-.-.-.-.-.<.-.-.-.-.-.-.-.-.-.|#0A
.|.-.-.-.-.-.-.-.-.-.-.-.-.].-.-.-.-.-.<.-.-.-.-.-.
-.-.-.-.-.|#0A.|.-.-.-.-.-.-.-.-.-.-.-.-.\.-.-.-.-.
<.-.-.-.-.-.-.-.-.-.-.-.|#0A.|.-.-.-.-.-.-.-.-.-.-.
-.-.-.).-.-.<.-.-.-.-.-.-.-.-.-.-.-.-.|#0A.|.-.-.-.
-.-.-.-.-.-.-.-.-.-.].-.<.-.-.-.-.-.-.-.-.-.-.-.-.-
.|#0A.|.-.-.-.-.-.-.-.-.-.-.-.-.-.\.<.-.-.-.-.-.-.-
.-.-.-.-.-.-.-.|#0A.|.-.-.-.-.-.-.-.-.-.-.-.-.-.-.S
.-.-.-.-.-.-.-.-.-.-.-.-.-.-.|#0A.|.-.-.-.-.-.-.-.-
.-.-.-.-.-.<.#2E.>.-.-.-.-.-.-.-.-.-.-.-.-.-.|#0A.|
.-.-.-.-.-.-.-.-.-.-.-.-.<.-.+.-.>.-.-.-.-.-.-.-.-.
-.-.-.-.|#0A.|.-.-.-.-.-.-.-.-.-.-.-.<.-.(.|.).-.>.
-.-.-.-.-.-.-.-.-.-.-.|#0A.|.-.-.-.-.-.-.-.-.-.-.<.
-.-.[.|.].-.-.>.-.-.-.-.-.-.-.-.-.-.|#0A.|.-.-.-.-.
-.-.-.-.-.<.-.-.-./.|.\.-.-.-.>.-.-.-.-.-.-.-.-.-.|
#0A.|.-.-.-.-.-.-.-.-.<.-.-.-.(.-.|.-.).-.-.-.>.-.-
.-.-.-.-.-.-.|#0A.|.-.-.-.-.-.-.-.<.-.-.-.-.[.-.|.-
.].-.-.-.-.>.-.-.-.-.-.-.-.|#0A.|.-.-.-.-.-.-.<.-.-
.-.-.-./.-.|.-.\.-.-.-.-.-.>.-.-.-.-.-.-.|#0A.|.-.-
.-.-.-.<.-.-.-.-.-.(.-.-.|.-.-.).-.-.-.-.-.>.-.-.-.
-.-.|#0A.|.-.-.-.-.<.-.-.-.-.-.-.[.-.-.|.-.-.].-.-.
-.-.-.-.>.-.-.-.-.|#0A.|.-.-.-.<.-.-.-.-.-.-.-./.-.
-.|.-.-.\.-.-.-.-.-.-.-.>.-.-.-.|#0A.|.-.-.<.-.-.-.
-.-.-.-.(.-.-.-.|.-.-.-.).-.-.-.-.-.-.-.>.-.-.|#0A.
|.-.<.-.-.-.-.-.-.-.-.[.-.-.-.|.-.-.-.].-.-.-.-.-.-
.-.-.>.-.|#0A.|.<.-.-.-.-.-.-.-.-.-./.-.-.-.|.-.-.-
.\.-.-.-.-.-.-.-.-.-.>.|#0A.|.>.-.-.-.-.-.-.-.-.(.-
.-.-.-.|.-.-.-.-.).-.-.-.-.-.-.-.-.<.|#0A.|.-.>.-.-
.-.-.-.-.-.[.-.-.-.-.|.-.-.-.-.].-.-.-.-.-.-.-.<.-.
|#0A.|.-.-.>.-.-.-.-.-.-./.-.-.-.-.|.-.-.-.-.\.-.-.
-.-.-.-.<.-.-.|#0A.|.-.-.-.>.-.-.-.-.(.-.-.-.-.-.|.
-.-.-.-.-.).-.-.-.-.<.-.-.-.|#0A.|.-.-.-.-.>.-.-.-.
[.-.-.-.-.-.|.-.-.-.-.-.].-.-.-.<.-.-.-.-.|#0A.|.-.
-.-.-.-.>.-.-./.-.-.-.-.-.|.-.-.-.-.-.\.-.-.<.-.-.-
.-.-.|#0A.|.-.-.-.-.-.-.>.(.-.-.-.-.-.-.|.-.-.-.-.-
.-.).<.-.-.-.-.-.-.|#0A.|.-.-.-.-.-.-.S.S.-.-.-.-.-
.-.|.-.-.-.-.-.-.S.S.-.-.-.-.-.-.|#0A.|.-.-.-.-.-.<
.#2E.#2E.>.-.-.-.-.-.|.-.-.-.-.-.<.#2E.#2E.>.-.-.-.
-.-.|#0A.|.-.-.-.-.<.-.+.+.-.>.-.-.-.-.|.-.-.-.-.<.
-.+.+.-.>.-.-.-.-.|#0A.|.-.-.-.<.-.(.|.|.).-.>.-.-.
-.|.-.-.-.<.-.(.|.|.).-.>.-.-.-.|#0A.|.-.-.<.-.-.[.
|.|.].-.-.>.-.-.|.-.-.<.-.-.[.|.|.].-.-.>.-.-.|#0A.
|.-.<.-.-.-./.|.|.\.-.-.-.>.-.|.-.<.-.-.-./.|.|.\.-
.-.-.>.-.|#0A.|.<.-.-.-.(.-.|.|.-.).-.-.-.>.|.<.-.-
.-.(.-.|.|.-.).-.-.-.>.|#0A.|.>.-.-.-.[.-.|.|.-.].-
.-.-.<.|.>.-.-.-.[.-.|.|.-.].-.-.-.<.|#0A.|.-.>.-.-
./.-.|.|.-.\.-.-.<.-.|.-.>.-.-./.-.|.|.-.\.-.-.<.-.
|#0A.|.-.-.>.(.-.-.|.|.-.-.).<.-.-.|.-.-.>.(.-.-.|.
|.-.-.).<.-.-.|#0A.|.-.-.S.S.-.-.|.|.-.-.S.S.-.-.|.
-.-.S.S.-.-.|.|.-.-.S.S.-.-.|#0A.|.-.<.#2E.#2E.>.-.
|.|.-.<.#2E.#2E.>.-.|.-.<.#2E.#2E.>.-.|.|.-.<.#2E.#2E
.>.-.|#0A.|.<.-.+.+.-.>.|.|.<.-.+.+.-.>.|.<.-.+.+.-
.>.|.|.<.-.+.+.-.>.|#0A.|.>.(.|.|.).<.|.|.>.(.|.|.)
.<.|.>.(.|.|.).<.|.|.>.(.|.|.).<.|#0A.|.S.S.|.|.S.S
.|.|.S.S.|.|.S.S.|.S.S.|.|.S.S.|.|.S.S.|.|.S.S.|#0A
.F.F.F.F.F.F.F.F.F.F.F.F.F.F.F.F.F.F.F.F.F.F.F.F.F.
F.F.F.F.F.F#0A#0A30>.#0A*/#0A.#0A

######bcplprogs/demos/stvote.b#
/*#0A**************.STILL.UNDER.DEVELOPMENT.*******
******#0A#0AThis.is.an.implementation.of.Meek's.met
hod.for#0Aa.single.transferable.vote.election#2E#0A
#0ARef.Hill,I#2ED#2E,.Wichmann,.B#2EA#2E.and.Woodal
l,.D#2ER#0A"Singel.transferable.vote.by.Meek's.meth
od"#0AComputer.J.30.(1987).277-281#2E#0A#0AImplemen
ted.in.BCPL.by.Martin.Richards.(c).Oct.2000#0A*/#0A
#0AGET."libhdr"#0A#0AGLOBAL.{#0Acmax:ug...//.Number
.of.candidates,.named.A,.B,.C,.etc#0Asmax......//.N
umber.of.seats#0Aemax......//.Number.of.electors#0A
#0Acount.....//.Number.of.candidates.elected.so.far
#0Astate.....//.state!c..Candidate.state.Elected,.H
opeful.or.Excluded#0Aw.........//.w!c......Candidat
e's.current.weight#0Avote......//.vote!c...Canditae
's.vote#0Aexcess....//.Excess.votes#0Atotalvotes#0A
#0Ascale.....//.All.scaled.arithmetic.done.to.this.
scale#0A..........//.(intially.1000,.but.may.change
)#0A#0Apaper.....//.paper!e..Elector's.ballot.paper
.as.a.string#0A..........//.eg......"AFG.BD.HI.E"#0A
}#0A#0AMANIFEST.{#0AElected#3D0;.Hopeful;.Excluded#0A
}#0A#0ALET.start().#3D.VALOF#0A{#0A..scale.:#3D.100
0..//.scale.of.scaled.arithmetic#0A#0A..cmax..:#3D.
10#0A..smax..:#3D.5#0A..emax..:#3D.20#0A#0A..w.....
:#3D.getvec(cmax)#0A..state.:#3D.getvec(cmax)#0A..p
aper.:#3D.getvec(emax)#0A#0A..FOR.e.#3D.1.TO.emax.D
O.paper!e.:#3D.0#0A#0A..paper!.1.:#3D."A.BCD.EF.GHI
.J"#0A..paper!.2.:#3D."DF.G.AE.C.HI.J.B"#0A..paper!
.3.:#3D."E.F.BDH.J.IC.GA"#0A..paper!.4.:#3D."B.G.A.
DE.J.H.F.CI"#0A..paper!.5.:#3D."DA.C.B.GEI.JF.H"#0A
..paper!.6.:#3D."A.GHF.E.IC.DBJ"#0A..paper!.7.:#3D.
"C.E.GH.BF.IJ.D.A"#0A..paper!.8.:#3D."E.G.DA.H.FCI.
JB"#0A..paper!.9.:#3D."DEB.FA.GIH.J.C"#0A..paper!10
.:#3D."B.D.F.G.A.E.C.I.J.H"#0A#0A..FOR.c.#3D.1.TO.c
max.DO.w!c,.state!c.:#3D.scale,.Hopeful#0A..count.:
#3D.0..//.Number.of.elected.candidates#0A#0A..{.//#0A
....LET.old.count.#3D.count#0A....excess.:#3D.0#0A.
...FOR.i.#3D.1.TO.cmax.DO.vote!c.:#3D.0#0A#0A....FO
R.e.#3D.1.TO.emax.IF.paper!e.DO#0A....{.totalvotes.
:#3D.totalvotes.+.scale#0A......processpaper(paper!
e)#0A....}#0A#0A....quota.:#3D.(totalvotes-excess)/
(smax+1)#0A#0A....FOR.c.#3D.1.TO.cmax.IF.vote!c>quo
ta.DO#0A......state!c,.count.:#3D.Elected,.count+1#0A
#0A....IF.count#3Doldcount.DO#0A....{.//.No.Hopeful
.candidate.was.elected.so#0A......//.exclude.a.cand
idate.with.the.lowest.vote#0A......LET.cand.#3D.0#0A
......LET.candvote.#3D.maxint#0A......FOR.c.#3D.1.T
O.cmax.IF.state!c#3DHopeful.&.vote!c<candvote.DO#0A
..........cand,.candvote.:#3D.c,.vote!c#0A......sta
te!cand.:#3D.Excluded#0A....}#0A....#0A....{.//.Set
.the.weight.of.the.elected.candidated#0A......LET.c
hange.#3D.FALSE#0A......FOR.c.#3D.1.TO.cmax.IF.stat
us!c#3DElected.DO#0A......{.LET.wc.:#3D.w!c.-.(vote
!c-quota)#0A........UNLESS.wc#3Dw!c.DO#0A........{.
w!c,.change.:#3D.wc,.TRUE#0A..........writef("w!%i2
.#3D.%i5*n",.c,.wc).#0A........}#0A........excess.:
#3D.0#0A........FOR.i.#3D.1.TO.cmax.DO.vote!c.:#3D.
0#0A#0A........FOR.e.#3D.1.TO.emax.IF.paper!e.DO#0A
........{.totalvotes.:#3D.totalvotes.+.scale#0A....
......processpaper(paper!e)#0A........}#0A#0A......
..quota.:#3D.(totalvotes-excess)/(smax+1)#0A......}
#0A....}.REPEAT#0A#0A..}.REPEATWHILE.count<smax#0A#0A
..writef("Ballot.papers:*n*n")#0A..FOR.e.#3D.1.TO.e
max.IF.paper!e.DO.writef("%i4:.%s*n",.e,.paper!e)#0A
..#0A..writef("*nElected.candidates:..")#0A..FOR.c.
#3D.1.TO.cmax.IF.state!c#3DElected.DO.writef(".%c",
.c+'A'-1)#0A..newline()#0A#0A..freevec(w)#0A..freev
ec(state)#0A..freevec(paper)#0A..RESULTIS.0#0A}

######bcplprogs/demos/tag.b#
/*#0AThis.is.a.simple.program.to.help.explore.the.T
ag.problem#0Adescribed.in.Minsky's.book."Computatio
n,.Finite.and.Infinite#0AMachines"#0A#0A*/#0A#0AGET
."libhdr"#0A#0AGLOBAL#0A{.p:ug....//.Subscript.of.f
irst.byte.of.the.string#0A..q.......//.Subscript.ju
st.after.the.end.of.the.string#0A..str.....//.Circu
lar.buffer.of.0s.and.1s#0A..len.....//.Length.of.cu
rrent.string#0A..r.......//.Sample.string#0A..rlen.
...//.Length.of.sample.string#0A..range...//.Maximu
m.loop.length.currently.being.tested#0A..looplen.//
.Current.loop.length.under.test#0A..tostream#0A..st
dout#0A}#0A#0AMANIFEST#0A{.strsize.#3D.1<<16.//.Num
ber.of.words.in.str#0A..strupb..#3D.strsize-1#0A..m
ask....#3D.(strsize<<2).-.1#0A}#0A#0ALET.start().#3D
.VALOF#0A{.LET.argv..#3D.VEC.50#0A..//LET.data..#3D
."10010"#0A..//LET.data..#3D."100100100100100100100
"#0A..//LET.data..#3D."1111111111111111111111111111
11111111111"#0A..//LET.data..#3D."11111111111111111
111111111111111111111111"#0A..LET.data..#3D."011111
11111111111111111111111111111111111"#0A..LET.count.
#3D.100000#0A..LET.trace.#3D.FALSE#0A#0A..stdout.:#3D
.output()#0A..tostream.:#3D.0#0A#0A..UNLESS.rdargs(
"DATA,COUNT,TO/K,TRACE/S",.argv,.50).DO#0A..{.write
f("Bad.arguments.for.TAG*n")#0A....RESULTIS.20#0A..
}#0A..IF.argv!0.DO.data..:#3D.argv!0#0A..IF.argv!1.
DO.count.:#3D.str2numb(argv!1)#0A#0A..IF.argv!2.DO#0A
..{.tostream.:#3D.findoutput(argv!2)#0A....UNLESS.t
ostream.DO#0A....{.writef("Can't.open.file.%s*n",.a
rgv!2)#0A......RESULTIS.20#0A....}#0A..}#0A..trace.
:#3D.argv!3#0A#0A..str.:#3D.getvec(strupb)#0A#0A..U
NLESS.str.DO#0A..{.writef("Need.more.store*n")#0A..
..RESULTIS.20#0A..}#0A#0A..p,.q.:#3D.0,.0#0A#0A..FO
R.i.#3D.1.TO.data%0.DO.push(data%i)#0A..len.:#3D.q-
p#0A..r,.rlen,.range.:#3D.p,.len,.0#0A#0A..writef("
count#3D%n*n*n",.count)#0A#0A..IF.tostream.DO.selec
toutput(tostream)#0A#0A..pr(p,.q)#0A#0A..FOR.i.#3D.
1.TO.count.DO#0A..{.IF.len<3.DO#0A....{.writef("*nS
tring.length.less.than.3*n")#0A......pr(p,.q)#0A...
...BREAK#0A....}#0A#0A....step()#0A....IF.trace.DO.
pr(p,.q)#0A#0A....IF.chkloop().DO#0A....{.writef("*
nRepeated.string.encountered*n")#0A......pr(p,.q)#0A
......BREAK#0A....}#0A..}#0A#0A..IF.tostream.UNLESS
.stdout#3Dtostream.DO.endwrite()#0A..selectoutput(s
tdout)#0A..freevec(str)#0A..RESULTIS.0#0A}#0A#0AAND
.step().BE#0A{.LET.ch.#3D.str%(p&mask)#0A..p.:#3D.p
+3#0A..TEST.ch#3D'0'#0A..THEN.{.push('0');.push('0'
);.len.:#3D.len-1.}#0A..ELSE.{.push('1');.push('1')
.;.push('0');.push('1');.len.:#3D.len+1.}#0A}#0A#0A
AND.push(ch).BE#0A{.str%(q&mask).:#3D.ch#0A..q.:#3D
.q+1#0A}#0A#0AAND.chkloop().#3D.VALOF#0A{.LET.loopl
en.#3D.q-r#0A..IF.looplen>#3Drange.DO#0A..{.r,.rlen
.:#3D.p,.len#0A....range.:#3D.range.*.3./.2.+.1#0A.
...writef("*nNew.sample.string.at.r#3D%n.rlen#3D%n.
range#3D%n*n",.r,.rlen,.range)#0A....pr(r,.r+rlen)#0A
....newline()#0A....RESULTIS.FALSE#0A..}#0A.#0A..//
.Compare.current.string.with.the.one.at.position.r#0A
..IF.rlen#3Dlen.DO#0A..{.FOR.i.#3D.0.TO.len-1.UNLES
S.str%(r+i.&.mask)#3Dstr%(p+i.&.mask).RESULTIS.FALS
E#0A....writef("*nStrings.at.%n.and.%n.of.length.%n
.are.equal*n",.r,.p,.len)#0A....RESULTIS.TRUE.//.Re
peated.string.found#0A..}#0A..RESULTIS.FALSE#0A}#0A
#0AAND.pr(p,.q).BE#0A{.writef("%i4:.",.p)#0A..UNTIL
.p#3Dq.DO#0A..{.wrch(str%(p&mask))#0A....p.:#3D.p+1
#0A..}#0A..newline()#0A}#0A

######bcplprogs/demos/triangle.b#
GET."libhdr"#0A#0ALET.start().#3D.VALOF#0A{.LET.arg
v.#3D.VEC.50#0A..LET.len.#3D.VEC.2#0A#0A..IF.rdargs
("A/A,B/A,C/A",.argv,.50).#3D.0#0A..{.writes("Bad.a
rguments:.triangle.need.three.numbers*n")#0A....RES
ULTIS.20#0A..}#0A..FOR.i.#3D.0.TO.2.DO.len!i.:#3D.s
tr2numb(argv!i)#0A..writes("*nTriangle.given:.")#0A
..FOR.i.#3D.0.TO.2.DO.writef("%n.",.len!i)#0A..writ
ef("*nThis.is.%s.triangle*n",#0A............sort_of
_triangle(len!0,.len!1,.len!2))#0A..RESULTIS.0#0A}#0A
#0AAND.sort_of_triangle(a,.b,.c).#3D#0A....b<a.....
....->.sort_of_triangle(b,.a,.c),#0A....c<b........
.->.sort_of_triangle(a,.c,.b),#0A....//.At.this.poi
nt.we.know.that.a.<#3D.b.<#3D.c#0A....c>a+b.......-
>."not.a",#0A....a#3Dc.........->."an.equilateral",
#0A....a#3Db.|.b#3Dc...->."an.isoscelese",#0A....c*
c#3Da*a+b*b.->."a.right.angled",#0A................
..."a.scalene"#0A

######bcplprogs/demos/tst.b#
GET."libhdr"#0A#0ALET.start().#3D.VALOF#0A{.LET.x,.
y.#3D.11,.12#0A..x.:#3D.x.+.9*y.#0A..x.:#3D.1234#0A
#0A#0A..FOR.i.#3D.5.TO.10.DO#0A....writef("f(%i2).#3D
.%i6*n",.i,.f(i))#0A..RESULTIS.0#0A}#0A#0AAND.f(n).
#3D.n#3D0.->.0,.n.+.f(n-1)#0A

######bcplprogs/demos/warshll.b#
SECTION."warshall"#0A.#0AGET."libhdr"#0A.#0AMANIFES
T.$(.upb..........#3D..100#0A............bitsperwor
d..#3D..16#0A............wordsperrow..#3D.upb./.bit
sperword.+.1#0A............vecupb.......#3D.(upb+1)
*wordsperrow.-.1#0A$)#0A.#0ALET.warshall(v).BE.FOR.
i.#3D.0.TO.upb.DO#0A$(.LET.wordi.#3D.i./.bitsperwor
d#0A...AND.biti..#3D.1.<<.i.REM.bitsperword#0A...AN
D.rowi..#3D.v.+.i*wordsperrow#0A.#0A...FOR.rowj.#3D
.v.TO.v+upb*wordsperrow.BY.wordsperrow.DO#0A.....UN
LESS.(rowj!wordi.&.biti).#3D.0.DO#0A.......FOR.k.#3D
.0.TO.wordsperrow-1.DO.rowj!k.:#3D.rowj!k.|.rowi!k#0A
$)#0A.#0AAND.clear(v).BE.FOR.p.#3D.v.TO.v+vecupb.DO
.!p.:#3D.0#0A.#0AAND.set(v,.x,.y).BE#0A$(.LET.wordx
.#3D.x./.bitsperword#0A...AND.bitx..#3D.1.<<.x.REM.
bitsperword#0A...AND.rowy.#3D.v.+.y*wordsperrow#0A.
..rowy!wordx.:#3D.rowy!wordx.|.bitx#0A$)#0A.#0AAND.
iszero(row).#3D.VALOF#0A$(.FOR.i.#3D.0.TO.wordsperr
ow-1.UNLESS.row!i#3D0.RESULTIS.FALSE#0A...RESULTIS.
TRUE#0A$)#0A.#0AAND.pr(v).BE.FOR.y.#3D.0.TO.upb.DO#0A
$(.LET.rowy.#3D.v.+.y.*.wordsperrow#0A...AND.k.#3D.
0#0A...IF.iszero(rowy).LOOP#0A...writef("%i3:.",.y)
#0A...FOR.x.#3D.0.TO.upb.DO#0A...$(.LET.wordx.#3D.x
./.bitsperword#0A......AND.bitx..#3D.1.<<.x.REM.bit
sperword#0A......UNLESS.(rowy!wordx.&.bitx).#3D.0.D
O#0A......$(.k.:#3D.k+1#0A.........IF.k.REM.10.#3D.
0.DO.writes("*n.....")#0A.........writef("%i3",.x)#0A
......$)#0A...$)#0A...newline()#0A$)#0A.#0A.#0A.#0A
.#0A.#0A.#0ALET.start().BE#0A$(.LET.matrix.#3D.getv
ec(vecupb)#0A...AND.current#2Ey.#3D.0#0A.#0A...writ
es("*nTest.program.for.Warshall's.algorithm*n")#0A.
#0A...$(.LET.ch.#3D.rdch()#0A......SWITCHON.capital
ch(ch).INTO#0A......$(.DEFAULT:...writef("*nBad.cha
racter.'%c'*n",.ch)#0A.........CASE.'*n':.newline()
#0A.........CASE.'*s':.LOOP#0A.#0A.........CASE.'X'
:..$(.LET.x.#3D.readn()#0A.......................TE
ST.0<#3Dx<#3Dupb#0A.......................THEN.set(
matrix,.x,.current#2Ey)#0A.......................EL
SE.writef("*nX.(#3D.%n).out.of.range*n",.x)#0A.....
..................LOOP#0A.....................$)#0A
.#0A.........CASE.'Y':..$(.LET.y.#3D.readn()#0A....
...................TEST.0<#3Dy<#3Dupb#0A...........
............THEN.current#2Ey.:#3D.y#0A.............
..........ELSE.writef("*nY.(#3D.%n).out.of.range*n"
,.y)#0A.......................LOOP#0A..............
.......$)#0A.#0A.........CASE.'Z':..clear(matrix)#0A
....................LOOP#0A.#0A.........CASE.'W':..
warshall(matrix)#0A....................LOOP#0A.#0A.
........CASE.'P':..pr(matrix)#0A...................
.newline()#0A....................LOOP#0A.#0A.......
..CASE.'Q':..BREAK#0A......$)#0A...$).REPEAT#0A.#0A
...freevec(matrix)#0A...writes("*nEnd.of.test*n")#0A
$)#0A.#0A.#0A

######bcplprogs/demos/Xsquare.b#
GET."libhdr"#0A.#0AGLOBAL.$(.tab:200;.Xtab:201.$)#0A
.#0AMANIFEST.$(.expectedval#3D200;.digits#3Dexpecte
dval*10;.Xtabupb#3D200.$)#0A#0ALET.start().BE#0A$(.
LET.v1.#3D.VEC.9#0A...AND.v2.#3D.VEC.Xtabupb#0A.#0A
...tab,.Xtab.:#3D.v1,.v2#0A...#0A...FOR.i.#3D.0.TO.
Xtabupb.DO.Xtab!i.:#3D.0#0A#0A...FOR.i.#3D.1.TO.100
0.DO#0A...$(.LET.sum,.Xsqx10.#3D.0,.?#0A......FOR.i
.#3D.0.TO.9.DO.tab!i.:#3D.0#0A......FOR.i.#3D.1.TO.
digits.DO.$(.LET.dig.#3D.randno(10).-.1#0A.........
.......................tab!dig.:#3D.tab!dig.+.1#0A.
............................$)#0A......FOR.i.#3D.0.
TO.9.DO.$(.LET.diff.#3D.tab!i.-.expectedval#0A.....
......................writef("%i3.",.tab!i)#0A.....
......................sum.:#3D.sum.+.diff*diff#0A..
......................$)#0A......Xsqx10.:#3D.sum*10
./.expectedval#0A......IF.Xsqx10<#3DXtabupb.DO.Xtab
!Xsqx10.:#3D.Xtab!Xsqx10.+.1#0A......writef("*n%i3.
.Sum.#3D.%i3.Xsqx10.#3D.%i3*n",.i,.sum,.Xsqx10)#0A.
..$)#0A....#0A...writes("*nXi.Squared.Distribution*
n")#0A...FOR.i.#3D.0.TO.Xtabupb.DO#0A...$(.IF.i.REM
.20.#3D.0.DO.writef("*n%i2#2E0:..",.i/10)#0A......w
ritef("%i2.",.Xtab!i)#0A...$)#0A...newline()#0A$)#0A


######+#
